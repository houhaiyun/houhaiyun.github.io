<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>安装Open vSwitch | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/SDN/">SDN</a></div><div class="post-time">2018-05-09</div></div></div><div class="container post-header"><h1>安装Open vSwitch</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取Open-vSwitch来源"><span class="toc-number">1.</span> <span class="toc-text">获取Open vSwitch来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译安装要求"><span class="toc-number">2.</span> <span class="toc-text">编译安装要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装要求"><span class="toc-number">3.</span> <span class="toc-text">安装要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译安装Open-vSwitch"><span class="toc-number">4.</span> <span class="toc-text">编译安装Open vSwitch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#生成configure脚本"><span class="toc-number">4.1.</span> <span class="toc-text">生成configure脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行configure"><span class="toc-number">4.2.</span> <span class="toc-text">运行configure</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建"><span class="toc-number">4.3.</span> <span class="toc-text">构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">4.4.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#加载openvswitch模块"><span class="toc-number">4.5.</span> <span class="toc-text">加载openvswitch模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开始"><span class="toc-number">4.6.</span> <span class="toc-text">开始</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#致谢"><span class="toc-number">5.</span> <span class="toc-text">致谢</span></a></li></ol></details></div><div class="container post-content"><h3 id="获取Open-vSwitch来源"><a href="#获取Open-vSwitch来源" class="headerlink" title="获取Open vSwitch来源"></a>获取Open vSwitch来源</h3><p>Open vSwitch源代码的规范位置是其Git存储库，您可以使用以下命令将其克隆到名为“ovs”的目录中：</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode OpenvSwitch]# git clone https://github.com/openvswitch/ovs.git</span><br><span class="line">Cloning into &apos;ovs&apos;...</span><br><span class="line">remote: Counting objects: 129519, done.</span><br><span class="line">remote: Compressing objects: 100% (45/45), done.</span><br><span class="line">remote: Total 129519 (delta 25), reused 6 (delta 2), pack-reused 129472</span><br><span class="line">Receiving objects: 100% (129519/129519), 66.68 MiB | 16.38 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (103380/103380), done.</span><br></pre></td></tr></table></figure>
<p>克隆版本库会最初检出“主”分支。这是一般发展的正确分支。另一方面，如果你想构建一个特定的发布版本，你可以通过在“ovs”目录下运行如下命令来检查它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# git checkout v2.7.0</span><br></pre></td></tr></table></figure>
<p>该存储库还为每个发行版系列提供了一个分支。例如，要获得Open vSwitch 2.7.x发行版系列中的最新修复程序（可能包含尚未发布的任何版本的修补程序），可以使用以下命令从“ovs”目录检出它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# git checkout origin/branch-2.7</span><br></pre></td></tr></table></figure>
<p>如果您不想使用Git，还可以通过<a href="http://openvswitch.org/download/" target="_blank" rel="noopener">http://openvswitch.org/download/</a>获取Open vSwitch发行版本的tarball ，或者从<a href="https://github.com/openvswitch/ovs" target="_blank" rel="noopener">https：// github上</a>的Web界面下载任何快照的ZIP文件 <a href="https://github.com/openvswitch/ovs" target="_blank" rel="noopener">https://github.com/openvswitch/ovs</a></p>
<h3 id="编译安装要求"><a href="#编译安装要求" class="headerlink" title="编译安装要求"></a>编译安装要求</h3><p>要构建Open vSwitch发行版中的用户空间程序，需要以下软件：</p>
<ul>
<li>GNU make</li>
<li>A C compiler, such as:<ul>
<li>GCC 4.6 or later.</li>
<li>Clang 3.4 or later.</li>
<li>MSVC 2013. Refer to <a href="http://docs.openvswitch.org/en/latest/intro/install/windows/" target="_blank" rel="noopener">Open vSwitch on Windows</a> for additional Windows build instructions.</li>
</ul>
</li>
<li>来自OpenSSL的libssl是可选的，但建议如果您打算将Open vSwitch连接到OpenFlow控制器。libssl需要在从Open vSwitch到OpenFlow控制器的连接中建立机密性和真实性。如果安装了libssl，则Open vSwitch将自动构建并支持它。</li>
<li>由Steve Grubb编写的libcap-ng是可选的，但建议使用。需要以具有删除的root权限的非root用户身份运行OVS守护程序。如果安装了libcap-ng，则Open vSwitch将自动构建并支持它。</li>
<li>Python 2.7。您还必须具有Python <code>six</code>库版本1.4.0或更高版本。</li>
</ul>
<p><a href="http://docs.openvswitch.org/en/latest/intro/install/general/#obtaining-open-vswitch-sources" target="_blank" rel="noopener">其他要求请参见：http://docs.openvswitch.org/en/latest/intro/install/general/#obtaining-open-vswitch-sources</a></p>
<h3 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h3><p>您构建Open vSwitch的机器可能不是您运行它的机器。要简单地安装并运行Open vSwitch，您需要以下软件：</p>
<ul>
<li>与用于构建的共享库兼容。</li>
<li>在Linux上，如果您想使用基于内核的数据路径（这是最常见的用例），那么使用兼容内核模块的内核。这可以是使用Open vSwitch构建的内核模块（例如上一步），也可以是Linux 3.3及更高版本附带的内核模块。Open vSwitch的功能和性能可能因模块和内核而异。有关更多信息，请参阅<a href="http://docs.openvswitch.org/en/latest/faq/releases/" target="_blank" rel="noopener">发行版</a>。</li>
<li>为了可选地支持Linux上的入口管制，iproute2的“tc”程序（所有主要发行版的一部分，可在<a href="https://wiki.linuxfoundation.org/networking/iproute2" target="_blank" rel="noopener">https://wiki.linuxfoundation.org/networking/iproute2上获得</a>）。</li>
<li>Python 2.7。您还必须拥有Python 6库1.4.0或更高版本。</li>
</ul>
<p>在Linux上，你应该确保<code>/dev/urandom</code>存在。要支持TAP设备，您还必须确保<code>/dev/net/tun</code>存在。</p>
<h3 id="编译安装Open-vSwitch"><a href="#编译安装Open-vSwitch" class="headerlink" title="编译安装Open vSwitch"></a>编译安装Open vSwitch</h3><h4 id="生成configure脚本"><a href="#生成configure脚本" class="headerlink" title="生成configure脚本"></a>生成configure脚本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# ./boot.sh</span><br></pre></td></tr></table></figure>
<h4 id="运行configure"><a href="#运行configure" class="headerlink" title="运行configure"></a>运行configure</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# ./configure</span><br></pre></td></tr></table></figure>
<h4 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# make</span><br></pre></td></tr></table></figure>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>将可执行文件和联机帮助页安装到正在运行的系统中，默认情况下位于：/usr/local</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# make install</span><br></pre></td></tr></table></figure>
<h4 id="加载openvswitch模块"><a href="#加载openvswitch模块" class="headerlink" title="加载openvswitch模块"></a>加载openvswitch模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# modprobe openvswitch</span><br><span class="line"># 验证模块是否加载</span><br><span class="line">[root@namenode ovs]# lsmod | grep openvswitch       # 已经加载</span><br><span class="line">openvswitch           106996  0 </span><br><span class="line">nf_nat_ipv6            14131  1 openvswitch</span><br><span class="line">nf_defrag_ipv6         35104  2 openvswitch,nf_conntrack_ipv6</span><br><span class="line">nf_nat_ipv4            14115  2 openvswitch,iptable_nat</span><br><span class="line">nf_nat                 26787  4 openvswitch,nf_nat_ipv4,nf_nat_ipv6,nf_nat_masquerade_ipv4</span><br><span class="line">nf_conntrack          133387  8 openvswitch,nf_nat,nf_nat_ipv4,nf_nat_ipv6,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_ipv4,nf_conntrack_ipv6</span><br><span class="line">libcrc32c              12644  5 xfs,dm_persistent_data,openvswitch,nf_nat,nf_conntrack</span><br></pre></td></tr></table></figure>
<h4 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h4><p>安装完成后还有一个shell脚本和ovs-ctl工具，它可以执行启动和停止ovsdb-server以及ovs-vswitchd的大部分任务。安装后，可以使用ovs-ctl来启动守护进程。这将会设置初始条件，并以正确的顺序启动守护进程。ovs-ctl位置在<code>$(pkgdatadir)/ scripts</code>中，默认为/usr/local/share/openvswitch/scripts。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# export PATH=$PATH:/usr/local/share/openvswitch/scripts</span><br><span class="line">[root@namenode ovs]# ovs-ctl start</span><br><span class="line">/usr/local/etc/openvswitch/conf.db does not exist ... (warning).</span><br><span class="line">Creating empty database /usr/local/etc/openvswitch/conf.db [  OK  ]</span><br><span class="line">Starting ovsdb-server                                      [  OK  ]</span><br><span class="line">system ID not configured, please use --system-id ... failed!</span><br><span class="line">Configuring Open vSwitch system IDs                        [  OK  ]</span><br><span class="line">Starting ovs-vswitchd                                      [  OK  ]</span><br><span class="line">Enabling remote OVSDB managers                             [  OK  ]</span><br></pre></td></tr></table></figure>
<p>此外，ovs-ctl脚本允许使用特定的选项单独启动/停止守护进程。例如：启动ovsdb-server：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# ovs-ctl --no-ovs-vswitchd start</span><br><span class="line">ovsdb-server is already running.</span><br><span class="line">Enabling remote OVSDB managers                             [  OK  ]</span><br></pre></td></tr></table></figure>
<p>同样，要开始ovs-switchd：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# ovs-ctl --no-ovsdb-server start</span><br><span class="line">ovs-vswitchd is already running.</span><br><span class="line">Enabling remote OVSDB managers                             [  OK  ]</span><br></pre></td></tr></table></figure>
<p>使用ovs-ctl初始化数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode ovs]# ovs-vsctl --no-wait init</span><br></pre></td></tr></table></figure>
<h3 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h3><p><a href="http://docs.openvswitch.org/en/latest/intro/install/general/" target="_blank" rel="noopener">OpenvSwitch 官网安装文档</a></p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2018/05/09/OpenvSwitch-Install/';
var disqus_title = '安装Open vSwitch';
var disqus_url = 'https://keeplearn.vip/2018/05/09/OpenvSwitch-Install/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>