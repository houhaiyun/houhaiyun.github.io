<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>lsof 命令 | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/lsof/">lsof</a></div><div class="post-time">2018-07-30</div></div></div><div class="container post-header"><h1>lsof 命令</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#语法"><span class="toc-number">3.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选项"><span class="toc-number">4.</span> <span class="toc-text">选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行命令"><span class="toc-number">5.</span> <span class="toc-text">执行命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof-输出各列信息意义如下"><span class="toc-number">5.1.</span> <span class="toc-text">lsof 输出各列信息意义如下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件描述符列表"><span class="toc-number">5.2.</span> <span class="toc-text">文件描述符列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#文件状态模式"><span class="toc-number">5.3.</span> <span class="toc-text">文件状态模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#相关的锁"><span class="toc-number">5.4.</span> <span class="toc-text">相关的锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Type-文件类型"><span class="toc-number">5.5.</span> <span class="toc-text">Type 文件类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用参数"><span class="toc-number">6.</span> <span class="toc-text">常用参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#示例"><span class="toc-number">7.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#例子1：查看打开文件-dev-ptmx的进程"><span class="toc-number">7.1.</span> <span class="toc-text">例子1：查看打开文件/dev/ptmx的进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子2：查看sshd进程现在打开的文件"><span class="toc-number">7.2.</span> <span class="toc-text">例子2：查看sshd进程现在打开的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子3：进程ID为66634的进程打开的文件"><span class="toc-number">7.3.</span> <span class="toc-text">例子3：进程ID为66634的进程打开的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子4：显示-root-目录下被进程开启的文件"><span class="toc-number">7.4.</span> <span class="toc-text">例子4：显示/root/目录下被进程开启的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子5：显示-root-目录下被进程开启的文件，并搜索子目录"><span class="toc-number">7.5.</span> <span class="toc-text">例子5：显示/root/目录下被进程开启的文件，并搜索子目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子6：显示使用fd为5的所有进程"><span class="toc-number">7.6.</span> <span class="toc-text">例子6：显示使用fd为5的所有进程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#致谢"><span class="toc-number">8.</span> <span class="toc-text">致谢</span></a></li></ol></details></div><div class="container post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><a id="more"></a>
<p><strong>lsof</strong>（list open files）命令用于查看你进程打开的文件，打开文件的进程，进程打开的端口（TCP、UDP）。找回恢复删除的文件，是十分方便的监视工具，因为lsof命令需要访问核心内存和各种文件，所以需要root用户执行。</p>
<p>在 Linux 环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以如传输控制协议（TCP）和用户数据协议（UDP）套接字等，系统在后台都为该应用程序分配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息，因此通过lsof工具能够查看这个列表对系统检测以及排错将是很有帮助的。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install -y lsof</span></span><br></pre></td></tr></table></figure>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof  (选项)</span><br></pre></td></tr></table></figure>
<h3 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-a：列出打开文件存在的进程；</span><br><span class="line">-c&lt;进程名&gt;：列出指定进程所打开的文件；</span><br><span class="line">-g：列出GID号进程详情；</span><br><span class="line">-d&lt;文件号&gt;：列出占用该文件号的进程；</span><br><span class="line">+d&lt;目录&gt;：列出目录下被打开的文件；</span><br><span class="line">+D&lt;目录&gt;：递归列出目录下被打开的文件；</span><br><span class="line">-n&lt;目录&gt;：列出使用NFS的文件；</span><br><span class="line">-i&lt;条件&gt;：列出符合条件的进程。（4、6、协议、:端口、 @ip ）</span><br><span class="line">-p&lt;进程号&gt;：列出指定进程号所打开的文件；</span><br><span class="line">-u：列出UID号进程详情；</span><br><span class="line">-h：显示帮助信息；</span><br><span class="line">-v：显示版本信息。</span><br></pre></td></tr></table></figure>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p>终端下输入lsof就会显示系统打开的所有文件。由于lsof会访问核心内存和各种文件，必须以root用户来执行该命令。在终端下直接输入lsof，输入一下结果，输出太多内容。我输入的是lsof | head，内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">COMMAND   PID USER   FD      TYPE             DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">systemd     1 root  cwd       DIR             253,10      303        131 /</span><br><span class="line">systemd     1 root  rtd       DIR             253,10      303        131 /</span><br><span class="line">systemd     1 root  txt       REG             253,10  1478184    2097442 /usr/lib/systemd/systemd</span><br><span class="line">systemd     1 root  mem       REG             253,10    20040   10486375 /usr/lib64/libuuid.so.1.3.0</span><br><span class="line">systemd     1 root  mem       REG             253,10   256960   10486054 /usr/lib64/libblkid.so.1.1.0</span><br><span class="line">systemd     1 root  mem       REG             253,10    90664   10486381 /usr/lib64/libz.so.1.2.7</span><br><span class="line">systemd     1 root  mem       REG             253,10   157424   10486226 /usr/lib64/liblzma.so.5.2.2</span><br><span class="line">systemd     1 root  mem       REG             253,10    23968   10486060 /usr/lib64/libcap-ng.so.0.0.0</span><br><span class="line">systemd     1 root  mem       REG             253,10    19888   10486047 /usr/lib64/libattr.so.1.1.0</span><br></pre></td></tr></table></figure>
<h4 id="lsof-输出各列信息意义如下"><a href="#lsof-输出各列信息意义如下" class="headerlink" title="lsof 输出各列信息意义如下"></a>lsof 输出各列信息意义如下</h4><ul>
<li>COMMAND：进程的名称 </li>
<li>PID：进程标识符</li>
<li>USER：进程所有者</li>
<li>FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt、数字等 </li>
<li>TYPE：文件类型，如DIR、REG等</li>
<li>DEVICE：指定磁盘的名称</li>
<li>SIZE：文件的大小</li>
<li>NODE：索引节点（文件在磁盘上的标识）</li>
<li>NAME：打开文件的确切名称</li>
</ul>
<h4 id="文件描述符列表"><a href="#文件描述符列表" class="headerlink" title="文件描述符列表"></a>文件描述符列表</h4><ol>
<li>cwd：表示current work dirctory，即：应用程序的当前工作目录，这是该应用程序启动的目录，除非它本身对这个目录进行更改</li>
<li>txt：该类型的文件是程序代码，如应用程序二进制文件本身或共享库，如上列表中显示的 /sbin/init 程序</li>
<li>lnn：library references (AIX);</li>
<li>er：FD information error (see NAME column);</li>
<li>jld：jail directory (FreeBSD);</li>
<li>ltx：shared library text (code and data);</li>
<li>mxx ：hex memory-mapped type number xx.</li>
<li>m86：DOS Merge mapped file;</li>
<li>mem：memory-mapped file;</li>
<li>mmap：memory-mapped device;</li>
<li>pd：parent directory;</li>
<li>rtd：root directory;</li>
<li>tr：kernel trace file (OpenBSD);</li>
<li>v86  VP/ix mapped file;</li>
<li>0：表示标准输出</li>
<li>1：表示标准输入</li>
<li>2：表示标准错误</li>
</ol>
<h4 id="文件状态模式"><a href="#文件状态模式" class="headerlink" title="文件状态模式"></a>文件状态模式</h4><p><strong>一般在标准输出、标准错误、标准输入后还跟着文件状态模式：</strong></p>
<ol>
<li>u：表示该文件被打开并处于读取/写入模式。</li>
<li>r：表示该文件被打开并处于只读模式。</li>
<li><a href="http://man.linuxde.net/w" target="_blank" rel="noopener">w</a>：表示该文件被打开并处于。</li>
<li>空格：表示该文件的状态模式为unknow，且没有锁定。</li>
<li>-：表示该文件的状态模式为unknow，且被锁定。</li>
</ol>
<h4 id="相关的锁"><a href="#相关的锁" class="headerlink" title="相关的锁"></a>相关的锁</h4><p><strong>同时在文件状态模式后面，还跟着相关的锁：</strong></p>
<ol>
<li>N：for a Solaris NFS lock of unknown type;</li>
<li>r：for <a href="http://man.linuxde.net/read" target="_blank" rel="noopener">read</a> lock on part of the file;</li>
<li>R：for a read lock on the entire file;</li>
<li>w：for a <a href="http://man.linuxde.net/write" target="_blank" rel="noopener">write</a> lock on part of the file;（文件的部分写锁）</li>
<li>W：for a write lock on the entire file;（整个文件的写锁）</li>
<li>u：for a read and write lock of any length;</li>
<li>U：for a lock of unknown type;</li>
<li>x：for an SCO OpenServer Xenix lock on part      of the file;</li>
<li>X：for an SCO OpenServer Xenix lock on the      entire file;</li>
<li>space：if there is no lock.</li>
</ol>
<h4 id="Type-文件类型"><a href="#Type-文件类型" class="headerlink" title="Type 文件类型"></a>Type 文件类型</h4><ol>
<li>DIR：表示目录。</li>
<li>CHR：表示字符类型。</li>
<li>BLK：块设备类型。</li>
<li>UNIX： UNIX 域套接字。</li>
<li>FIFO：先进先出 (FIFO) 队列。</li>
<li>IPv4：网际协议 (IP) 套接字。</li>
<li>DEVICE：指定磁盘的名称</li>
<li>SIZE：文件的大小</li>
<li>NODE：索引节点（文件在磁盘上的标识）</li>
<li>NAME：打开文件的确切名称</li>
</ol>
<h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lsof abc.txt        显示开启文件abc.txt的进程</span><br><span class="line">lsof -c abc         显示abc进程现在打开的文件</span><br><span class="line">lsof -c -p 1234  	列出进程号为1234的进程所打开的文件</span><br><span class="line">lsof -g gid         显示归属gid的进程情况</span><br><span class="line">lsof +d /usr/local/ 显示目录下被进程开启的文件</span><br><span class="line">lsof +D /usr/local/ 同上，但是会搜索目录下的目录，时间较长</span><br><span class="line">lsof -d 4           显示使用fd为4的进程</span><br><span class="line">lsof -i             用以显示符合条件的进程情况</span><br></pre></td></tr></table></figure>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h4 id="例子1：查看打开文件-dev-ptmx的进程"><a href="#例子1：查看打开文件-dev-ptmx的进程" class="headerlink" title="例子1：查看打开文件/dev/ptmx的进程"></a>例子1：查看打开文件/dev/ptmx的进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lsof /dev/ptmx</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd    93683 root    8u   CHR    5,2      0t0 2205 /dev/ptmx</span><br><span class="line">sshd    93683 root   12u   CHR    5,2      0t0 2205 /dev/ptmx</span><br><span class="line">sshd    93683 root   13u   CHR    5,2      0t0 2205 /dev/ptmx</span><br><span class="line">sshd    94159 root    8u   CHR    5,2      0t0 2205 /dev/ptmx</span><br><span class="line">sshd    94159 root   12u   CHR    5,2      0t0 2205 /dev/ptmx</span><br><span class="line">sshd    94159 root   13u   CHR    5,2      0t0 2205 /dev/ptmx</span><br></pre></td></tr></table></figure>
<h4 id="例子2：查看sshd进程现在打开的文件"><a href="#例子2：查看sshd进程现在打开的文件" class="headerlink" title="例子2：查看sshd进程现在打开的文件"></a>例子2：查看sshd进程现在打开的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lsof -c sshd 	<span class="comment"># 省略部分内容</span></span></span><br><span class="line">COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">sshd     1152 root  cwd    DIR                8,1     4096         64 /</span><br><span class="line">sshd     1152 root  rtd    DIR                8,1     4096         64 /</span><br><span class="line">sshd     1152 root  txt    REG                8,1   819640 1610900074 /usr/sbin/sshd</span><br><span class="line">sshd     1152 root  mem    REG                8,1    62184 1610613964 /usr/lib64/libnss_files-2.17.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1    44448 1610613976 /usr/lib64/librt-2.17.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1    15688 1610614632 /usr/lib64/libkeyutils.so.1.5</span><br><span class="line">sshd     1152 root  mem    REG                8,1    62744 1610615760 /usr/lib64/libkrb5support.so.0.1</span><br><span class="line">sshd     1152 root  mem    REG                8,1    11384 1610613937 /usr/lib64/libfreebl3.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   144792 1610613972 /usr/lib64/libpthread-2.17.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   251784 1610614159 /usr/lib64/libnspr4.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1    20016 1610614160 /usr/lib64/libplc4.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1    15768 1610614161 /usr/lib64/libplds4.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   182056 1610614181 /usr/lib64/libnssutil3.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1  1220240 1610616512 /usr/lib64/libnss3.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   164048 1610616514 /usr/lib64/libsmime3.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   276752 1610616515 /usr/lib64/libssl3.so</span><br><span class="line">sshd     1152 root  mem    REG                8,1   121296 1610614418 /usr/lib64/libsasl2.so.3.0.0</span><br><span class="line">sshd     1152 root  mem    REG                8,1   398264 1610614127 /usr/lib64/libpcre.so.1.2.0</span><br><span class="line">sshd     1152 root  mem    REG                8,1  2173512 1610613946 /usr/lib64/libc-2.17.so</span><br></pre></td></tr></table></figure>
<h4 id="例子3：进程ID为66634的进程打开的文件"><a href="#例子3：进程ID为66634的进程打开的文件" class="headerlink" title="例子3：进程ID为66634的进程打开的文件"></a>例子3：进程ID为66634的进程打开的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lsof -p 66634		<span class="comment"># 省略部分内容</span></span></span><br><span class="line">COMMAND    PID       USER   FD   TYPE DEVICE SIZE/OFF       NODE NAME</span><br><span class="line">postgres 66634 dockerroot  cwd    DIR    8,1      336 1081807351 /var/opt/gitlab/postgresql/data</span><br><span class="line">postgres 66634 dockerroot  rtd    DIR  253,8      271        131 /</span><br><span class="line">postgres 66634 dockerroot  txt    REG  253,8  6129408   12591732 /opt/gitlab/embedded/bin/postgres</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            20971665 /usr/lib/locale/C.UTF-8/LC_CTYPE (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680285 /lib/x86_64-linux-gnu/libnss_nis-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680275 /lib/x86_64-linux-gnu/libnsl-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680277 /lib/x86_64-linux-gnu/libnss_compat-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680281 /lib/x86_64-linux-gnu/libnss_files-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  DEL    REG    0,4                   0 /SYSV0052e2c1</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            25336929 /opt/gitlab/embedded/lib/libz.so.1.2.8 (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680232 /lib/x86_64-linux-gnu/libc-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680264 /lib/x86_64-linux-gnu/libm-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680245 /lib/x86_64-linux-gnu/libdl-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            25336717 /opt/gitlab/embedded/lib/libcrypto.so.1.0.0 (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            25336894 /opt/gitlab/embedded/lib/libssl.so.1.0.0 (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            14680212 /lib/x86_64-linux-gnu/ld-2.23.so (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            31457714 /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot  mem    REG  253,8            20971664 /usr/lib/locale/C.UTF-8/LC_COLLATE (stat: No such file or directory)</span><br><span class="line">postgres 66634 dockerroot    0r   CHR    1,3      0t0     135271 /dev/null</span><br><span class="line">postgres 66634 dockerroot    1w  FIFO    0,8      0t0     137619 pipe</span><br><span class="line">postgres 66634 dockerroot    2w  FIFO    0,8      0t0     137619 pipe</span><br><span class="line">postgres 66634 dockerroot    3r  FIFO    0,8      0t0     299401 pipe</span><br><span class="line">postgres 66634 dockerroot    4r  FIFO    0,8      0t0     118423 pipe</span><br><span class="line">postgres 66634 dockerroot    5w  FIFO    0,8      0t0     299401 pipe</span><br><span class="line">postgres 66634 dockerroot    6u  sock    0,7      0t0     118429 protocol: UDPv6</span><br><span class="line">postgres 66634 dockerroot    7u  sock    0,7      0t0     293411 protocol: UNIX</span><br></pre></td></tr></table></figure>
<h4 id="例子4：显示-root-目录下被进程开启的文件"><a href="#例子4：显示-root-目录下被进程开启的文件" class="headerlink" title="例子4：显示/root/目录下被进程开启的文件"></a>例子4：显示/root/目录下被进程开启的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lsof +d /root</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF      NODE NAME</span><br><span class="line">bash    93685 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">bash    94162 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">lsof    95589 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">lsof    95590 root  cwd    DIR    8,1     4096 536870977 /root</span><br></pre></td></tr></table></figure>
<h4 id="例子5：显示-root-目录下被进程开启的文件，并搜索子目录"><a href="#例子5：显示-root-目录下被进程开启的文件，并搜索子目录" class="headerlink" title="例子5：显示/root/目录下被进程开启的文件，并搜索子目录"></a>例子5：显示/root/目录下被进程开启的文件，并搜索子目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lsof +D /root		<span class="comment"># 结果和上一例子是相同的，说明子目录没有被进程打开</span></span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF      NODE NAME</span><br><span class="line">bash    93685 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">bash    94162 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">lsof    95817 root  cwd    DIR    8,1     4096 536870977 /root</span><br><span class="line">lsof    95818 root  cwd    DIR    8,1     4096 536870977 /root</span><br></pre></td></tr></table></figure>
<h4 id="例子6：显示使用fd为5的所有进程"><a href="#例子6：显示使用fd为5的所有进程" class="headerlink" title="例子6：显示使用fd为5的所有进程"></a>例子6：显示使用fd为5的所有进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# lsof -d 5 # 省略部分内容</span><br><span class="line">COMMAND     PID              USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME</span><br><span class="line">systemd       1              root    5u  a_inode                0,9         0       9542 [signalfd]</span><br><span class="line">systemd-j   561              root    5u     unix 0xffff880501fea800       0t0      12311 /dev/log</span><br><span class="line">systemd-u   587              root    5u     unix 0xffff88046bf22000       0t0        136 socket</span><br><span class="line">auditd      755              root    5w      REG                8,1   3071918 1627909544 /var/log/audit/audit.log</span><br><span class="line">systemd-l   774              root    5u  a_inode                0,9         0       9542 [timerfd]</span><br><span class="line">polkitd     778           polkitd    5u  a_inode                0,9         0       9542 [eventfd]</span><br><span class="line">dbus-daem   781              dbus    5r  a_inode                0,9         0       9542 inotify</span><br><span class="line">NetworkMa   787              root    5u     unix 0xffff8805019f3000       0t0      23807 socket</span><br><span class="line">crond       791              root    5r  a_inode                0,9         0       9542 inotify</span><br><span class="line">rsyslogd   1148              root    5r      REG                8,1 109051904         96 /var/log/journal/2e9445f24525466890b87374d0d87946/system@5d5f6d43ac86417da47c5f1b01f0c71a-0000000000000001-00056e</span><br><span class="line">44cfe98139.journaltuned      1149              root    5u     unix 0xffff88018156d000       0t0      19723 socket</span><br><span class="line">dockerd-c  1150              root    5u  a_inode                0,9         0       9542 [eventpoll]</span><br><span class="line">master     1295              root    5r     FIFO                0,8       0t0      34537 pipe</span><br><span class="line">qmgr       1297           postfix    5u     unix 0xffff88086ac39c00       0t0      34473 socket</span><br><span class="line">docker-co  1298              root    5u     unix 0xffff88086bbf6400       0t0      34542 /var/run/docker/libcontainerd/docker-containerd.sock</span><br><span class="line">docker-pr  1546              root    5u  a_inode                0,9         0       9542 [eventpoll]</span><br><span class="line">docker-co  1561              root    5w     FIFO               0,19       0t0      36486 /run/docker/libcontainerd/containerd/d8221bbb81e7e805180f85b696638c0da6d3bc7de47e7528b407ec7f8216fe49/init/exit</span><br><span class="line">nginx      1597              root    5w     FIFO                0,8       0t0      36496 pipe</span><br><span class="line">docker-pr  1702              root    5u  a_inode                0,9         0       9542 [eventpoll]</span><br></pre></td></tr></table></figure>
<h3 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h3><p><a href="https://blog.csdn.net/Linux_ever/article/details/50789199" target="_blank" rel="noopener">CSDN：lsof命令详解</a></p>
<p><a href="http://man.linuxde.net/lsof" target="_blank" rel="noopener">Linux命令大全：lsof命令</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>