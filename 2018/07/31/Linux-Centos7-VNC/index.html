<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>CentOS 7 配置 VNC | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/运维常见问题/">运维常见问题</a></div><div class="post-time">2018-07-31</div></div></div><div class="container post-header"><h1>CentOS 7 配置 VNC</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装GNOME-Desktop"><span class="toc-number">1.</span> <span class="toc-text">安装GNOME Desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装VNC-Server"><span class="toc-number">2.</span> <span class="toc-text">安装VNC Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-VNC-Server"><span class="toc-number">3.</span> <span class="toc-text">配置 VNC Server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#复制模板配置文件"><span class="toc-number">3.1.</span> <span class="toc-text">复制模板配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改配置，将里边的替换为用户名，我这里是haiyun："><span class="toc-number">3.2.</span> <span class="toc-text">修改配置，将里边的替换为用户名，我这里是haiyun：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重启-systemd"><span class="toc-number">3.3.</span> <span class="toc-text">重启 systemd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置密码"><span class="toc-number">3.4.</span> <span class="toc-text">设置密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置开机自启动"><span class="toc-number">3.5.</span> <span class="toc-text">设置开机自启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动服务并查看服务状态"><span class="toc-number">3.6.</span> <span class="toc-text">启动服务并查看服务状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常见问题解决"><span class="toc-number">4.</span> <span class="toc-text">常见问题解决</span></a></li></ol></details></div><div class="container post-content"><h3 id="安装GNOME-Desktop"><a href="#安装GNOME-Desktop" class="headerlink" title="安装GNOME Desktop"></a>安装GNOME Desktop</h3><a id="more"></a>
<p>首先，我们需要一个可用的桌面环境（GNOME Desktop），如果没有的话要先安装一个。如果有这一步骤可以跳过！<br>下面命令需要在root权限下执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum groupinstall  &quot;GNOME Desktop&quot;</span><br></pre></td></tr></table></figure>
<h3 id="安装VNC-Server"><a href="#安装VNC-Server" class="headerlink" title="安装VNC Server"></a>安装VNC Server</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install tigervnc-server</span><br></pre></td></tr></table></figure>
<h3 id="配置-VNC-Server"><a href="#配置-VNC-Server" class="headerlink" title="配置 VNC Server"></a>配置 VNC Server</h3><p>然后对VNC进行配置：<br>我们可以打开/lib/systemd/system/vncserver@.service，这个文件看一下，里边有个Quick HowTo </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Quick HowTo:</span><br><span class="line"># 1. Copy this file to /etc/systemd/system/vncserver@.service</span><br><span class="line"># 2. Replace &lt;USER&gt; with the actual user name and edit vncserver</span><br><span class="line">#    parameters appropriately</span><br><span class="line">#    (ExecStart=/usr/sbin/runuser -l &lt;USER&gt; -c &quot;/usr/bin/vncserver %i&quot;</span><br><span class="line">#     PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid)</span><br><span class="line"># 3. Run `systemctl daemon-reload`</span><br><span class="line"># 4. Run `systemctl enable vncserver@:&lt;display&gt;.service`</span><br></pre></td></tr></table></figure>
<p>按照执行:</p>
<h4 id="复制模板配置文件"><a href="#复制模板配置文件" class="headerlink" title="复制模板配置文件"></a>复制模板配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /lib/systemd/system/vncserver@.service /lib/systemd/system/vncserver@:1.service</span><br></pre></td></tr></table></figure>
<h4 id="修改配置，将里边的替换为用户名，我这里是haiyun："><a href="#修改配置，将里边的替换为用户名，我这里是haiyun：" class="headerlink" title="修改配置，将里边的替换为用户名，我这里是haiyun："></a>修改配置，将里边的<user>替换为用户名，我这里是haiyun：</user></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vim /lib/systemd/system/vncserver@:1.service</span><br><span class="line">ExecStart=/usr/sbin/runuser -l root -c &quot;/usr/bin/vncserver %i&quot;</span><br><span class="line">PIDFile=/home/root/.vnc/%H%i.pid</span><br></pre></td></tr></table></figure>
<h4 id="重启-systemd"><a href="#重启-systemd" class="headerlink" title="重启 systemd"></a>重启 systemd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload</span><br></pre></td></tr></table></figure>
<h4 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h4><p>为haiyun设置登录密码，因为当前是root用户下，所以要切换到haiyun用户权限下进行设置。</p>
<p>先为root用户设置vnc password。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vncpasswd</span><br></pre></td></tr></table></figure>
<h4 id="设置开机自启动"><a href="#设置开机自启动" class="headerlink" title="设置开机自启动"></a>设置开机自启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable vncserver@:1.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vncserver@:1.service to /usr/lib/systemd/system/vncserver@:1.service.</span><br></pre></td></tr></table></figure>
<h4 id="启动服务并查看服务状态"><a href="#启动服务并查看服务状态" class="headerlink" title="启动服务并查看服务状态"></a>启动服务并查看服务状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start vncserver@:1.service 		# 启动服务</span><br><span class="line"># systemctl status vncserver@:1.service 	# 查看服务状态</span><br><span class="line">● vncserver@:1.service - Remote desktop service (VNC)</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/vncserver@:1.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 二 2018-07-31 11:13:37 CST; 4s ago</span><br><span class="line">  Process: 5405 ExecStart=/usr/sbin/runuser -l root -c /usr/bin/vncserver %i (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 5401 ExecStartPre=/bin/sh -c /usr/bin/vncserver -kill %i &gt; /dev/null 2&gt;&amp;1 || : (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 5424 (Xvnc)</span><br><span class="line">   CGroup: /system.slice/system-vncserver.slice/vncserver@:1.service</span><br><span class="line">           ‣ 5424 /usr/bin/Xvnc :1 -auth /root/.Xauthority -desktop localhost.localdomain:1 (root) -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn -rfbauth /root/.vnc/passwd -rfbport 5901 -r...</span><br><span class="line"></span><br><span class="line">7月 31 11:13:34 localhost.localdomain systemd[1]: Starting Remote desktop service (VNC)...</span><br><span class="line">7月 31 11:13:37 localhost.localdomain systemd[1]: Started Remote desktop service (VNC).</span><br></pre></td></tr></table></figure>
<h3 id="常见问题解决"><a href="#常见问题解决" class="headerlink" title="常见问题解决"></a>常见问题解决</h3><p>如果默认字体为中文，连接VNC可能会出现乱码问题，解决方法：改用英文字体就好了呀。哈哈。^_^</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/locale.conf&#123;,.bak&#125;  	# 修改之前可以备份一下</span><br><span class="line"></span><br><span class="line"># echo &apos;LANG=&quot;en_US.UTF-8&quot;&apos; &gt; /etc/locale.conf</span><br><span class="line"></span><br><span class="line"># cat /etc/locale.conf</span><br><span class="line">LANG=&quot;en_US.UTF-8&quot;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>