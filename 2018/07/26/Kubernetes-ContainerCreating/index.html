<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Kubernetes创建容器状态一直为ContainerCreating问题排查 | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Kubernetes/">Kubernetes</a></div><div class="post-time">2018-07-26</div></div></div><div class="container post-header"><h1>Kubernetes创建容器状态一直为ContainerCreating问题排查</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题简介"><span class="toc-number">1.</span> <span class="toc-text">问题简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题排查与解决"><span class="toc-number">2.</span> <span class="toc-text">问题排查与解决</span></a></li></ol></details></div><div class="container post-content"><h3 id="问题简介"><a href="#问题简介" class="headerlink" title="问题简介"></a>问题简介</h3><a id="more"></a>
<p>上一节中做实验出现了运行Pod时，状态一直是 ContainerCreating ，等待很长时间还是 ContainerCreating。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# kubectl get pod</span><br><span class="line">NAME          READY     STATUS              RESTARTS   AGE</span><br><span class="line">mysql-v439c   0/1       ContainerCreating   0          29m</span><br></pre></td></tr></table></figure>
<h3 id="问题排查与解决"><a href="#问题排查与解决" class="headerlink" title="问题排查与解决"></a>问题排查与解决</h3><p>查看 pod 的详细信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> kubectl describe pod  mysql-v439c </span><br><span class="line">Name:		mysql-v439c</span><br><span class="line">Namespace:	default</span><br><span class="line">Node:		127.0.0.1/127.0.0.1</span><br><span class="line">Start Time:	Thu, 26 Jul 2018 16:27:02 +0800</span><br><span class="line">Labels:		app=mysql</span><br><span class="line">Status:		Pending</span><br><span class="line">IP:		</span><br><span class="line">Controllers:	ReplicationController/mysql</span><br><span class="line">Containers:</span><br><span class="line">  mysql:</span><br><span class="line">    Container ID:	</span><br><span class="line">    Image:		mysql</span><br><span class="line">    Image ID:		</span><br><span class="line">    Port:		3306/TCP</span><br><span class="line">    State:		Waiting</span><br><span class="line">      Reason:		ContainerCreating</span><br><span class="line">    Ready:		False</span><br><span class="line">    Restart Count:	0</span><br><span class="line">    Volume Mounts:	&lt;none&gt;</span><br><span class="line">    Environment Variables:</span><br><span class="line">      MYSQL_ROOT_PASSWD:	123456</span><br><span class="line">Conditions:</span><br><span class="line">  Type		Status</span><br><span class="line">  Initialized 	True </span><br><span class="line">  Ready 	False </span><br><span class="line">  PodScheduled 	True </span><br><span class="line">No volumes.</span><br><span class="line">QoS Class:	BestEffort</span><br><span class="line">Tolerations:	&lt;none&gt;</span><br><span class="line">Events:</span><br><span class="line">  FirstSeen	LastSeen	Count	From			SubObjectPath	Type		Reason		Message</span><br><span class="line">  ---------	--------	-----	----			-------------	--------	------		-------</span><br><span class="line">  30m		30m		1	&#123;default-scheduler &#125;			Normal		Scheduled	Successfully assigned mysql-v439c to 127.0.0.1</span><br><span class="line">  30m		4m		10	&#123;kubelet 127.0.0.1&#125;			Warning		FailedSync	Error syncing pod, skipping: failed to "StartContainer" for "POD" with ErrImagePull: "imag</span><br><span class="line">e pull failed for registry.access.redhat.com/rhel7/pod-infrastructure:latest, this may be because there are no credentials on this request.  details: (open /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt: no such file or directory)"	# 错误在此处</span><br><span class="line">  30m	13s	133	&#123;kubelet 127.0.0.1&#125;		Warning	FailedSync	Error syncing pod, skipping: failed to "StartContainer" for "POD" with ImagePullBackOff: "Back-off pulling image \"registr</span><br><span class="line">y.access.redhat.com/rhel7/pod-infrastructure:latest\""</span><br></pre></td></tr></table></figure>
<p>可以看出错误在拉取镜像 registry.access.redhat.com/rhel7/pod-infrastructure:latest 失败，因为没有 /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt 没有这个CA文件。</p>
<p>我们先查看此文件是否存在：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ll /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt 		# 可以看到文件是软链接</span><br><span class="line">lrwxrwxrwx 1 root root 27 Jul 26 14:42 /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt -&gt; /etc/rhsm/ca/redhat-uep.pem</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ll /etc/rhsm/ca/redhat-uep.pem		# 我们查看此软链接，是不存在的</span><br><span class="line">ls: cannot access /etc/rhsm/ca/redhat-uep.pem: No such file or directory</span><br></pre></td></tr></table></figure>
<p>目前已经证实了 CA 文件 确实是不存在的，我们接下来需要做的就是找到或安装这个CA文件。可以看到链接的目录是rhsm，接下来我们查看以下是否有这个软件包。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> yum list | grep rhsm</span><br><span class="line">subscription-manager-rhsm-certificates.x86_64</span><br><span class="line">python-rhsm.x86_64                        1.19.10-1.el7_4                base   </span><br><span class="line">python-rhsm-certificates.x86_64           1.19.10-1.el7_4                base   </span><br><span class="line">subscription-manager-rhsm.x86_64          1.20.11-1.el7.centos           base</span><br></pre></td></tr></table></figure>
<p>安装这些rpm包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y *rhsm*</span><br><span class="line"># ll /etc/rhsm/ca/redhat-uep.pem		# 再次验证依然是不存在的</span><br><span class="line">ls: cannot access /etc/rhsm/ca/redhat-uep.pem: No such file or directory</span><br></pre></td></tr></table></figure>
<p>谷歌搜索到，可以通过如下操作来生成pem文件，原文地址：<a href="https://blog.csdn.net/lileihappy/article/details/80444192" target="_blank" rel="noopener">https://blog.csdn.net/lileihappy/article/details/80444192</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> #</span> wget http://mirror.centos.org/centos/7/os/x86_64/Packages/python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm		# 先把这个rpm下载到本地</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span> rpm2cpio python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm | cpio -iv --to-stdout /etc/rhsm/ca/redhat-uep.pem | tee /etc/rhsm/ca/redhat-uep.pem		# 接着通过rpm2cpio将rpm包转换成为cpio格式的文件，转完成后，然后解压并提取到标准输出，最后通过tee将标准输出重定向到文件</span><br></pre></td></tr></table></figure>
<p>上面的解决方法貌似还不错，小编也已经对命令进行了解析。python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm 这个 rpm 包里面就存放了 redhat-uep.pem ，上面所执行的命令，只是为了将此文件提取出来。</p>
<p>接着我们拉取镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># docker pull registry.access.redhat.com/rhel7/pod-infrastructure:latest	</span><br><span class="line">Trying to pull repository registry.access.redhat.com/rhel7/pod-infrastructure ... </span><br><span class="line">Get https://registry.access.redhat.com/v2/rhel7/pod-infrastructure/manifests/latest: dial tcp 209.132.182.63:443: getsockopt: connection refused</span><br></pre></td></tr></table></figure>
<p>拉取镜像可能回报如上错误，建议大家翻墙拉取吧，哈哈，^_^。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>