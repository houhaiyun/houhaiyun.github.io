<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Docker数据卷 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Docker/">Docker</a></div><div class="post-time">2018-07-21</div></div></div><div class="container post-header"><h1>Docker数据卷</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#容器存储数据存在的问题"><span class="toc-number">1.</span> <span class="toc-text">容器存储数据存在的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#由docker管理的卷"><span class="toc-number">2.</span> <span class="toc-text">由docker管理的卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#清理未使用的卷"><span class="toc-number">3.</span> <span class="toc-text">清理未使用的卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义卷"><span class="toc-number">4.</span> <span class="toc-text">自定义卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意"><span class="toc-number">5.</span> <span class="toc-text">注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#共享卷"><span class="toc-number">6.</span> <span class="toc-text">共享卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多个容器的卷使用同一个主机目录"><span class="toc-number">7.</span> <span class="toc-text">多个容器的卷使用同一个主机目录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#复制其它容器的卷实现共享卷"><span class="toc-number">7.1.</span> <span class="toc-text">复制其它容器的卷实现共享卷</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#挂载多个卷"><span class="toc-number">8.</span> <span class="toc-text">挂载多个卷</span></a></li></ol></details></div><div class="container post-content"><h3 id="容器存储数据存在的问题"><a href="#容器存储数据存在的问题" class="headerlink" title="容器存储数据存在的问题"></a>容器存储数据存在的问题</h3><p>关闭并重启容器，其数据不受影响；但删除容器，则其更改的数据将会全部丢失；</p>
<p>存在的问题：</p>
<ol>
<li>存储于联合文件系统中，不易于宿主机的访问；</li>
<li>容器间数据共享不便；</li>
<li>删除容器其数据会丢失；</li>
</ol>
<a id="more"></a>
<h3 id="由docker管理的卷"><a href="#由docker管理的卷" class="headerlink" title="由docker管理的卷"></a>由docker管理的卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# docker run -it --name b1 -v /data/ --rm busybox:1.27.2    # 运行一个容器，-v代表指定容器b1卷的路径；</span><br><span class="line">/ # ls /        # 列出根目录下的所有目录，已经有data目录；</span><br><span class="line">bin   data  dev   etc   home  proc  root  sys   tmp   usr   var</span><br><span class="line">/ # echo &quot;Test...&quot; &gt; /data/test     # 编写测试文件；</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker inspect b1 | grep -A 10 Mounts     # 查看容器b1的详细信息，并把Mounts信息显示出来；</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;0804f6b61524c3bdc4feb07cf1882e4f8901b43d20444cf34d5ae78caa9847ed&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/0804f6b61524c3bdc4feb07cf1882e4f8901b43d20444cf34d5ae78caa9847ed/_data&quot;,     # 此路径为宿主机所对应的真实路径；</span><br><span class="line">                &quot;Destination&quot;: &quot;/data&quot;,     # 容器内的卷；</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,  </span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# cat /var/lib/docker/volumes/0804f6b61524c3bdc4feb07cf1882e4f8901b43d20444cf34d5ae78caa9847ed/_data/test       # 查看宿主机目录下的test文件，已经存在；</span><br><span class="line">Test...</span><br><span class="line">[root@centos7 ~]# docker volume ls      # 列出当前主机所有的卷；</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               0804f6b61524c3bdc4feb07cf1882e4f8901b43d20444cf34d5ae78caa9847ed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# cd /var/lib/docker/volumes/0804f6b61524c3bdc4feb07cf1882e4f8901b43d20444cf34d5ae78caa9847ed/_data/        # 进入此目录；</span><br><span class="line">[root@centos7 _data]# ls</span><br><span class="line">test</span><br><span class="line">[root@centos7 _data]# echo &quot;hello...&quot; &gt; test2       # echo一个文件；</span><br><span class="line">[root@centos7 _data]# ls</span><br><span class="line">test  test2</span><br><span class="line"></span><br><span class="line"># 切换到容器内部：</span><br><span class="line">/ # ls /data/       # 列出data目录，test2文件已经存在；</span><br><span class="line">test   test2</span><br><span class="line">/ # cat /data/test2     # cat此文件内容和宿主机上面的内容是一摸一样的；</span><br><span class="line">hello...</span><br></pre></td></tr></table></figure>
<h3 id="清理未使用的卷"><a href="#清理未使用的卷" class="headerlink" title="清理未使用的卷"></a>清理未使用的卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 _data]# docker volume prune </span><br><span class="line">WARNING! This will remove all volumes not used by at least one container.</span><br><span class="line">Are you sure you want to continue? [y/N] y</span><br><span class="line">Total reclaimed space: 0B</span><br></pre></td></tr></table></figure>
<h3 id="自定义卷"><a href="#自定义卷" class="headerlink" title="自定义卷"></a>自定义卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# mkdir -pv  /docker/data/volumes/b1        # 在宿主机上面创建关联到容器上面的卷的目录；</span><br><span class="line">mkdir: created directory ‘/docker’</span><br><span class="line">mkdir: created directory ‘/docker/data’</span><br><span class="line">mkdir: created directory ‘/docker/data/volumes’</span><br><span class="line">mkdir: created directory ‘/docker/data/volumes/b1’</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker run -it --name b1 -v /docker/data/volumes/b1/:/data --rm busybox:1.27.2        # 运行容器，-v先指定宿主机的目录:容器内的卷；</span><br><span class="line">/ # ls /</span><br><span class="line">bin   data  dev   etc   home  proc  root  sys   tmp   usr   var</span><br><span class="line">/ # touch /data/test.txt        # 创建测试文件；</span><br><span class="line">/ # ls /data/</span><br><span class="line">test.txt</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker inspect b1 | grep -A 10 Mounts     # 查看Mounts信息；</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/docker/data/volumes/b1&quot;,        # 宿主济的目录；</span><br><span class="line">                &quot;Destination&quot;: &quot;/data&quot;,         # 容器内的目录；</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">[root@centos7 ~]# ls /docker/data/volumes/b1/       # 文件已经存在；</span><br><span class="line">test.txt</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# touch /docker/data/volumes/b1/tset2       # 宿主机创建test2文件；</span><br><span class="line">[root@centos7 ~]# ls /docker/data/volumes/b1/</span><br><span class="line">test.txt  tset2</span><br><span class="line"></span><br><span class="line"># 切换回容器</span><br><span class="line">/ # ls /data/       # test2文件已经存在；</span><br><span class="line">test.txt  tset2</span><br></pre></td></tr></table></figure>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>情况一：如果宿主机要挂载的目录存在文件，那么会出现什么情况？<ul>
<li>在容器内是可以看到宿主济已经存在的文件。</li>
</ul>
</li>
<li>情况一：如果容器内的目录(就是卷)存在且有文件，那么会出现什么情况？<ul>
<li>容器内的目录内的数据将会被隐藏。</li>
</ul>
</li>
<li>情况三：如果容器内的目录(就是卷)存在且有文件，且宿主机要挂载的目录也存在文件，那么会出现什么情况？<ul>
<li>容器目录内的数据会被隐藏，宿主机目录内的数据将会被显示。</li>
</ul>
</li>
</ul>
<h3 id="共享卷"><a href="#共享卷" class="headerlink" title="共享卷"></a>共享卷</h3><h3 id="多个容器的卷使用同一个主机目录"><a href="#多个容器的卷使用同一个主机目录" class="headerlink" title="多个容器的卷使用同一个主机目录"></a>多个容器的卷使用同一个主机目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# docker run -it --name b1 -v /docker/data/volumes/b1/:/data --rm busybox:1.27.2        # 运行容器指定宿主机的目录为：/docker/data/volumes/b1/；</span><br><span class="line">/ # ls /data/</span><br><span class="line">test.txt  tset2</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker run -it --name b2 -v /docker/data/volumes/b1/:/data --rm busybox:1.27.2        # 运行容器指定宿主机的目录也为：/docker/data/volumes/b1/；</span><br><span class="line">/ # ls /data        # 数据是相同的；</span><br><span class="line">test.txt  tset2</span><br><span class="line"></span><br><span class="line"># 容器b1操作</span><br><span class="line">/ # touch /data/test3       # 在b1创建test3；</span><br><span class="line">/ # ls /data/</span><br><span class="line">test.txt  test3     tset2</span><br><span class="line"></span><br><span class="line"># 容器b2操作</span><br><span class="line">/ # ls /data/           # 在b2也是可以看到的；</span><br><span class="line">test.txt  test3     tset2</span><br></pre></td></tr></table></figure>
<h4 id="复制其它容器的卷实现共享卷"><a href="#复制其它容器的卷实现共享卷" class="headerlink" title="复制其它容器的卷实现共享卷"></a>复制其它容器的卷实现共享卷</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# docker run -it --name b1 -v /docker/data/volumes/b1/:/data --rm busybox:1.27.2        # 启动第一个容器；</span><br><span class="line">/ # ls /data/</span><br><span class="line">test.txt  test3     tset2</span><br><span class="line">/ # </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker run --name b2 -it --volumes-from b1 busybox:1.27.2         # 启动第二个容器，并指定复制容器b1所有的卷到b2上面；</span><br><span class="line">/ # ls /data/</span><br><span class="line">test.txt  test3     tset2</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>
<h3 id="挂载多个卷"><a href="#挂载多个卷" class="headerlink" title="挂载多个卷"></a>挂载多个卷</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# mkdir /docker/data/volumes/b2</span><br><span class="line">[root@centos7 ~]# docker run -it --name b1 -v /docker/data/volumes/b1/:/data -v /docker/data/volumes/b2/:/test --rm busybox:1.27.2      # 可以挂载多个目录使用-v选项；</span><br><span class="line">/ # ls /</span><br><span class="line">bin   data  dev   etc   home  proc  root  sys   test  tmp   usr   var</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>