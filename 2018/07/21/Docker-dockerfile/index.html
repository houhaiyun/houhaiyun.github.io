<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Dockerfile编写 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Docker/">Docker</a></div><div class="post-time">2018-07-21</div></div></div><div class="container post-header"><h1>Dockerfile编写</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-file指令"><span class="toc-number">2.</span> <span class="toc-text">docker file指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FROM"><span class="toc-number">2.1.</span> <span class="toc-text">FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MAINTAINER"><span class="toc-number">2.2.</span> <span class="toc-text">MAINTAINER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CPOY"><span class="toc-number">2.3.</span> <span class="toc-text">CPOY</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#COPY文件"><span class="toc-number">2.3.1.</span> <span class="toc-text">COPY文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#COPY目录"><span class="toc-number">2.3.2.</span> <span class="toc-text">COPY目录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ADD"><span class="toc-number">2.4.</span> <span class="toc-text">ADD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ADD示例"><span class="toc-number">2.4.1.</span> <span class="toc-text">ADD示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WORKDIR"><span class="toc-number">2.5.</span> <span class="toc-text">WORKDIR</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#示例"><span class="toc-number">2.5.1.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VOLUME"><span class="toc-number">2.6.</span> <span class="toc-text">VOLUME</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#卷示例"><span class="toc-number">2.6.1.</span> <span class="toc-text">卷示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXPOSE"><span class="toc-number">2.7.</span> <span class="toc-text">EXPOSE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#EXPOSE示例"><span class="toc-number">2.7.1.</span> <span class="toc-text">EXPOSE示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENV"><span class="toc-number">2.8.</span> <span class="toc-text">ENV</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ENV示例"><span class="toc-number">2.8.1.</span> <span class="toc-text">ENV示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RUN"><span class="toc-number">2.9.</span> <span class="toc-text">RUN</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RUN示例"><span class="toc-number">2.9.1.</span> <span class="toc-text">RUN示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD"><span class="toc-number">2.10.</span> <span class="toc-text">CMD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CMD示例"><span class="toc-number">2.10.1.</span> <span class="toc-text">CMD示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-number">3.</span> <span class="toc-text">ENTRYPOINT</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ENTRYPOINT示例"><span class="toc-number">3.0.1.</span> <span class="toc-text">ENTRYPOINT示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USER"><span class="toc-number">3.1.</span> <span class="toc-text">USER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ONBUILD"><span class="toc-number">3.2.</span> <span class="toc-text">ONBUILD</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#致谢"><span class="toc-number">4.</span> <span class="toc-text">致谢</span></a></li></ol></details></div><div class="container post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Dockfile是一种被Docker程序解释的脚本，Dockerfile由一条一条的指令组成，每条指令对应Linux下面的一条命令。Docker程序将这些Dockerfile指令翻译真正的Linux命令。Dockerfile有自己书写格式和支持的命令，Docker程序解决这些命令间的依赖关系，类似于Makefile。Docker程序将读取Dockerfile，根据指令生成定制的image。相比image这种黑盒子，Dockerfile这种显而易见的脚本更容易被使用者接受，它明确的表明image是怎么产生的。有了Dockerfile，当我们需要定制自己额外的需求时，只需在Dockerfile上添加或者修改指令，重新生成image即可，省去了敲命令的麻烦。</p>
<a id="more"></a>
<h3 id="docker-file指令"><a href="#docker-file指令" class="headerlink" title="docker file指令"></a>docker file指令</h3><ul>
<li>注意：<ul>
<li><code>#</code>号开头代表注释</li>
<li>指令全部大写(这个是约定俗成的)</li>
<li>第一台非注释指令必须为<code>FROM</code>，类似于shll脚本中的<code>#!/bin/bash</code>机制；</li>
<li>.dockerignore文件中的内容代表不会被打包进镜像</li>
</ul>
</li>
</ul>
<h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><ul>
<li>FROM指令是最重要的一个且必须为Dockerfile文件开篇的第一个非注释行，用于为映像文件构建过程指定基准镜像，后续的指令运行于此基准镜像所提供的运行环境。</li>
<li>实践中，基准镜像可以是任何可用镜像文件，默认情况下，docker build会在docker主机上查找指定的镜像文件，在其不存在时，则会从Docker Hub Registry上拉取所需的镜像文件<ul>
<li>如果找不到指定的镜像文件，docker build会返回一个错误信息</li>
</ul>
</li>
<li>Syntax<ul>
<li>FROM <repository>[:<tag>] 或 FROM　<resository>@<digest><ul>
<li><repository>：指定作为base image的名称；</repository></li>
<li><tag>：base image的标签，为可选项，省略时默认为latest；</tag></li>
</ul>
</digest></resository></tag></repository></li>
</ul>
</li>
</ul>
<h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><ul>
<li>用于让Dockerfile制作者提供本人的详细信息</li>
<li>Dockerfile并不限制MAINTANIER指令可出现的位置，但推荐将其放置于FROM指令之后</li>
<li>Syntax<ul>
<li>MAINTAINER &lt;authtor’s detail&gt;<ul>
<li>&lt;authtor’s detail&gt;可是任何文本信息，但约定俗成地使用作者名称及邮件地址</li>
<li>例如：MAINTAINER “houhaiyun <a href="mailto:&#x68;&#111;&#117;&#95;&#x68;&#x61;&#x69;&#x79;&#117;&#x6e;&#64;&#x77;&#101;&#x69;&#116;&#97;&#99;&#x2e;&#x63;&#111;&#109;" target="_blank" rel="noopener">&#x68;&#111;&#117;&#95;&#x68;&#x61;&#x69;&#x79;&#117;&#x6e;&#64;&#x77;&#101;&#x69;&#116;&#97;&#99;&#x2e;&#x63;&#111;&#109;</a>“</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="CPOY"><a href="#CPOY" class="headerlink" title="CPOY"></a>CPOY</h4><ul>
<li>用于从Docker主机复制文件至创建的新映像文件</li>
<li>COPY <src> … <dest> 或 COPY [“<src>“,…”<dest>“]<ul>
<li><src>：要复制的源文件或目录，支持使用通配符</src></li>
<li><dest>：目标路径，即正在创建的image的文件系统路径；建议为<dest>使用绝对路径，否则，COPY指定则以WORKDIR为起始路径</dest></dest></li>
<li>注意：在路径中有空白字符时，通常使用第二种格式</li>
</ul>
</dest></src></dest></src></li>
<li>文件复制准则<ul>
<li><src>必须是build上下文中的路径，不能是其父目录中的文件</src></li>
<li>如果<src>是目录，则其内部文件或子目录会被递归复制，但<src>目录自身不会被复制</src></src></li>
<li>如果指定了多个<src>，或在<src>中使用了通配符，则<dest>必须是一个目录，且必须以/结尾</dest></src></src></li>
<li>如果<dest>实现不存在，它将会被自动创建，这包括其父目录路径。</dest></li>
</ul>
</li>
</ul>
<h5 id="COPY文件"><a href="#COPY文件" class="headerlink" title="COPY文件"></a>COPY文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# mkdir dockerfile</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# cd dockerfile/</span><br><span class="line">[root@centos7 dockerfile]# echo &quot;test page&quot; &gt; index.html    # 创建测试复制文件；</span><br><span class="line">[root@centos7 dockerfile]# vim Dockerfile       # 注意：文件名必须写为Dockerfile；</span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">COPY index.html /data/</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v1 ./    # -t指定仓库名:标签；</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/3 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/3 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Running in ce681c84aef6</span><br><span class="line">Removing intermediate container ce681c84aef6</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/3 : COPY index.html /data/</span><br><span class="line"> ---&gt; 9fb27d5848c5</span><br><span class="line">Successfully built 9fb27d5848c5</span><br><span class="line">Successfully tagged testimg:v1</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v1                  9fb27d5848c5        33 seconds ago      1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        47 hours ago        1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --name t1 --rm testimg:v1     # 运行容器基于新创建的镜像；</span><br><span class="line">/ # ls /data/</span><br><span class="line">index.html</span><br><span class="line">/ # cat /data/index.html </span><br><span class="line">test page</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>
<h5 id="COPY目录"><a href="#COPY目录" class="headerlink" title="COPY目录"></a>COPY目录</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">COPY index.html /data/</span><br><span class="line">COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# cp -r /etc/yum.repos.d/ ./</span><br><span class="line">[root@centos7 dockerfile]# ls</span><br><span class="line">Dockerfile  index.html  yum.repos.d</span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v2 ./</span><br><span class="line">Sending build context to Docker daemon  22.02kB</span><br><span class="line">Step 1/4 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/4 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/4 : COPY index.html /data/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9fb27d5848c5</span><br><span class="line">Step 4/4 : COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line"> ---&gt; d6885cecd73b</span><br><span class="line">Successfully built d6885cecd73b</span><br><span class="line">Successfully tagged testimg:v2</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v2                  d6885cecd73b        27 seconds ago      1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        9 minutes ago       1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        47 hours ago        1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run --name t1 --rm -it testimg:v2     # 基于新创建的镜像运行容器，ok；</span><br><span class="line">/ # ls /etc/yum.repos.d/</span><br><span class="line">CentOS-Base.repo       CentOS-Debuginfo.repo  CentOS-Sources.repo    CentOS-fasttrack.repo  docker-ce.repo</span><br><span class="line">CentOS-CR.repo         CentOS-Media.repo      CentOS-Vault.repo      backup</span><br></pre></td></tr></table></figure>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><ul>
<li>ADD指令类似于COPY指令，ADD支持使用TAR文件和URL路径</li>
<li>Syntax<ul>
<li>ADD <src>..<dest> 或 ADD [“<src>“,…”<dest>“]</dest></src></dest></src></li>
</ul>
</li>
<li>操作准则<ul>
<li>通COPY指令</li>
<li>如果<src>为URL且<dest>不以/结尾，则<src>指定的文件将被下载并直接被创建为<dest>；如果<dest>以/结尾，则文件名URL指定的文件将被直接下载并保存为<dest>/<filename></filename></dest></dest></dest></src></dest></src></li>
<li>如果<src>是一个本地系统上的压缩格式的tar文件，它将被展开为一个目录，其行为类似于“tar -x”命令；然而，通过URL获取到的tar文件将不会自动展开；</src></li>
<li>如果<src>有多个，或其间接或直接使用了通配符，则<dest>必须是一个以/结尾的目录路径；如果<dest>不以/结尾，则其被视作一个普通文件，<src>的内容将被直接写入到<dest>;</dest></src></dest></dest></src></li>
</ul>
</li>
</ul>
<h5 id="ADD示例"><a href="#ADD示例" class="headerlink" title="ADD示例"></a>ADD示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile</span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">#COPY index.html /data/</span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">ADD http://nginx.org/download/nginx-1.12.2.tar.gz /tmp</span><br><span class="line">ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# tar -zcf all.tar.gz ./*      # 准备tar文件；</span><br><span class="line">[root@centos7 dockerfile]# ls</span><br><span class="line">all.tar.gz  Dockerfile  index.html  yum.repos.d</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build  -t testimg:v3 ./       # 构建镜像；</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/4 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/4 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/4 : ADD http://nginx.org/download/nginx-1.12.2.tar.gz /tmp</span><br><span class="line">Downloading [==================================================&gt;]  981.7kB/981.7kB</span><br><span class="line"> ---&gt; e35ddcb1f8dc</span><br><span class="line">Step 4/4 : ADD all.tar.gz /usr/src/</span><br><span class="line"> ---&gt; 621f6100c2c6</span><br><span class="line">Successfully built 621f6100c2c6</span><br><span class="line">Successfully tagged testimg:v3</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v3                  621f6100c2c6        32 seconds ago      2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        22 minutes ago      1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        31 minutes ago      1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        2 days ago          1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --rm --name t1 testimg:v3     # ok，成功；</span><br><span class="line">/ # ls /usr/src</span><br><span class="line">Dockerfile   index.html   yum.repos.d</span><br><span class="line">/ # ls /tmp/</span><br><span class="line">nginx-1.12.2.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><ul>
<li>用于为Dockerfile中所有的RUN、CMD、ENTRYPOINT、COPY和ADD指定设定工作目录</li>
<li>Syntax<ul>
<li>WORKDIR <dirpath><ul>
<li>在Dockerfile文件中，WORKDIR指令可出现多次，其路径可以为相对路径，不过，其是相对此前一个WORKDIR指令指定的路径</li>
<li>另外，WORKDIR也可以调用由ENV指定定义的变量</li>
</ul>
</dirpath></li>
<li>例如<ul>
<li>WORKDIR /var/log</li>
<li>WORKDIR $STATEPATH</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# cat Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line">WORKDIR /tmp</span><br><span class="line">#COPY index.html /data/</span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v4 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/4 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/4 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/4 : WORKDIR /tmp</span><br><span class="line">Removing intermediate container e7d4b6320bc7</span><br><span class="line"> ---&gt; 75588fa14579</span><br><span class="line">Step 4/4 : ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">Downloading [==================================================&gt;]  981.7kB/981.7kB</span><br><span class="line"> ---&gt; 9b2844373a64</span><br><span class="line">Successfully built 9b2844373a64</span><br><span class="line">Successfully tagged testimg:v4</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images </span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v4                  9b2844373a64        17 seconds ago      2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        23 minutes ago      2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        44 minutes ago      1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        About an hour ago   1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        2 days ago          1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --rm --name t1 testimg:v4     # ok，成功；</span><br><span class="line">/tmp # ls /tmp/</span><br><span class="line">nginx-1.12.2.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><ul>
<li>用于在image中创建一个挂载点目录，以挂载Docker host上的卷或其它容器上的卷</li>
<li>Syntax<ul>
<li>VOLUME <mountpoint> 或 VOLUME [“<mountpoint>“]</mountpoint></mountpoint></li>
</ul>
</li>
<li>如果挂载点目录路径下此前在文件存在，docker run命令会在卷挂载完成后将此前的所有文件复制到新挂载的卷中</li>
</ul>
<h5 id="卷示例"><a href="#卷示例" class="headerlink" title="卷示例"></a>卷示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">WORKDIR /tmp</span><br><span class="line"></span><br><span class="line">VOLUME &quot;/data/&quot;</span><br><span class="line"></span><br><span class="line">COPY index.html ./</span><br><span class="line"></span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">#ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v5 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/5 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/5 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/5 : WORKDIR /tmp</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 75588fa14579</span><br><span class="line">Step 4/5 : VOLUME &quot;/data/&quot;</span><br><span class="line"> ---&gt; Running in cb63a5cec868</span><br><span class="line">Removing intermediate container cb63a5cec868</span><br><span class="line"> ---&gt; a783b4bf5dfb</span><br><span class="line">Step 5/5 : COPY index.html ./</span><br><span class="line"> ---&gt; c0ae8d6e5c23</span><br><span class="line">Successfully built c0ae8d6e5c23</span><br><span class="line">Successfully tagged testimg:v5</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v5                  c0ae8d6e5c23        13 seconds ago      1.13MB</span><br><span class="line">testimg             v4                  9b2844373a64        10 minutes ago      2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        34 minutes ago      2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        About an hour ago   1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        About an hour ago   1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        2 days ago          1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --name t1 --rm testimg:v5 </span><br><span class="line">/tmp # ls</span><br><span class="line">index.html</span><br><span class="line">/tmp # </span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker inspect t1 | grep  -A 10 &quot;Mounts&quot;     # 切换到另一个终端查看挂载信息，ok；</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;93b2df80ffc65ec9377955707b2a48ffac7991612513bfe4241cdc5c1d0b45e3&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/93b2df80ffc65ec9377955707b2a48ffac7991612513bfe4241cdc5c1d0b45e3/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/data&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><ul>
<li>用于为容器打开指定要监听的端口以实现与外部通信</li>
<li>Syntax<ul>
<li>EXPOSE <port>[/<protocol>][<port>[/<protocol>]…]<ul>
<li><protocol>用于指定传输层协议，可谓tcp或udp二者之一，默认为TCP协议</protocol></li>
</ul>
</protocol></port></protocol></port></li>
<li>EXPOSE指令可一次指定多个端口，例如<ul>
<li>EXPOSE 11211/UDP 11211/TCP</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="EXPOSE示例"><a href="#EXPOSE示例" class="headerlink" title="EXPOSE示例"></a>EXPOSE示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">WORKDIR /tmp</span><br><span class="line"></span><br><span class="line">VOLUME &quot;/data/&quot;</span><br><span class="line"></span><br><span class="line">COPY index.html ./</span><br><span class="line"></span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">#ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">EXPOSE 80/tcp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v6 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/6 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/6 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/6 : WORKDIR /tmp</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 75588fa14579</span><br><span class="line">Step 4/6 : VOLUME &quot;/data/&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a783b4bf5dfb</span><br><span class="line">Step 5/6 : COPY index.html ./</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c0ae8d6e5c23</span><br><span class="line">Step 6/6 : EXPOSE 80/tcp</span><br><span class="line"> ---&gt; Running in 13240498ddac</span><br><span class="line">Removing intermediate container 13240498ddac</span><br><span class="line"> ---&gt; 8a6e858cd4c3</span><br><span class="line">Successfully built 8a6e858cd4c3</span><br><span class="line">Successfully tagged testimg:v6</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v6                  8a6e858cd4c3        51 seconds ago      1.13MB</span><br><span class="line">testimg             v5                  c0ae8d6e5c23        13 minutes ago      1.13MB</span><br><span class="line">testimg             v4                  9b2844373a64        24 minutes ago      2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        About an hour ago   2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        About an hour ago   1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        About an hour ago   1.13MB</span><br><span class="line">testbox             v0.1                da2444a15176        2 days ago          1.13MB</span><br><span class="line">web                 0.2                 87aadc5b53c7        2 days ago          1.13MB</span><br><span class="line">web                 0.1                 fcd0885091c8        2 days ago          1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --name t1 --rm testimg:v6</span><br><span class="line">/tmp # </span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker port t1        # 切换终端查看并没有开启端口；</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -it --name t1 --rm -P  testimg:v6     # 此时我们只需要，加一个-P选项就ok；</span><br><span class="line">/tmp # </span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# docker port t1        # 切换终端查看端口已经开启；</span><br><span class="line">80/tcp -&gt; 0.0.0.0:32768</span><br></pre></td></tr></table></figure>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><ul>
<li>用于为镜像定义所需的环境变量，并可悲Dockerfile文件中位于其后的其它指令（如ENV、ADD、COPY等）所调用</li>
<li>调用的格式为$variable_name或${variable_name}</li>
<li>Syntax<ul>
<li>ENV<key><value> 或 </value></key></li>
<li>ENV <key>=<value>…</value></key></li>
</ul>
</li>
<li>第一种格式中，<key>之后的所有内容均会被视作其<value>的组成部分，因此，一次只能设置一个变量；</value></key></li>
<li>第二种格式可用一次设置多个变量，每个变量为一个””<key>=<value>“的键值对，如果<value>中包含空格，可以以反斜线()进行转义，也可通过对<value>加引号进行标识；另外，反斜线也可用于续行；</value></value></value></key></li>
<li>定义多个变量时，建议使用第二种方式，以便在同一层中完成所有功能 </li>
</ul>
<h5 id="ENV示例"><a href="#ENV示例" class="headerlink" title="ENV示例"></a>ENV示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile</span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">ENV nginx_version 1.12.2</span><br><span class="line">ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line">#WORKDIR /tmp</span><br><span class="line"></span><br><span class="line">#VOLUME &quot;/data/&quot;</span><br><span class="line"></span><br><span class="line">#COPY index.html ./</span><br><span class="line"></span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">#ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">#EXPOSE 80/tcp</span><br><span class="line">ADD $&#123;nginx_url&#125; /usr/local/src/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build  -t testimg:v7 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/5 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/5 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/5 : ENV nginx_version 1.12.2</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a6ad2115a130</span><br><span class="line">Step 4/5 : ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; b9f11f2cc28e</span><br><span class="line">Step 5/5 : ADD $&#123;nginx_url&#125; /usr/local/src/</span><br><span class="line">Downloading  981.7kB/981.7kB</span><br><span class="line"> ---&gt; 14cde41cd62e</span><br><span class="line">Successfully built 14cde41cd62e</span><br><span class="line">Successfully tagged testimg:v7</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">testimg             v7                  14cde41cd62e        About a minute ago   2.11MB</span><br><span class="line">testimg             v6                  8a6e858cd4c3        23 hours ago         1.13MB</span><br><span class="line">testimg             v5                  c0ae8d6e5c23        23 hours ago         1.13MB</span><br><span class="line">testimg             v4                  9b2844373a64        23 hours ago         2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        24 hours ago         2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        24 hours ago         1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        24 hours ago         1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago          204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago         1.13MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run --name t1 -it --rm testimg:v7 </span><br><span class="line">WARNING: IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line">/ # ls /usr/local/src</span><br><span class="line">nginx-1.12.2.tar.gz</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure>
<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><ul>
<li>用于指定docker build过程中运行的程序，其可以是任何命令</li>
<li>Syntax<ul>
<li>RUN<command> 或</li>
<li>RUN [“<executable>“,”<paraml>“,”<param2>“]</param2></paraml></executable></li>
</ul>
</li>
<li>第一种格式中，<command>通常是一个shell命令，且以“/bin/sh -c”来运行它，这意味着此进程在容器中的PID不为1，不能接收Unix信号，因此，当使用docker stop <container>命令停止容器时，此进程收不到SIGTERM信号；</container></li>
<li>第二种语法格式中的参数是一个JSON格式的数组，其中<executable>为要运行的命令，后面的<paramn>为传递给命令的选项或参数；然而，此种格式指定的命令不会以”/bin/sh -c”来发起，因此常见的shell操作如变量替换以及通配符(?，*等)替换将不会进行；不过，如果要运行的命令依赖于此shell特性的话，可以将其替换为类似下面的格式。<ul>
<li>RUN[“/bin/bash”,”-c”,”<executable>“,”<paraml>“]</paraml></executable></li>
</ul>
</paramn></executable></li>
</ul>
<h5 id="RUN示例"><a href="#RUN示例" class="headerlink" title="RUN示例"></a>RUN示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# cat Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">ENV nginx_version 1.12.2</span><br><span class="line">ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line">WORKDIR /usr/local/src</span><br><span class="line"></span><br><span class="line">#VOLUME &quot;/data/&quot;</span><br><span class="line"></span><br><span class="line">#COPY index.html ./</span><br><span class="line"></span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">#ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">#EXPOSE 80/tcp</span><br><span class="line">ADD $&#123;nginx_url&#125; /usr/local/src/</span><br><span class="line"></span><br><span class="line">RUN tar xf nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v8 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/7 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/7 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/7 : ENV nginx_version 1.12.2</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a6ad2115a130</span><br><span class="line">Step 4/7 : ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; b9f11f2cc28e</span><br><span class="line">Step 5/7 : WORKDIR /usr/local/src</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2934f3768935</span><br><span class="line">Step 6/7 : ADD $&#123;nginx_url&#125; /usr/local/src/</span><br><span class="line">Downloading  981.7kB/981.7kB</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 45f6656576c1</span><br><span class="line">Step 7/7 : RUN tar xf nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"> ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line"> ---&gt; Running in a5236e8fe50b</span><br><span class="line">Removing intermediate container a5236e8fe50b</span><br><span class="line"> ---&gt; 7877f95160db</span><br><span class="line">Successfully built 7877f95160db</span><br><span class="line">Successfully tagged testimg:v8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v8                  7877f95160db        28 seconds ago      7.91MB</span><br><span class="line">testimg             v7                  14cde41cd62e        34 minutes ago      2.11MB</span><br><span class="line">testimg             v6                  8a6e858cd4c3        24 hours ago        1.13MB</span><br><span class="line">testimg             v5                  c0ae8d6e5c23        24 hours ago        1.13MB</span><br><span class="line">testimg             v4                  9b2844373a64        24 hours ago        2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        24 hours ago        2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        25 hours ago        1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        25 hours ago        1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line">[root@centos7 dockerfile]# docker run -it --name t1 --rm testimg:v8 </span><br><span class="line">WARNING: IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line">/usr/local/src # ls</span><br><span class="line">nginx-1.12.2         nginx-1.12.2.tar.gz</span><br><span class="line">/usr/local/src #</span><br></pre></td></tr></table></figure>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><ul>
<li>类似于RUN指令，CMD指令也可用于运行任何命令或应用程序，不过，二者的运行时间点不同<ul>
<li>RUN指令运行于影响文件构建过程中，而CMD指令运行与基于Dockerfile构建出的新影响文件启动一个容器时</li>
<li>CMD指令的首要目的在于为启动的容器指定默认要运行的程序，且其运行结束后，容器也将终止；不过CMD指定的指令其可以被docker run的命令行选项所覆盖</li>
<li><strong>在dockerfile中可以存在多个CMD指令，但仅最后一个会生效</strong></li>
</ul>
</li>
<li>Syntax<ul>
<li>CMD<command> 或</li>
<li>CMD[ “<executable>“,”<paraml>“,”<param2>“] 或</param2></paraml></executable></li>
<li>CMD[“<param1>“,”<param2>“]</param2></param1></li>
</ul>
</li>
<li>前两种语法格式的意义同RUN</li>
<li>第三种则用于ENTRYPOINT指令提供默认参数</li>
</ul>
<h5 id="CMD示例"><a href="#CMD示例" class="headerlink" title="CMD示例"></a>CMD示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v9 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/6 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/6 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/6 : ENV nginx_version 1.12.2</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a6ad2115a130</span><br><span class="line">Step 4/6 : ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; b9f11f2cc28e</span><br><span class="line">Step 5/6 : WORKDIR /usr/local/src</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2934f3768935</span><br><span class="line">Step 6/6 : CMD [&quot;httpd&quot;,&quot;-f&quot;]</span><br><span class="line"> ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line"> ---&gt; Running in 8d2cf2b7edc8</span><br><span class="line">Removing intermediate container 8d2cf2b7edc8</span><br><span class="line"> ---&gt; c42d3b44209f</span><br><span class="line">Successfully built c42d3b44209f</span><br><span class="line">Successfully tagged testimg:v9</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">testimg             v9                  c42d3b44209f        About a minute ago   1.13MB</span><br><span class="line">testimg             v8                  7877f95160db        26 minutes ago       7.91MB</span><br><span class="line">testimg             v7                  14cde41cd62e        About an hour ago    2.11MB</span><br><span class="line">testimg             v6                  8a6e858cd4c3        24 hours ago         1.13MB</span><br><span class="line">testimg             v5                  c0ae8d6e5c23        24 hours ago         1.13MB</span><br><span class="line">testimg             v4                  9b2844373a64        24 hours ago         2.11MB</span><br><span class="line">testimg             v3                  621f6100c2c6        25 hours ago         2.12MB</span><br><span class="line">testimg             v2                  d6885cecd73b        25 hours ago         1.14MB</span><br><span class="line">testimg             v1                  9fb27d5848c5        25 hours ago         1.13MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago          204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago         1.13MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run --name t1 -d testimg:v9 </span><br><span class="line">WARNING: IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line">6804ff290d44177acfbc4274a96e6e8fae97ae443c54c7bb56150e05bfea91fe</span><br><span class="line">[root@centos7 dockerfile]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">6804ff290d44        testimg:v9          &quot;httpd -f&quot;          4 seconds ago       Up 3 seconds                            t1</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker exec -it t1 ifconfig      # 查看容器IP；</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:C0:A8:06:02  </span><br><span class="line">          inet addr:192.168.6.2  Bcast:192.168.6.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:8 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:648 (648.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1 </span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# curl 192.168.6.2     # 测试访问，ok；</span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;404 Not Found&lt;/TITLE&gt;&lt;/HEAD&gt;</span><br><span class="line">&lt;BODY&gt;&lt;H1&gt;404 Not Found&lt;/H1&gt;</span><br><span class="line">The requested URL was not found</span><br><span class="line">&lt;/BODY&gt;&lt;/HTML&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><ul>
<li>类似CMD指令的功能，用于为容器指定默认运行程序，从而使得容器像是一个单独的可执行程序</li>
<li>与CMD不同的是，由ENTRYPOINT启动的程序不会被docker run命令行指定的参数所覆盖，而且，这些命令行参数会被当作参数传递给ENTRYPOINT指定的程序</li>
<li>不过，docker run命令的–entrypoint选项的参数可覆盖ENTRYPOINT指令指定的程序</li>
<li>Syntax<ul>
<li>ENTRYPOINT<command></li>
<li>ENTRYPOINT[“<executable>“,”<param1>“,”<param2>“]</param2></param1></executable></li>
</ul>
</li>
<li>docker run命令传入的命令参数会覆盖CMD指令的内容并且附加到ENTRYPOINT命令最为其参数使用</li>
<li>Dockerfile文件中也可以存在多个ENTRYPOINT指令，但仅有最后一个会生效</li>
</ul>
<h5 id="ENTRYPOINT示例"><a href="#ENTRYPOINT示例" class="headerlink" title="ENTRYPOINT示例"></a>ENTRYPOINT示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 dockerfile]# vim Dockerfile </span><br><span class="line">FROM busybox:1.27.2</span><br><span class="line"></span><br><span class="line">MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">ENV nginx_version 1.12.2</span><br><span class="line">ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line">WORKDIR /usr/local/src</span><br><span class="line"></span><br><span class="line">#VOLUME &quot;/data/&quot;</span><br><span class="line"></span><br><span class="line">#COPY index.html ./</span><br><span class="line"></span><br><span class="line">#COPY yum.repos.d/ /etc/yum.repos.d/</span><br><span class="line">#ADD http://nginx.org/download/nginx-1.12.2.tar.gz ./</span><br><span class="line">#ADD all.tar.gz /usr/src/</span><br><span class="line"></span><br><span class="line">#EXPOSE 80/tcp</span><br><span class="line">#ADD $&#123;nginx_url&#125; /usr/local/src/</span><br><span class="line"></span><br><span class="line">#RUN tar xf nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;httpd&quot;,&quot;-f&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker build -t testimg:v10 ./</span><br><span class="line">Sending build context to Docker daemon   25.6kB</span><br><span class="line">Step 1/6 : FROM busybox:1.27.2</span><br><span class="line"> ---&gt; 6ad733544a63</span><br><span class="line">Step 2/6 : MAINTAINER &quot;houhaiyun &lt;hou_haiyun@weitac.com&gt;&quot;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c81654ecab43</span><br><span class="line">Step 3/6 : ENV nginx_version 1.12.2</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; a6ad2115a130</span><br><span class="line">Step 4/6 : ENV nginx_url http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; b9f11f2cc28e</span><br><span class="line">Step 5/6 : WORKDIR /usr/local/src</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2934f3768935</span><br><span class="line">Step 6/6 : ENTRYPOINT [&quot;httpd&quot;,&quot;-f&quot;]</span><br><span class="line"> ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line"> ---&gt; Running in 285ac7b0329c</span><br><span class="line">Removing intermediate container 285ac7b0329c</span><br><span class="line"> ---&gt; 319bf0d748f8</span><br><span class="line">Successfully built 319bf0d748f8</span><br><span class="line">Successfully tagged testimg:v10</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">testimg             v10                 319bf0d748f8        3 minutes ago       1.13MB</span><br><span class="line">testimg             v9                  c42d3b44209f        22 minutes ago      1.13MB</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              45f6656576c1        About an hour ago   2.11MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run -d --name t1 --rm testimg:v10 </span><br><span class="line">WARNING: IPv4 forwarding is disabled. Networking will not work.</span><br><span class="line">8fa159cd20de19c894cf437d530fec16667e53128d0b3c703f27ea14cc5660bb</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker ps </span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">8fa159cd20de        testimg:v10         &quot;httpd -f&quot;          10 seconds ago      Up 9 seconds                            t1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerfile]# docker run  --name t2 -it --rm --entrypoint &quot;/bin/bash&quot; testimg:v10     # 可以使用此命令进行覆盖指令；</span><br></pre></td></tr></table></figure>
<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><ul>
<li>用于指定运行image时的或运行Dockerfile中的任意RUN、CMD或ENTRYPOINT指令指定的程序时的用户名或UID</li>
<li>默认情况下，container的运行身份为root用户</li>
<li>Syntax<ul>
<li>USER <uid><username></username></uid></li>
<li>需要注意的是，<uid>可以为任意数字，但实践中其必须为/etc/passwd中某用户的有效UID，否则，docker run命令将运行失败</uid></li>
</ul>
</li>
</ul>
<h4 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h4><ul>
<li>用于在Dockerfile中定义一个触发器</li>
<li>Dockerfile用于build映像文件，此映像文件亦可作为base image被另一个Dockerfile用作FROM指令的参数，并以之构建新的映像文件</li>
<li>在后面的这个Dockerfile中的FROM指令在build过程中被执行时，将会”触发“创建其base image的dockerfile文件中的ONBUILD指令定义的触发器</li>
<li>Suntax<ul>
<li>ONBUILD <instruction></instruction></li>
</ul>
</li>
<li>尽管任何指令都可注册成为触发器指令，但ONBUILD不能自我嵌套，且不会触发FROM和MAINTAINER指令</li>
<li>使用包含ONBUILD指令的Dockerfile构建的镜像应该使用特殊的标签，例如ruby:2.0-onbuild</li>
<li>在ONBUILD指令中使用ADD或COPY指令应该格外小心，因为新构建过程的上下文在缺少指定的源文件时会失败</li>
</ul>
<h3 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h3><p><a href="https://www.jianshu.com/p/690844302df5" target="_blank" rel="noopener">Dockerfile语法：https://www.jianshu.com/p/690844302df5</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>