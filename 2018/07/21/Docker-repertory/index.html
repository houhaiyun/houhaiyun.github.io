<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Docker构建私有仓库 | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Docker/">Docker</a></div><div class="post-time">2018-07-21</div></div></div><div class="container post-header"><h1>Docker构建私有仓库</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装docker-distribution"><span class="toc-number">1.</span> <span class="toc-text">安装docker-distribution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改配置文件"><span class="toc-number">2.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动服务"><span class="toc-number">3.</span> <span class="toc-text">启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改docker配置文件"><span class="toc-number">4.</span> <span class="toc-text">修改docker配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重新打标签"><span class="toc-number">5.</span> <span class="toc-text">重新打标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#推镜像测试"><span class="toc-number">6.</span> <span class="toc-text">推镜像测试</span></a></li></ol></details></div><div class="container post-content"><h3 id="安装docker-distribution"><a href="#安装docker-distribution" class="headerlink" title="安装docker-distribution"></a>安装docker-distribution</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 yum.repos.d]# yum info docker-distribution</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.nwsuaf.edu.cn</span><br><span class="line"> * centosplus: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.neusoft.edu.cn</span><br><span class="line">Available Packages</span><br><span class="line">Name        : docker-distribution</span><br><span class="line">Arch        : x86_64</span><br><span class="line">Version     : 2.6.2</span><br><span class="line">Release     : 1.git48294d9.el7</span><br><span class="line">Size        : 3.5 M</span><br><span class="line">Repo        : extras/7/x86_64       # 注意，此源是来自于centos默认的extras仓库中的；</span><br><span class="line">Summary     : Docker toolset to pack, ship, store, and deliver content</span><br><span class="line">URL         : https://github.com/docker/distribution</span><br><span class="line">License     : ASL 2.0</span><br><span class="line">Description : Docker toolset to pack, ship, store, and deliver content</span><br><span class="line"></span><br><span class="line">[root@centos7 yum.repos.d]# yum install -y docker-distribution</span><br><span class="line"></span><br><span class="line">[root@centos7 yum.repos.d]# rpm -ql docker-distribution </span><br><span class="line">/etc/docker-distribution/registry/config.yml</span><br><span class="line">/usr/bin/registry</span><br><span class="line">/usr/lib/systemd/system/docker-distribution.service</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2/AUTHORS</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2/CONTRIBUTING.md</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2/LICENSE</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2/MAINTAINERS</span><br><span class="line">/usr/share/doc/docker-distribution-2.6.2/README.md</span><br><span class="line">/var/lib/registry</span><br></pre></td></tr></table></figure>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 yum.repos.d]# vim /etc/docker-distribution/registry/config.yml</span><br><span class="line"></span><br><span class="line">version: 0.1 </span><br><span class="line">log:</span><br><span class="line">  fields:</span><br><span class="line">    service: registry</span><br><span class="line">storage:</span><br><span class="line">    cache:</span><br><span class="line">        layerinfo: inmemory</span><br><span class="line">    filesystem:</span><br><span class="line">        rootdirectory: /var/lib/registry</span><br><span class="line">http:</span><br><span class="line">    addr: :5000</span><br></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 yum.repos.d]# systemctl start docker-distribution.service </span><br><span class="line">[root@centos7 yum.repos.d]# ss -tnl     # 默认监听5000端口；</span><br><span class="line">State       Recv-Q Send-Q         Local Address:Port                        Peer Address:Port              </span><br><span class="line">LISTEN      0      128                        *:22                                     *:*                  </span><br><span class="line">LISTEN      0      100                127.0.0.1:25                                     *:*                  </span><br><span class="line">LISTEN      0      128                       :::22                                    :::*                  </span><br><span class="line">LISTEN      0      100                      ::1:25                                    :::*                  </span><br><span class="line">LISTEN      0      128                       :::5000                                  :::*</span><br></pre></td></tr></table></figure>
<h3 id="修改docker配置文件"><a href="#修改docker配置文件" class="headerlink" title="修改docker配置文件"></a>修改docker配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;bip&quot;: &quot;192.168.6.1/24&quot;,</span><br><span class="line">    &quot;insecure-registries&quot;: [&quot;docerhub.haiyun.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# systemctl restart docker</span><br></pre></td></tr></table></figure>
<h3 id="重新打标签"><a href="#重新打标签" class="headerlink" title="重新打标签"></a>重新打标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">test                v1                  3f45104ca992        23 hours ago        204MB</span><br><span class="line">testimg             v10                 319bf0d748f8        23 hours ago        1.13MB</span><br><span class="line">testimg             v9                  c42d3b44209f        24 hours ago        1.13MB</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              45f6656576c1        24 hours ago        2.11MB</span><br><span class="line">centos              latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox             1.27.2              6ad733544a63        2 months ago        1.13MB</span><br><span class="line">[root@centos7 ~]# docker tag testimg:v9 dockerhub.haiyun.com/testimg:v1</span><br><span class="line">[root@centos7 ~]# docker images </span><br><span class="line">REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">test                           v1                  3f45104ca992        23 hours ago        204MB</span><br><span class="line">testimg                        v10                 319bf0d748f8        23 hours ago        1.13MB</span><br><span class="line">testimg                        v9                  c42d3b44209f        24 hours ago        1.13MB</span><br><span class="line">dockerhub.haiyun.com/testimg   v1                  c42d3b44209f        24 hours ago        1.13MB</span><br><span class="line">&lt;none&gt;                         &lt;none&gt;              45f6656576c1        24 hours ago        2.11MB</span><br><span class="line">centos                         latest              3fa822599e10        5 weeks ago         204MB</span><br><span class="line">busybox                        1.27.2              6ad733544a63        2 months ago        1.13MB</span><br></pre></td></tr></table></figure>
<h3 id="推镜像测试"><a href="#推镜像测试" class="headerlink" title="推镜像测试"></a>推镜像测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# docker push dockerhub.haiyun.com/testimg:v1</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>