<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Redis 主从复制部署 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Redis/">Redis</a></div><div class="post-time">2018-08-31</div></div></div><div class="container post-header"><h1>Redis 主从复制部署</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis主从复制特点："><span class="toc-number">1.</span> <span class="toc-text">redis主从复制特点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建redis主从复制"><span class="toc-number">2.</span> <span class="toc-text">搭建redis主从复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环境"><span class="toc-number">3.</span> <span class="toc-text">环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改主机名"><span class="toc-number">3.1.</span> <span class="toc-text">修改主机名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步时间"><span class="toc-number">3.2.</span> <span class="toc-text">同步时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#写入hosts文件"><span class="toc-number">3.3.</span> <span class="toc-text">写入hosts文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装redis"><span class="toc-number">4.</span> <span class="toc-text">安装redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置主redis-node1-并启动服务"><span class="toc-number">5.</span> <span class="toc-text">配置主redis(node1)并启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置redis-node2-为从节点"><span class="toc-number">6.</span> <span class="toc-text">配置redis(node2)为从节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置redis-node3-为从节点"><span class="toc-number">7.</span> <span class="toc-text">配置redis(node3)为从节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试主从同步"><span class="toc-number">8.</span> <span class="toc-text">测试主从同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置redis高可用集群"><span class="toc-number">9.</span> <span class="toc-text">配置redis高可用集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主节点node1配置并启动服务"><span class="toc-number">10.</span> <span class="toc-text">主节点node1配置并启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置从节点node2和node3并启动服务"><span class="toc-number">11.</span> <span class="toc-text">配置从节点node2和node3并启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-cli查看master和slave信息"><span class="toc-number">12.</span> <span class="toc-text">redis-cli查看master和slave信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试主节点服务宕掉"><span class="toc-number">13.</span> <span class="toc-text">测试主节点服务宕掉</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修复node1重新上线"><span class="toc-number">14.</span> <span class="toc-text">修复node1重新上线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点"><span class="toc-number">15.</span> <span class="toc-text">知识点</span></a></li></ol></details></div><div class="container post-content"><h3 id="redis主从复制特点："><a href="#redis主从复制特点：" class="headerlink" title="redis主从复制特点："></a>redis主从复制特点：</h3><a id="more"></a>
<ul>
<li>一个<code>Master</code>可以有多个<code>slave</code>主机，支持链式复制；</li>
<li><code>Master</code>以非阻塞方式同步数据至<code>slave</code>主机；</li>
</ul>
<h3 id="搭建redis主从复制"><a href="#搭建redis主从复制" class="headerlink" title="搭建redis主从复制"></a>搭建redis主从复制</h3><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><table>
<thead>
<tr>
<th>主机名</th>
<th>服务</th>
<th>IP</th>
<th>软件版本</th>
<th>系统版本</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>node1.ihaiyun.cc</td>
<td>redis1</td>
<td>192.168.8.12</td>
<td>redis-3.2.3</td>
<td>CentOS Linux release 7.3.1611 (Core)</td>
<td>Redis主服务器</td>
</tr>
<tr>
<td>node2.ihaiyun.cc</td>
<td>redis2</td>
<td>192.168.8.15</td>
<td>redis-3.2.3</td>
<td>CentOS Linux release 7.3.1611 (Core)</td>
<td>Redis从服务器</td>
</tr>
<tr>
<td>node3.ihaiyun.cc</td>
<td>redis3</td>
<td>192.168.8.17</td>
<td>redis-3.2.3</td>
<td>CentOS Linux release 7.3.1611 (Core)</td>
<td>Redis从服务器</td>
</tr>
</tbody>
</table>
<h4 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># node1配置</span><br><span class="line">[root@centos7 ~]# hostnamectl set-hostname node1.ihaiyun.cc &amp;&amp; exec bash </span><br><span class="line">[root@node1 ~]# </span><br><span class="line"></span><br><span class="line"># node2配置</span><br><span class="line">[root@centos7 ~]#  hostnamectl set-hostname node2.ihaiyun.cc &amp;&amp; exec bash</span><br><span class="line">[root@node2 ~]# </span><br><span class="line"></span><br><span class="line"># node3配置</span><br><span class="line">[root@centos7 ~]# hostnamectl set-hostname node3.ihaiyun.cc &amp;&amp; exec bash</span><br><span class="line">[root@node3 ~]#</span><br></pre></td></tr></table></figure>
<h4 id="同步时间"><a href="#同步时间" class="headerlink" title="同步时间"></a>同步时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># node1配置</span><br><span class="line">[root@node1 ~]# ntpdate 172.18.0.1</span><br><span class="line"> 6 Dec 17:24:05 ntpdate[2195]: step time server 172.18.0.1 offset 6.171368 sec</span><br><span class="line">[root@node1 ~]# date</span><br><span class="line">Wed Dec  6 17:24:08 CST 2017</span><br><span class="line"></span><br><span class="line"># node2配置</span><br><span class="line">[root@node2 ~]# ntpdate 172.18.0.1</span><br><span class="line"> 6 Dec 17:24:05 ntpdate[2137]: step time server 172.18.0.1 offset 4.969852 sec</span><br><span class="line">[root@node2 ~]# date</span><br><span class="line">Wed Dec  6 17:24:08 CST 2017</span><br><span class="line"></span><br><span class="line"># node3配置</span><br><span class="line">[root@node3 ~]# ntpdate 172.18.0.1</span><br><span class="line"> 6 Dec 17:24:05 ntpdate[2116]: step time server 172.18.0.1 offset 6.477080 sec</span><br><span class="line">[root@node3 ~]# date</span><br><span class="line">Wed Dec  6 17:24:08 CST 2017</span><br></pre></td></tr></table></figure>
<h4 id="写入hosts文件"><a href="#写入hosts文件" class="headerlink" title="写入hosts文件"></a>写入hosts文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"># node1配置</span><br><span class="line">[root@node1 ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 </span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.8.12 node1.ihaiyun.cc node1</span><br><span class="line">192.168.8.15 node2.ihaiyun.cc node2</span><br><span class="line">192.168.8.17 node3.ihaiyun.cc node3</span><br><span class="line"></span><br><span class="line"># node2配置</span><br><span class="line">[root@node2 ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 </span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.8.12 node1.ihaiyun.cc node1</span><br><span class="line">192.168.8.15 node2.ihaiyun.cc node2</span><br><span class="line">192.168.8.17 node3.ihaiyun.cc node3</span><br><span class="line"></span><br><span class="line"># node3配置</span><br><span class="line">[root@node3 ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 </span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.8.12 node1.ihaiyun.cc node1</span><br><span class="line">192.168.8.15 node2.ihaiyun.cc node2</span><br><span class="line">192.168.8.17 node3.ihaiyun.cc node3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ping测试，ok；</span><br><span class="line">[root@node1 ~]# ping node1 -c 1</span><br><span class="line">PING node1.ihaiyun.cc (192.168.8.12) 56(84) bytes of data.</span><br><span class="line">64 bytes from node1.ihaiyun.cc (192.168.8.12): icmp_seq=1 ttl=64 time=0.039 ms</span><br><span class="line"></span><br><span class="line">--- node1.ihaiyun.cc ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.039/0.039/0.039/0.000 ms</span><br><span class="line">[root@node1 ~]# ping node2 -c 1</span><br><span class="line">PING node2.ihaiyun.cc (192.168.8.15) 56(84) bytes of data.</span><br><span class="line">64 bytes from node2.ihaiyun.cc (192.168.8.15): icmp_seq=1 ttl=64 time=0.350 ms</span><br><span class="line"></span><br><span class="line">--- node2.ihaiyun.cc ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.350/0.350/0.350/0.000 ms</span><br><span class="line">[root@node1 ~]# ping node3 -c 1</span><br><span class="line">PING node3.ihaiyun.cc (192.168.8.17) 56(84) bytes of data.</span><br><span class="line">64 bytes from node3.ihaiyun.cc (192.168.8.17): icmp_seq=1 ttl=64 time=0.593 ms</span><br><span class="line"></span><br><span class="line">--- node3.ihaiyun.cc ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.593/0.593/0.593/0.000 ms</span><br></pre></td></tr></table></figure>
<h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># node1配置</span><br><span class="line">[root@node1 ~]# yum -y  install redis</span><br><span class="line"></span><br><span class="line"># node2配置</span><br><span class="line">[root@node2 ~]# yum -y  install redis</span><br><span class="line"></span><br><span class="line"># node3配置</span><br><span class="line">[root@node3 ~]# yum -y  install redis</span><br></pre></td></tr></table></figure>
<h3 id="配置主redis-node1-并启动服务"><a href="#配置主redis-node1-并启动服务" class="headerlink" title="配置主redis(node1)并启动服务"></a>配置主redis(node1)并启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# vim /etc/redis.conf</span><br><span class="line">bind 0.0.0.0        # 监控本地所有IP；</span><br><span class="line">requirepass haiyun      # 验证密码haiyun；</span><br><span class="line">[root@node1 ~]# systemctl start redis</span><br><span class="line">[root@node1 ~]# ss -tnl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*</span><br></pre></td></tr></table></figure>
<h3 id="配置redis-node2-为从节点"><a href="#配置redis-node2-为从节点" class="headerlink" title="配置redis(node2)为从节点"></a>配置redis(node2)为从节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# vim /etc/redis.conf</span><br><span class="line">bind 0.0.0.0            # 监控本地所有IP；</span><br><span class="line">requirepass haiyun      # 设置密码为haiyun；</span><br><span class="line"></span><br><span class="line">slaveof 192.168.8.12 6379       # 设置主节点IP 端口；</span><br><span class="line">masterauth haiyun           # 主节点认证密码；</span><br><span class="line"></span><br><span class="line">[root@node2 ~]# systemctl start redis       # 启动服务；</span><br><span class="line">[root@node2 ~]# ss -tnl     # 端口已经开启；</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*        </span><br><span class="line">[root@node2 ~]# redis-cli </span><br><span class="line">127.0.0.1:6379&gt; AUTH haiyun</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INFO replication    </span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.8.12</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:5</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:225</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 切换到主节点node1查看</span><br><span class="line">127.0.0.1:6379&gt; INFO replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=192.168.8.15,port=6379,state=online,offset=155,lag=1      # 第一个从节点；</span><br><span class="line">master_repl_offset:155</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:2</span><br><span class="line">repl_backlog_histlen:154</span><br></pre></td></tr></table></figure>
<h3 id="配置redis-node3-为从节点"><a href="#配置redis-node3-为从节点" class="headerlink" title="配置redis(node3)为从节点"></a>配置redis(node3)为从节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@node3 ~]# vim /etc/redis.conf </span><br><span class="line">bind 0.0.0.0            # 监控本地所有IP；</span><br><span class="line">requirepass haiyun      # 设置密码为haiyun；</span><br><span class="line"></span><br><span class="line">[root@node3 ~]# systemctl start redis</span><br><span class="line">[root@node3 ~]# ss -tnl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*   </span><br><span class="line"></span><br><span class="line">[root@node3 ~]# redis-cli -a haiyun</span><br><span class="line">127.0.0.1:6379&gt; INFO replication        # 目前node3还不是node1的从节点；</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET SLAVEOF      # 查看当前redis节点配置信息；</span><br><span class="line">1) &quot;slaveof&quot;</span><br><span class="line">2) &quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; SLAVEOF 192.168.8.12 6379   # 配置主节点IP 端口；</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET masterauth       # 认证信息；</span><br><span class="line">1) &quot;masterauth&quot;</span><br><span class="line">2) &quot;&quot;</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET masterauth haiyun        # 配置认证；</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INFO replication        # 主节点配置完成；</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.8.12</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:3</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:729</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE      # 保存到配置文件中；</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@node3 ~]# tail -5  /etc/redis.conf        # 已经保存到配置文件中；</span><br><span class="line"># big latency spikes.</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"># Generated by CONFIG REWRITE</span><br><span class="line">slaveof 192.168.8.12 6379</span><br><span class="line">masterauth &quot;haiyun&quot;</span><br></pre></td></tr></table></figure>
<h3 id="测试主从同步"><a href="#测试主从同步" class="headerlink" title="测试主从同步"></a>测试主从同步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 在主节点node1新建一个key；</span><br><span class="line">[root@node1 ~]# redis-cli -a haiyun</span><br><span class="line">127.0.0.1:6379&gt; SELECT 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET testkey &quot;test!!!&quot;</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET testkey</span><br><span class="line">&quot;test!!!&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"># 在node2查看；</span><br><span class="line">[root@node2 ~]# redis-cli -a haiyun</span><br><span class="line">127.0.0.1:6379&gt; SELECT 0 </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET testkey</span><br><span class="line">&quot;test!!!&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"># 在node3查看；</span><br><span class="line">[root@node3 ~]# redis-cli -a haiyun</span><br><span class="line">127.0.0.1:6379&gt; SELECT 0 </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; GET testkey</span><br><span class="line">&quot;test!!!&quot;</span><br><span class="line"></span><br><span class="line"># ok，主从复制成功；</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="配置redis高可用集群"><a href="#配置redis高可用集群" class="headerlink" title="配置redis高可用集群"></a>配置redis高可用集群</h3><p>redis主从复制环境就按照上面的。</p>
<h3 id="主节点node1配置并启动服务"><a href="#主节点node1配置并启动服务" class="headerlink" title="主节点node1配置并启动服务"></a>主节点node1配置并启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# vim /etc/redis-sentinel.conf</span><br><span class="line">port 26379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">dir /tmp</span><br><span class="line">sentinel monitor mymaster 192.168.8.12 6379 2</span><br><span class="line">sentinel auth-pass mymaster haiyun</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel parallel-syncs mymaster 3</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line">logfile /var/log/redis/sentinel.log</span><br><span class="line">[root@node1 ~]# systemctl start redis-sentinel.service </span><br><span class="line">[root@node1 ~]# ss -tnl     # 端口已经开启26379；</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:26379                          *:*                  </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::26379                         :::*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*</span><br></pre></td></tr></table></figure>
<h3 id="配置从节点node2和node3并启动服务"><a href="#配置从节点node2和node3并启动服务" class="headerlink" title="配置从节点node2和node3并启动服务"></a>配置从节点node2和node3并启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# scp /etc/redis-sentinel.conf 192.168.8.15:/etc/     # 复制配置文件到node2；</span><br><span class="line">root@192.168.8.15&apos;s password: </span><br><span class="line">redis-sentinel.conf                                        100% 7392     7.2KB/s   00:00    </span><br><span class="line">[root@node1 ~]# scp /etc/redis-sentinel.conf 192.168.8.17:/etc/     # 复制配置文件到node3；</span><br><span class="line">root@192.168.8.17&apos;s password: </span><br><span class="line">redis-sentinel.conf                                        100% 7392     7.2KB/s   00:00   </span><br><span class="line"></span><br><span class="line"># 启动node2服务；</span><br><span class="line">[root@node2 ~]# systemctl start redis-sentinel.service </span><br><span class="line">[root@node2 ~]# ss -tnl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:26379                          *:*                  </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::26379                         :::*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::* </span><br><span class="line"></span><br><span class="line"># 启动node3服务；</span><br><span class="line">[root@node3 ~]# systemctl start redis-sentinel.service </span><br><span class="line">[root@node3 ~]# ss -tnl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:26379                          *:*                  </span><br><span class="line">LISTEN      0      128                *:6379                           *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::26379                         :::*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*</span><br></pre></td></tr></table></figure>
<h3 id="redis-cli查看master和slave信息"><a href="#redis-cli查看master和slave信息" class="headerlink" title="redis-cli查看master和slave信息"></a>redis-cli查看master和slave信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"># 在inode1上面查看相关信息；</span><br><span class="line">[root@node1 ~]# redis-cli -h 192.168.8.12 -p 26379      # 连接redis-sentinel，指定端口26379；</span><br><span class="line">192.168.8.12:26379&gt; SENTINEL masters        # 查看主节点相关信息；</span><br><span class="line">1)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;mymaster&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.12&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;023f3b97011eb0e8e83cd6f64e29bf7a22b5a1d0&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;master&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;154&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;154&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;2063&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;master&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;162781&quot;</span><br><span class="line">   29) &quot;config-epoch&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;num-slaves&quot;</span><br><span class="line">   32) &quot;2&quot;</span><br><span class="line">   33) &quot;num-other-sentinels&quot;</span><br><span class="line">   34) &quot;2&quot;</span><br><span class="line">   35) &quot;quorum&quot;</span><br><span class="line">   36) &quot;2&quot;</span><br><span class="line">   37) &quot;failover-timeout&quot;</span><br><span class="line">   38) &quot;180000&quot;</span><br><span class="line">   39) &quot;parallel-syncs&quot;</span><br><span class="line">   40) &quot;3&quot;</span><br><span class="line"></span><br><span class="line">192.168.8.12:26379&gt; SENTINEL slaves mymaster        # 查看从节点相关信息；</span><br><span class="line">1)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.15:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.15&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;affbfb26446ad3cb8cb626d1530d0ed68518d5d7&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;slave&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;272&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;272&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;3927&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;slave&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;264964&quot;</span><br><span class="line">   29) &quot;master-link-down-time&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;master-link-status&quot;</span><br><span class="line">   32) &quot;ok&quot;</span><br><span class="line">   33) &quot;master-host&quot;</span><br><span class="line">   34) &quot;192.168.8.12&quot;</span><br><span class="line">   35) &quot;master-port&quot;</span><br><span class="line">   36) &quot;6379&quot;</span><br><span class="line">   37) &quot;slave-priority&quot;</span><br><span class="line">   38) &quot;100&quot;</span><br><span class="line">   39) &quot;slave-repl-offset&quot;</span><br><span class="line">   40) &quot;121414&quot;</span><br><span class="line">2)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.17:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.17&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;c5292cacc9bb804feab4ffc2cfc3f777d9d525c5&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;slave&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;272&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;272&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;3927&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;slave&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;264964&quot;</span><br><span class="line">   29) &quot;master-link-down-time&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;master-link-status&quot;</span><br><span class="line">   32) &quot;ok&quot;</span><br><span class="line">   33) &quot;master-host&quot;</span><br><span class="line">   34) &quot;192.168.8.12&quot;</span><br><span class="line">   35) &quot;master-port&quot;</span><br><span class="line">   36) &quot;6379&quot;</span><br><span class="line">   37) &quot;slave-priority&quot;</span><br><span class="line">   38) &quot;100&quot;</span><br><span class="line">   39) &quot;slave-repl-offset&quot;</span><br><span class="line">   40) &quot;121414&quot;</span><br></pre></td></tr></table></figure>
<h3 id="测试主节点服务宕掉"><a href="#测试主节点服务宕掉" class="headerlink" title="测试主节点服务宕掉"></a>测试主节点服务宕掉</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# systemctl stop redis.service        # 停止主节点redis服务；</span><br><span class="line">[root@node1 ~]# ss -tnl     # 端口已经关闭；</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port                Peer Address:Port              </span><br><span class="line">LISTEN      0      128                *:26379                          *:*                  </span><br><span class="line">LISTEN      0      128                *:22                             *:*                  </span><br><span class="line">LISTEN      0      100        127.0.0.1:25                             *:*                  </span><br><span class="line">LISTEN      0      128               :::22                            :::*                  </span><br><span class="line">LISTEN      0      100              ::1:25                            :::*      </span><br><span class="line"></span><br><span class="line">[root@node1 ~]# redis-cli -h 192.168.8.12 -p 26379</span><br><span class="line">192.168.8.12:26379&gt; SENTINEL masters        # 查看主节点信息，主节点已经更换为node2了；</span><br><span class="line">1)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;mymaster&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.15&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;affbfb26446ad3cb8cb626d1530d0ed68518d5d7&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;master&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;61&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;61&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;7619&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;master&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;38470&quot;</span><br><span class="line">   29) &quot;config-epoch&quot;</span><br><span class="line">   30) &quot;3&quot;</span><br><span class="line">   31) &quot;num-slaves&quot;</span><br><span class="line">   32) &quot;2&quot;</span><br><span class="line">   33) &quot;num-other-sentinels&quot;</span><br><span class="line">   34) &quot;2&quot;</span><br><span class="line">   35) &quot;quorum&quot;</span><br><span class="line">   36) &quot;2&quot;</span><br><span class="line">   37) &quot;failover-timeout&quot;</span><br><span class="line">   38) &quot;180000&quot;</span><br><span class="line">   39) &quot;parallel-syncs&quot;</span><br><span class="line">   40) &quot;3&quot;</span><br><span class="line">192.168.8.12:26379&gt; SENTINEL slaves mymaster        # 查看从节点信息，node1已经变为从节点；</span><br><span class="line">1)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.17:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.17&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;c5292cacc9bb804feab4ffc2cfc3f777d9d525c5&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;slave&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;621&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;621&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;2169&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;slave&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;42361&quot;</span><br><span class="line">   29) &quot;master-link-down-time&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;master-link-status&quot;</span><br><span class="line">   32) &quot;ok&quot;</span><br><span class="line">   33) &quot;master-host&quot;</span><br><span class="line">   34) &quot;192.168.8.15&quot;</span><br><span class="line">   35) &quot;master-port&quot;</span><br><span class="line">   36) &quot;6379&quot;</span><br><span class="line">   37) &quot;slave-priority&quot;</span><br><span class="line">   38) &quot;100&quot;</span><br><span class="line">   39) &quot;slave-repl-offset&quot;</span><br><span class="line">   40) &quot;8420&quot;</span><br><span class="line">2)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.12:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.12&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;s_down,slave,disconnected&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;2&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;42360&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;42360&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;42360&quot;</span><br><span class="line">   21) &quot;s-down-time&quot;</span><br><span class="line">   22) &quot;37307&quot;</span><br><span class="line">   23) &quot;down-after-milliseconds&quot;</span><br><span class="line">   24) &quot;5000&quot;</span><br><span class="line">   25) &quot;info-refresh&quot;</span><br><span class="line">   26) &quot;1512565207644&quot;</span><br><span class="line">   27) &quot;role-reported&quot;</span><br><span class="line">   28) &quot;slave&quot;</span><br><span class="line">   29) &quot;role-reported-time&quot;</span><br><span class="line">   30) &quot;42360&quot;</span><br><span class="line">   31) &quot;master-link-down-time&quot;</span><br><span class="line">   32) &quot;0&quot;</span><br><span class="line">   33) &quot;master-link-status&quot;</span><br><span class="line">   34) &quot;err&quot;</span><br><span class="line">   35) &quot;master-host&quot;</span><br><span class="line">   36) &quot;?&quot;</span><br><span class="line">   37) &quot;master-port&quot;</span><br><span class="line">   38) &quot;0&quot;</span><br><span class="line">   39) &quot;slave-priority&quot;</span><br><span class="line">   40) &quot;100&quot;</span><br><span class="line">   41) &quot;slave-repl-offset&quot;</span><br><span class="line">   42) &quot;0&quot;</span><br></pre></td></tr></table></figure>
<h3 id="修复node1重新上线"><a href="#修复node1重新上线" class="headerlink" title="修复node1重新上线"></a>修复node1重新上线</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# vim /etc/redis.conf         # 修改配置文件；</span><br><span class="line">slaveof 192.168.8.15 6379</span><br><span class="line">masterauth haiyun</span><br><span class="line"></span><br><span class="line">[root@node1 ~]# systemctl restart redis.service         # 重启redis；</span><br><span class="line">[root@node1 ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; AUTH haiyun</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INFO Replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.8.15</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:1</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:83604</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 连接到26379查看</span><br><span class="line">[root@node1 ~]# redis-cli -h 192.168.8.12 -p 26379</span><br><span class="line">192.168.8.12:26379&gt; SENTINEL slaves mymaster</span><br><span class="line">1)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.17:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.17&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;c5292cacc9bb804feab4ffc2cfc3f777d9d525c5&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;slave&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;347&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;347&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;7100&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;slave&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;508995&quot;</span><br><span class="line">   29) &quot;master-link-down-time&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;master-link-status&quot;</span><br><span class="line">   32) &quot;ok&quot;</span><br><span class="line">   33) &quot;master-host&quot;</span><br><span class="line">   34) &quot;192.168.8.15&quot;</span><br><span class="line">   35) &quot;master-port&quot;</span><br><span class="line">   36) &quot;6379&quot;</span><br><span class="line">   37) &quot;slave-priority&quot;</span><br><span class="line">   38) &quot;100&quot;</span><br><span class="line">   39) &quot;slave-repl-offset&quot;</span><br><span class="line">   40) &quot;102356&quot;</span><br><span class="line">2)  1) &quot;name&quot;</span><br><span class="line">    2) &quot;192.168.8.12:6379&quot;</span><br><span class="line">    3) &quot;ip&quot;</span><br><span class="line">    4) &quot;192.168.8.12&quot;</span><br><span class="line">    5) &quot;port&quot;</span><br><span class="line">    6) &quot;6379&quot;</span><br><span class="line">    7) &quot;runid&quot;</span><br><span class="line">    8) &quot;a8c89824e632ae7e85f9129007d74a01be6a675a&quot;</span><br><span class="line">    9) &quot;flags&quot;</span><br><span class="line">   10) &quot;slave&quot;</span><br><span class="line">   11) &quot;link-pending-commands&quot;</span><br><span class="line">   12) &quot;0&quot;</span><br><span class="line">   13) &quot;link-refcount&quot;</span><br><span class="line">   14) &quot;1&quot;</span><br><span class="line">   15) &quot;last-ping-sent&quot;</span><br><span class="line">   16) &quot;0&quot;</span><br><span class="line">   17) &quot;last-ok-ping-reply&quot;</span><br><span class="line">   18) &quot;553&quot;</span><br><span class="line">   19) &quot;last-ping-reply&quot;</span><br><span class="line">   20) &quot;553&quot;</span><br><span class="line">   21) &quot;down-after-milliseconds&quot;</span><br><span class="line">   22) &quot;5000&quot;</span><br><span class="line">   23) &quot;info-refresh&quot;</span><br><span class="line">   24) &quot;7101&quot;</span><br><span class="line">   25) &quot;role-reported&quot;</span><br><span class="line">   26) &quot;slave&quot;</span><br><span class="line">   27) &quot;role-reported-time&quot;</span><br><span class="line">   28) &quot;508994&quot;</span><br><span class="line">   29) &quot;master-link-down-time&quot;</span><br><span class="line">   30) &quot;0&quot;</span><br><span class="line">   31) &quot;master-link-status&quot;</span><br><span class="line">   32) &quot;ok&quot;</span><br><span class="line">   33) &quot;master-host&quot;</span><br><span class="line">   34) &quot;192.168.8.15&quot;</span><br><span class="line">   35) &quot;master-port&quot;</span><br><span class="line">   36) &quot;6379&quot;</span><br><span class="line">   37) &quot;slave-priority&quot;</span><br><span class="line">   38) &quot;100&quot;</span><br><span class="line">   39) &quot;slave-repl-offset&quot;</span><br><span class="line">   40) &quot;102356&quot;</span><br></pre></td></tr></table></figure>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">复制：</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    配置slave节点：</span><br><span class="line">        redis-cli&gt; SLAVEOF &lt;MASTER_IP&gt; &lt;MASTER_PORT&gt;</span><br><span class="line">        redis-cli&gt; CONFIG SET masterauth &lt;PASSWORD&gt;</span><br><span class="line">        </span><br><span class="line">    配置参数：</span><br><span class="line">        *slaveof</span><br><span class="line">        *masterauth</span><br><span class="line">        </span><br><span class="line">        slave-serve-stale-data yes</span><br><span class="line">        slave-read-only yes</span><br><span class="line">        *repl-diskless-sync no</span><br><span class="line">            no, Disk-backed, Diskless</span><br><span class="line">            </span><br><span class="line">            新的从节点或某较长时间未能与主节点进行同步的从节点重新与主节点通信，需要做“full synchronization&quot;，此时其同步方式有两种style：</span><br><span class="line">                Disk-backend：主节点新创建快照文件于磁盘中，而后将其发送给从节点；</span><br><span class="line">                Diskless：主节占新创建快照后直接通过网络套接字文件发送给从节点；为了实现并行&gt;复制，通常需要在复制启动前延迟一个时间段；</span><br><span class="line">        </span><br><span class="line">        repl-diskless-sync-delay 5</span><br><span class="line">        repl-ping-slave-period 10</span><br><span class="line">            </span><br><span class="line">        *repl-timeout 60</span><br><span class="line">            </span><br><span class="line">        repl-disable-tcp-nodelay no</span><br><span class="line">        repl-backlog-size 1mb </span><br><span class="line">            </span><br><span class="line">        *slave-priority 100 </span><br><span class="line">            复制集群中，主节点故障时，sentinel应用场景中的主节点选举时使用的优先级；数字越小&gt;优先级越高，但0表示不参与选举；  </span><br><span class="line">            </span><br><span class="line">        min-slaves-to-write 3：主节点仅允许其能够通信的从节点数量大于等于此处的值时接受写操作</span><br><span class="line">；</span><br><span class="line">        min-slaves-max-lag 10：从节点延迟时长超出此处指定的时长时，主节点会拒绝写入操作；</span><br><span class="line">            </span><br><span class="line">sentinel：</span><br><span class="line">    主要完成三个功能：监控、通知、自动故障转移</span><br><span class="line">        </span><br><span class="line">        选举：流言协议、投票协议</span><br><span class="line">            </span><br><span class="line">    配置项：</span><br><span class="line">        port 26379</span><br><span class="line">        sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span><br><span class="line">        sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br><span class="line">            &lt;quorum&gt;表示sentinel集群的quorum机制，即至少有quorum个sentinel节点同时判定主节点&gt;故障时，才认为其真的故障；</span><br><span class="line">                s_down: subjectively down</span><br><span class="line">                o_down: objectively down</span><br><span class="line">        </span><br><span class="line">        sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line">            监控到指定的集群的主节点异常状态持续多久方才将标记为“故障”；</span><br><span class="line">            </span><br><span class="line">        sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span><br><span class="line">            指在failover过程中，能够被sentinel并行配置的从节点的数量；</span><br><span class="line">            </span><br><span class="line">        sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line">            sentinel必须在此指定的时长内完成故障转移操作，否则，将视为故障转移操作失败；</span><br><span class="line">            </span><br><span class="line">        sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line">            通知脚本，此脚本被自动传递多个参数；</span><br><span class="line">            </span><br><span class="line">        redis-cli -h SENTINEL_HOST -p SENTINEL_PORT</span><br><span class="line">            redis-cli&gt;</span><br><span class="line">                SENTINEL masters</span><br><span class="line">                SENTINEL slaves &lt;MASTER_NAME&gt;</span><br><span class="line">                SENTINEL failover &lt;MASTER_NAME&gt;</span><br><span class="line">                SENTINEL get-master-addr-by-name &lt;MASTER_NAME&gt;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>