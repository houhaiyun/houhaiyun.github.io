<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Linux set 命令 | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Linux-Command/">Linux Command</a></div><div class="post-time">2019-07-27</div></div></div><div class="container post-header"><h1>Linux set 命令</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-number">2.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-u"><span class="toc-number">3.</span> <span class="toc-text">set -u</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-1"><span class="toc-number">4.</span> <span class="toc-text">set + -</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-x"><span class="toc-number">5.</span> <span class="toc-text">set -x</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-v"><span class="toc-number">6.</span> <span class="toc-text">set -v</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-e"><span class="toc-number">7.</span> <span class="toc-text">set -e</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-o-pipefail"><span class="toc-number">8.</span> <span class="toc-text">set -o pipefail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组合操作"><span class="toc-number">9.</span> <span class="toc-text">组合操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考连接"><span class="toc-number">10.</span> <span class="toc-text">参考连接</span></a></li></ol></details></div><div class="container post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>set - 设置或取消Shell选项和位置参数的值。说白了就是用来配置Shell执行的方式，如是否使用通配符等，接下来我们介绍一些常见的使用方式。</p>
<a id="more"></a>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>直接执行set命令会显示当前Shell的变量，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:expand_aliases:extquote:force_fignore:histappend:hostcomplete:interactive_comments:login_shell:progcomp:promptvars:sourcepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=()</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">BASH_CMDS=()</span><br><span class="line">BASH_LINENO=()</span><br><span class="line">BASH_SOURCE=()</span><br><span class="line">BASH_VERSINFO=([0]=<span class="string">"4"</span> [1]=<span class="string">"2"</span> [2]=<span class="string">"46"</span> [3]=<span class="string">"2"</span> [4]=<span class="string">"release"</span> [5]=<span class="string">"x86_64-redhat-linux-gnu"</span>)</span><br><span class="line">BASH_VERSION=<span class="string">'4.2.46(2)-release'</span></span><br><span class="line">COLUMNS=189</span><br><span class="line">DIRSTACK=()</span><br><span class="line">EUID=0</span><br><span class="line">。。。 省略</span><br></pre></td></tr></table></figure>
<h3 id="set-u"><a href="#set-u" class="headerlink" title="set -u"></a>set -u</h3><p><code>set -u</code>当使用未定义的变量时，替换为报错信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 默认我们使用未定义变量，shell不会报错，并且打印一个空行出来</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 如果我们使用了set -u，那么如果遇到未定义的变量就会报错</span></span><br><span class="line">$ <span class="built_in">set</span> -u</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">-bash: a: unbound variable</span><br></pre></td></tr></table></figure>
<h3 id="set-1"><a href="#set-1" class="headerlink" title="set + -"></a>set + -</h3><p><code>set +</code>代表关闭此选项，<code>set -</code>代表开启选项。</p>
<p>使用上一个例子解释：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -u 代表开启此功能，遇到未定义的变量，显示报错信息。</span><br><span class="line"><span class="built_in">set</span> +u 代表关闭此功能，遇到未定义的变量，不显示是报错信息，打印空行出来。</span><br></pre></td></tr></table></figure>
<h3 id="set-x"><a href="#set-x" class="headerlink" title="set -x"></a>set -x</h3><p>默认我们执行bash脚本的时候，不会显示当前执行哪条命令，只显示其结果。<code>set -x</code>代表先打印出当前指定的命令选项，然后显示命令执行结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况</span></span><br><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ bash test.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加set -x</span></span><br><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ bash test.sh </span><br><span class="line">+ <span class="built_in">echo</span> /usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin 		<span class="comment"># 先打印执行的命令出来</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="set-v"><a href="#set-v" class="headerlink" title="set -v"></a>set -v</h3><p>Print shell input lines as they are read. 翻译过来是：在读取时打印shell输入行。和<code>set -x</code>类似先把命令打印出来，不过不会将变量的值显示出来，只显示在脚本中的命令，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 添加set -v</span></span><br><span class="line">[root@centos4 ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -v</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">[root@centos4 ~]<span class="comment"># bash test.sh </span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">### 默认</span></span><br><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">set</span> -v</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">$ bash test.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>
<h3 id="set-e"><a href="#set-e" class="headerlink" title="set -e"></a>set -e</h3><p>如果有命令执行为非0状态，那就立刻退出当前Shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 未使用set -e</span></span><br><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">asdf</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">$ bash test.sh 		<span class="comment"># 可以看到虽然asdf命令不存在但是仍然执行了echo命令</span></span><br><span class="line">test.sh: line 5: asdf: <span class="built_in">command</span> not found</span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"><span class="comment">### 使用set -e</span></span><br><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">asdf</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">$ bash test.sh 		<span class="comment"># asdf命令不存在，那么后续的也不会执行了</span></span><br><span class="line">test.sh: line 5: asdf: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>
<h3 id="set-o-pipefail"><a href="#set-o-pipefail" class="headerlink" title="set -o pipefail"></a>set -o pipefail</h3><p><code>set -e</code>有一个例外情况，就是不适用于管道命令。</p>
<p>所谓管道命令，就是多个子命令通过管道运算符（|）组合成为一个大的命令。Bash 会把最后一个子命令的返回值，作为整个命令的返回值。也就是说，只要最后一个子命令不失败，管道命令总是会执行成功，因此它后面命令依然会执行，<code>set -e</code>就失效了。</p>
<p>如下，<code>set -e</code>失效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">asdf | <span class="built_in">echo</span> asdf</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">$ bash test.sh 	<span class="comment"># 可以看到虽然有命令报错，但是依旧执行了后续的命令</span></span><br><span class="line">test.sh: line 5: asdf: <span class="built_in">command</span> not found</span><br><span class="line">asdf</span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>
<p>使用<code>set -o phpefail</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -eo phpefail</span><br><span class="line"></span><br><span class="line">asdf | <span class="built_in">echo</span> asdf</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">$ bash test.sh 		<span class="comment"># 可以看到管道中有命令执行失败就会不执行后续操作</span></span><br><span class="line">test.sh: line 3: <span class="built_in">set</span>: phpefail: invalid option name</span><br></pre></td></tr></table></figure>
<h3 id="组合操作"><a href="#组合操作" class="headerlink" title="组合操作"></a>组合操作</h3><p>我们可以写成这样的组合：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -euxo pipefail</span><br></pre></td></tr></table></figure>
<h3 id="参考连接"><a href="#参考连接" class="headerlink" title="参考连接"></a>参考连接</h3><ul>
<li><a href="http://www.ruanyifeng.com/blog/2017/11/bash-set.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/11/bash-set.html</a></li>
<li><a href="http://linuxcommand.org/lc3_man_pages/seth.html" target="_blank" rel="noopener">http://linuxcommand.org/lc3_man_pages/seth.html</a></li>
</ul>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>