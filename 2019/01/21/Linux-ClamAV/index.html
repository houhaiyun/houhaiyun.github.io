<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>linux杀毒软件ClamAV | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ClamAV/">ClamAV</a></div><div class="post-time">2019-01-21</div></div></div><div class="container post-header"><h1>linux杀毒软件ClamAV</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">3.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#升级病毒库"><span class="toc-number">4.</span> <span class="toc-text">升级病毒库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#命令扫描"><span class="toc-number">5.</span> <span class="toc-text">命令扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#计划任务"><span class="toc-number">6.</span> <span class="toc-text">计划任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#致谢"><span class="toc-number">7.</span> <span class="toc-text">致谢</span></a></li></ol></details></div><div class="container post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><a id="more"></a>
<p>ClamAV 杀毒是Linux平台最受欢迎的杀毒软件，ClamAV属于免费开源产品，支持多种平台，如：Linux/Unix、MAC OS X、Windows、OpenVMS。ClamAV是基于病毒扫描的命令行工具，但同时也有支持图形界面的ClamTK工具。ClamAV主要用于邮件服 务器扫描邮件。它有多种接口从邮件服务器扫描邮件，支持文件格式有如：ZIP、RAR、TAR、GZIP、BZIP2、HTML、DOC、PDF,、 SIS CHM、RTF等等。ClamAV有自动的数据库更新器，还可以从共享库中运行。命令行的界面让ClamAV运行流畅，你不必以后台进程的方式运行，当你 想扫描时只需输入扫描命令指定文件或目录就行。</p>
<p>官网：<a href="http://www.clamav.net/" target="_blank" rel="noopener">http://www.clamav.net/</a></p>
<center><img src="https://houhaiyun.github.io/img/images/ClamAV-1.png" title="ClamAV"></center>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 下载，目前最新稳定版本为clamav-0.100.2</span><br><span class="line">wget http://www.clamav.net/downloads/production/clamav-0.100.2.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 解压</span><br><span class="line">tar xf clamav-0.100.2.tar.gz</span><br><span class="line">cd clamav-0.100.2/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 编译安装</span><br><span class="line">./configure --prefix=/usr/local/clamav</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建目录和文件并授权</span><br><span class="line">mkdir /usr/local/clamav/logs   </span><br><span class="line">mkdir/usr/local/clamav/updata </span><br><span class="line">mkdir -p /usr/local/clamav/logs/</span><br><span class="line">mkdir -p /usr/local/clamav/updata</span><br><span class="line">touch /usr/local/clamav/logs/clamd.log</span><br><span class="line">touch /usr/local/clamav/logs/freshclam.log</span><br><span class="line">touch /usr/local/clamav/logs/freshclam.log</span><br><span class="line">chmod -R  777 /usr/local/clamav/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ll /usr/local/clamav/</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 root root  122 Dec  1 00:59 bin</span><br><span class="line">drwxr-xr-x. 2 root root   60 Dec  1 00:59 etc</span><br><span class="line">drwxr-xr-x. 2 root root   22 Dec  1 00:59 include</span><br><span class="line">drwxr-xr-x. 3 root root  150 Dec  1 00:59 lib</span><br><span class="line">drwxr-xr-x. 3 root root 4096 Dec  1 00:59 lib64</span><br><span class="line">drwxr-xr-x. 2 root root   19 Dec  1 00:59 sbin</span><br><span class="line">drwxr-xr-x. 3 root root   17 Dec  1 00:59 share</span><br><span class="line"></span><br><span class="line">cd /usr/local/clamav/etc/</span><br><span class="line">ls</span><br><span class="line">clamd.conf.sample  freshclam.conf.sample</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改配置文件</span><br><span class="line">cp clamd.conf.sample clamd.conf</span><br><span class="line">vim clamd.conf</span><br><span class="line"><span class="meta">#</span>Example    注释掉这一行.</span><br><span class="line">LogFile /usr/local/clamav/logs/clamd.log    </span><br><span class="line">PidFile /usr/local/clamav/updata/clamd.pid     </span><br><span class="line">DatabaseDirectory /usr/local/clamav/updata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cp freshclam.conf.sample freshclam.conf</span><br><span class="line">vim freshclam.conf</span><br><span class="line"><span class="meta">#</span>Example    注释掉这一行.  </span><br><span class="line">DatabaseDirectory /usr/local/clamav/updata</span><br><span class="line">UpdateLogFile /usr/local/clamav/logs/freshclam.log</span><br><span class="line">PidFile /usr/local/clamav/updata/freshclam.pid</span><br></pre></td></tr></table></figure>
<h3 id="升级病毒库"><a href="#升级病毒库" class="headerlink" title="升级病毒库"></a>升级病毒库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/clamav/bin/freshclam 	</span><br><span class="line">ClamAV update process started at Sat Dec  1 04:35:26 2018</span><br><span class="line">WARNING: DNS record is older than 3 hours.</span><br><span class="line">WARNING: Invalid DNS reply. Falling back to HTTP mode.</span><br><span class="line">Downloading main.cvd [100%]</span><br><span class="line">main.cvd updated (version: 58, sigs: 4566249, f-level: 60, builder: sigmgr)</span><br><span class="line">Downloading daily.cvd [ 11%]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 这个过程大约需要半个小时</span><br></pre></td></tr></table></figure>
<h3 id="命令扫描"><a href="#命令扫描" class="headerlink" title="命令扫描"></a>命令扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/clamav/bin/clamscan -r --remove	# 查杀当前目录并删除感染的文件</span><br><span class="line">/usr/local/clamav/bin/clamscan -r --bell -i / 	# 扫描所有文件并且显示有问题的文件的扫描结果</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> /usr/local/clamav/bin/clamscan -r --remove 		# 执行命令</span><br><span class="line">/usr/local/clamav/etc/clamd.conf.sample: OK</span><br><span class="line">/usr/local/clamav/etc/freshclam.conf.sample: OK</span><br><span class="line">/usr/local/clamav/etc/clamd.conf: OK</span><br><span class="line">/usr/local/clamav/etc/freshclam.conf: OK</span><br><span class="line"></span><br><span class="line">----------- SCAN SUMMARY -----------</span><br><span class="line">Known viruses: 6724677</span><br><span class="line">Engine version: 0.100.2</span><br><span class="line">Scanned directories: 1</span><br><span class="line">Scanned files: 4</span><br><span class="line">Infected files: 0</span><br><span class="line">Data scanned: 0.09 MB</span><br><span class="line">Data read: 0.05 MB (ratio 2.00:1)</span><br><span class="line">Time: 24.482 sec (0 m 24 s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>其他参数：</span><br><span class="line">-r/--recursive[=yes/no] 所有文件 </span><br><span class="line">--log=FILE/-l FILE  增加扫描报告 </span><br><span class="line">--move [路径] 移动病毒文件至..</span><br><span class="line">--remove [路径] 删除病毒文件 </span><br><span class="line">--quiet 只输出错误消息 </span><br><span class="line">--infected/-i 只输出感染文件 </span><br><span class="line">--suppress-ok-results/-o 跳过扫描OK的文件 </span><br><span class="line">--bell 扫描到病毒文件发出警报声音 </span><br><span class="line">--unzip(unrar) 解压压缩文件扫描</span><br></pre></td></tr></table></figure>
<h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">实际生产环境应用</span><br><span class="line">一般使用计划任务，让服务器每天晚上定时跟新和定时杀毒。保存杀毒日志，我的crontab文件如下</span><br><span class="line">16 4 * * * /usr/local/clamav/bin/freshclam</span><br><span class="line">16 5 * * * /usr/local/clamav/bin/clamscan --infected -r / --remove -l /var/log/clamscan.log</span><br></pre></td></tr></table></figure>
<p><strong>返回值</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">返回值 </span><br><span class="line">0 : 无病毒 </span><br><span class="line">1 : 发现病毒 </span><br><span class="line">40: 已经通过的未知选项 </span><br><span class="line">50: 数据库初始化错误 </span><br><span class="line">52: 不支持的文件格式 </span><br><span class="line">53: 无法打开目录 </span><br><span class="line">54: 不能打开文件(ofm)</span><br><span class="line">55: 读文件错误(ofm)</span><br><span class="line">56: Can't stat input file / directory.</span><br><span class="line">57: Can't get absolute path name of current working directory.</span><br><span class="line">58: I/O 错误, 请检查文件系统 </span><br><span class="line">59: 无法在/etc/passwd获得当前用户的信息 </span><br><span class="line">60: 无法在/etc/passwd获得'clamav'（默认名）用户的信息 </span><br><span class="line">61: Can't fork.</span><br><span class="line">63: 不能创建临时文件/目录(检查权限).</span><br><span class="line">64: 无法对临时目录进行写操作 (请指定另一个目录).</span><br><span class="line">70: 无法分配或释放内存 (calloc).</span><br><span class="line">71: 无法分配内存 (malloc).</span><br></pre></td></tr></table></figure>
<h3 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h3><p><a href="http://blog.51cto.com/renzhiyuan/1793944" target="_blank" rel="noopener">51CTO博客：Linux杀毒软件之ClamAV</a></p>
<p><a href="https://www.cnblogs.com/fatt/p/6306612.html" target="_blank" rel="noopener">博客园：linux杀毒软件clamav安装与使用</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>