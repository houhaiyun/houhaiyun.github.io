<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Varnish缓存清理 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Varnish/">Varnish</a></div><div class="post-time">2017-11-06</div></div></div><div class="container post-header"><h1>Varnish缓存清理</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存对象的修剪：purge"><span class="toc-number">1.</span> <span class="toc-text">缓存对象的修剪：purge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题如下："><span class="toc-number">2.</span> <span class="toc-text">问题如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-能执行purge操作"><span class="toc-number">2.1.</span> <span class="toc-text">(1) 能执行purge操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-何时执行purge操作"><span class="toc-number">2.2.</span> <span class="toc-text">(2) 何时执行purge操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存对象的修剪：ban"><span class="toc-number">3.</span> <span class="toc-text">缓存对象的修剪：ban</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用varnishadm中的ban"><span class="toc-number">3.1.</span> <span class="toc-text">使用varnishadm中的ban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义在配置文件中"><span class="toc-number">3.2.</span> <span class="toc-text">定义在配置文件中</span></a></li></ol></li></ol></details></div><div class="container post-content"><h3 id="缓存对象的修剪：purge"><a href="#缓存对象的修剪：purge" class="headerlink" title="缓存对象的修剪：purge"></a>缓存对象的修剪：purge</h3><p>当我们定义某一内容缓存一定的时间例如2小时，那么当此内容更新时恰好时间在2小时之内，那用户访问的就是旧的图片了，如何解决这个问题呢？</p>
<h3 id="问题如下："><a href="#问题如下：" class="headerlink" title="问题如下："></a>问题如下：</h3><p>设定某一类(例如：图片缓存2小时)内容的缓存时长；</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/varnish/default.vcl      # 修改配置文件；</span><br><span class="line">sub vcl_backend_response &#123;</span><br><span class="line">    if (bereq.url ~ &quot;(?i)\.(jgp|jpeg|png|gif)$&quot;)&#123;</span><br><span class="line">        unset beresp.http.Set-Cookie;</span><br><span class="line">        set beresp.ttl = 7200s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082</span><br><span class="line">200        </span><br><span class="line">-----------------------------</span><br><span class="line">Varnish Cache CLI 1.0</span><br><span class="line">-----------------------------</span><br><span class="line">Linux,3.10.0-514.el7.x86_64,x86_64,-smalloc,-smalloc,-hcritbit</span><br><span class="line">varnish-4.0.4 revision 386f712</span><br><span class="line"></span><br><span class="line">Type &apos;help&apos; for command list.</span><br><span class="line">Type &apos;quit&apos; to close CLI session.</span><br><span class="line"></span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">active          0 test2</span><br><span class="line"></span><br><span class="line">vcl.load test3 default.vcl</span><br><span class="line">200        </span><br><span class="line">VCL compiled.</span><br><span class="line">vcl.use test3</span><br><span class="line">200        </span><br><span class="line">VCL &apos;test3&apos; now active</span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">available       0 test2</span><br><span class="line">active          0 test3</span><br><span class="line"></span><br><span class="line"># 为后端web server准备图片；</span><br><span class="line">[root@web ~]# find /usr/share -iname &quot;*.jpg&quot;</span><br><span class="line">/usr/share/wallpapers/CentOS6/contents/images/simple_waves.jpg</span><br><span class="line">/usr/share/backgrounds/centos_1920x1200_logoonly.jpg</span><br><span class="line">/usr/share/backgrounds/centos_2048x1536_logoonly.jpg</span><br><span class="line">/usr/share/backgrounds/simple_waves.jpg</span><br><span class="line">[root@web ~]# cp /usr/share/backgrounds/simple_waves.jpg /var/www/html/test.jpg</span><br></pre></td></tr></table></figure>
<p>访问测试：</p>
<center><img src="https://houhaiyun.github.io/img/images/Varnish-Qingli-Cache-1.gif" title="访问测试"></center>

<h4 id="1-能执行purge操作"><a href="#1-能执行purge操作" class="headerlink" title="(1) 能执行purge操作"></a>(1) 能执行purge操作</h4><ol>
<li><p>在<code>web server</code> 将图片替换掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]# cp /usr/share/wallpapers/CentOS6/contents/images/simple_waves.jpg /var/www/html/test.jpg</span><br><span class="line">cp: overwrite `/var/www/html/test.jpg&apos;? y</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问测试，图片并没有替换掉</p>
</li>
</ol>
<center><img src="https://houhaiyun.github.io/img/images/Varnish-Qingli-Cache-2.gif" title="访问测试"></center>

<ol start="3">
<li>添加<code>purge</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/varnish/default.vcl      # 修改配置文件；</span><br><span class="line">sub vcl_purge &#123;</span><br><span class="line">	return (synth(200,&quot;Purged&quot;));</span><br><span class="line">&#125;</span><br><span class="line">sub vcl_recv &#123;          # 此在默认中有定义，可以不用添加；</span><br><span class="line">if (req.method == &quot;PURGE&quot;)&#123;</span><br><span class="line">    return(purge);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 刷新配置文件；</span><br><span class="line">[root@centos7 ~]# varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082</span><br><span class="line">200        </span><br><span class="line">-----------------------------</span><br><span class="line">Varnish Cache CLI 1.0</span><br><span class="line">-----------------------------</span><br><span class="line">Linux,3.10.0-514.el7.x86_64,x86_64,-smalloc,-smalloc,-hcritbit</span><br><span class="line">varnish-4.0.4 revision 386f712</span><br><span class="line"></span><br><span class="line">Type &apos;help&apos; for command list.</span><br><span class="line">Type &apos;quit&apos; to close CLI session.</span><br><span class="line"></span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">available       0 test2</span><br><span class="line">active          0 test3</span><br><span class="line"></span><br><span class="line">vcl.load test4 default.vcl</span><br><span class="line">200        </span><br><span class="line">VCL compiled.</span><br><span class="line">vcl.use test4</span><br><span class="line">200        </span><br><span class="line">VCL &apos;test4&apos; now active</span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">available       0 test2</span><br><span class="line">available       0 test3</span><br><span class="line">active          0 test4</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# curl -X PURGE http://192.168.8.15/test.jpg        # 执行PURGE请求；</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;200 Purged&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Error 200 Purged&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Purged&lt;/p&gt;</span><br><span class="line">    &lt;h3&gt;Guru Meditation:&lt;/h3&gt;</span><br><span class="line">    &lt;p&gt;XID: 31&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;p&gt;Varnish cache server&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>访问测试：图片已经替换；</p>
<center><img src="https://houhaiyun.github.io/img/images/Varnish-Qingli-Cache-3.gif" title="访问测试"></center>


<h4 id="2-何时执行purge操作"><a href="#2-何时执行purge操作" class="headerlink" title="(2) 何时执行purge操作"></a>(2) 何时执行purge操作</h4><p>如果有人对我们的缓存服务器执行<code>PURGE</code>操作的话，后果很可怕。我可以定义ACL只有特定的IP才能执行<code>PURGE</code>操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/varnish/default.vcl      # 修改配置文件；</span><br><span class="line">acl purgers &#123;       # 定义acl</span><br><span class="line">    &quot;127.0.0.1&quot;/8;</span><br><span class="line">&#125;</span><br><span class="line">sub vcl_recv &#123;</span><br><span class="line">if (req.method == &quot;PURGE&quot;)&#123;</span><br><span class="line">    if (!client.ip ~ purgers) &#123;     # 定义只有127.0.0.1才能使用PURGE;</span><br><span class="line">        return(synth(405,&quot;PURGE not allow for&quot; + client.ip));</span><br><span class="line">    &#125;</span><br><span class="line">    return(purge);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082       # 重新加载配置文件；</span><br><span class="line">200        </span><br><span class="line">-----------------------------</span><br><span class="line">Varnish Cache CLI 1.0</span><br><span class="line">-----------------------------</span><br><span class="line">Linux,3.10.0-514.el7.x86_64,x86_64,-smalloc,-smalloc,-hcritbit</span><br><span class="line">varnish-4.0.4 revision 386f712</span><br><span class="line"></span><br><span class="line">Type &apos;help&apos; for command list.</span><br><span class="line">Type &apos;quit&apos; to close CLI session.</span><br><span class="line"></span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">available       0 test2</span><br><span class="line">available       0 test3</span><br><span class="line">active          0 test4</span><br><span class="line"></span><br><span class="line">vcl.load test5 default.vcl</span><br><span class="line">200        </span><br><span class="line">VCL compiled.</span><br><span class="line">vcl.use test5</span><br><span class="line">200        </span><br><span class="line">VCL &apos;test5&apos; now active</span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">available       0 boot</span><br><span class="line">available       0 test1</span><br><span class="line">available       0 test2</span><br><span class="line">available       0 test3</span><br><span class="line">available       0 test4</span><br><span class="line">active          0 test5</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# curl -X PURGE http://192.168.8.15/test.jpg        # 再次PURGE已经被拒绝；</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;405 PURGE not allow for192.168.8.15&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Error 405 PURGE not allow for192.168.8.15&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;PURGE not allow for192.168.8.15&lt;/p&gt;</span><br><span class="line">    &lt;h3&gt;Guru Meditation:&lt;/h3&gt;</span><br><span class="line">    &lt;p&gt;XID: 32841&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;p&gt;Varnish cache server&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@centos7 ~]# curl -X PURGE http://127.0.0.1/test.jpg       # 已经清除掉；</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;200 Purged&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Error 200 Purged&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Purged&lt;/p&gt;</span><br><span class="line">    &lt;h3&gt;Guru Meditation:&lt;/h3&gt;</span><br><span class="line">    &lt;p&gt;XID: 31&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;p&gt;Varnish cache server&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="缓存对象的修剪：ban"><a href="#缓存对象的修剪：ban" class="headerlink" title="缓存对象的修剪：ban"></a>缓存对象的修剪：ban</h3><p>当我们清理某一类(例如：所有的图片)的文件，<code>PURGE</code>就有些麻烦了。</p>
<h4 id="使用varnishadm中的ban"><a href="#使用varnishadm中的ban" class="headerlink" title="使用varnishadm中的ban"></a>使用varnishadm中的ban</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Varnish ~]# varnishadm -S /etc/varnish/secret -T 127.0.0.1:6082 </span><br><span class="line">200        </span><br><span class="line">-----------------------------</span><br><span class="line">Varnish Cache CLI 1.0</span><br><span class="line">-----------------------------</span><br><span class="line">Linux,3.10.0-514.el7.x86_64,x86_64,-smalloc,-smalloc,-hcritbit</span><br><span class="line">varnish-4.0.4 revision 386f712</span><br><span class="line"></span><br><span class="line">Type &apos;help&apos; for command list.</span><br><span class="line">Type &apos;quit&apos; to close CLI session.</span><br><span class="line"></span><br><span class="line">vcl.list</span><br><span class="line">200        </span><br><span class="line">active          0 boot</span><br><span class="line"></span><br><span class="line">ban.list</span><br><span class="line">200        </span><br><span class="line">Present bans:</span><br><span class="line">1509930641.689327     0 C  </span><br><span class="line"></span><br><span class="line">ban req.url ~ (?i).(jgp|jpeg)       # 定义ban规则；</span><br><span class="line">200        </span><br><span class="line"></span><br><span class="line">ban.list</span><br><span class="line">200        </span><br><span class="line">Present bans:</span><br><span class="line">1509931580.224348     0    req.url ~ (?i).(jgp|jpeg)</span><br></pre></td></tr></table></figure>
<h4 id="定义在配置文件中"><a href="#定义在配置文件中" class="headerlink" title="定义在配置文件中"></a>定义在配置文件中</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if (req.method == &quot;BAN&quot;) &#123;</span><br><span class="line">					ban(&quot;req.http.host == &quot; + req.http.host + &quot; &amp;&amp; req.url == &quot; + req.url);</span><br><span class="line">					# Throw a synthetic page so the request won&apos;t go to the backend.</span><br><span class="line">					return(synth(200, &quot;Ban added&quot;));</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2017/11/06/Varnish-Qingli-Cache/';
var disqus_title = 'Varnish缓存清理';
var disqus_url = 'https://keeplearn.vip/2017/11/06/Varnish-Qingli-Cache/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>