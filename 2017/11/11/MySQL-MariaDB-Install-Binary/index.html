<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>MarraiDB安装-通用二进制方式 | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/MySQL/">MySQL</a></div><div class="post-time">2017-11-11</div></div></div><div class="container post-header"><h1>MarraiDB安装-通用二进制方式</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装方式"><span class="toc-number">1.</span> <span class="toc-text">安装方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mariadb下载"><span class="toc-number">2.</span> <span class="toc-text">mariadb下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-环境准备"><span class="toc-number">3.</span> <span class="toc-text">0. 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-准备用户"><span class="toc-number">4.</span> <span class="toc-text">1. 准备用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-准备二进制程序"><span class="toc-number">5.</span> <span class="toc-text">2. 准备二进制程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-准备配置文件"><span class="toc-number">6.</span> <span class="toc-text">3. 准备配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-创建数据库文件"><span class="toc-number">7.</span> <span class="toc-text">4. 创建数据库文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-准备服务脚本"><span class="toc-number">8.</span> <span class="toc-text">5. 准备服务脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-准备日志文件"><span class="toc-number">9.</span> <span class="toc-text">6. 准备日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-设置环境变量"><span class="toc-number">10.</span> <span class="toc-text">7. 设置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-连接数据库测试"><span class="toc-number">11.</span> <span class="toc-text">8. 连接数据库测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-安全初始化"><span class="toc-number">12.</span> <span class="toc-text">9. 安全初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-优化后连接"><span class="toc-number">13.</span> <span class="toc-text">10. 优化后连接</span></a></li></ol></details></div><div class="container post-content"><h3 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h3><p><code>MariaDB</code>的安装方法大致有以下四种，本例是关于通用二进制（俗称绿色包）格式的压缩文件进行安装。</p>
<ul>
<li>系统自带<code>RPM</code>包安装</li>
<li><code>MariaDB</code>官方自带的<code>rpm</code>包</li>
<li>通用二进制格式</li>
<li>源码编译</li>
</ul>
<a id="more"></a>
<h3 id="mariadb下载"><a href="#mariadb下载" class="headerlink" title="mariadb下载"></a>mariadb下载</h3><p><a href="http://mariadb.org/" target="_blank" rel="noopener">官网：http://mariadb.org/</a></p>
<p>目前最新版本为：10.3.1，稳定版本为：10.2.8</p>
<p>本次实验使用的版本为：稳定版10.2.8</p>
<h3 id="0-环境准备"><a href="#0-环境准备" class="headerlink" title="0. 环境准备"></a>0. 环境准备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# rpm -qa libaio        &lt;==判断系统安装这两个lib包，如果不安装给你这两个lib包在初始化是会报错的</span><br><span class="line">libaio-0.3.109-13.el7.x86_64</span><br><span class="line">libaio-0.3.109-13.el7.i686</span><br><span class="line">[root@centos7 dbdata]# yum install -y libaio.so.1</span><br><span class="line">[root@centos7 mysql]# yum install -y libaio.x86_64 libaio-devel.x86_64</span><br></pre></td></tr></table></figure>
<h3 id="1-准备用户"><a href="#1-准备用户" class="headerlink" title="1. 准备用户"></a>1. 准备用户</h3><p>mariadb和mysql运行使用的用户都是mysql，所以需要创建mysql用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# getent passwd mysql       &lt;==mysql用户不存在</span><br><span class="line">[root@centos7 ~]# useradd -r -m -d /app/dbdata -s /sbin/nologin mysql       &lt;==创建mysql用户，指定家目录为/app/dbdata，且为系统用户，默认shell为/sbin/nologin无法登陆</span><br><span class="line">[root@centos7 ~]# getent passwd mysql           &lt;==确认用户mysql信息    </span><br><span class="line">mysql: x:997:995::/app/dbdata:/sbin/nologin</span><br><span class="line">[root@centos7 ~]# ll /app/dbdata/ -d            &lt;==查看mysql家目录</span><br><span class="line">drwx------. 2 mysql mysql 62 Sep 25 09:43 /app/dbdata/</span><br></pre></td></tr></table></figure></p>
<h3 id="2-准备二进制程序"><a href="#2-准备二进制程序" class="headerlink" title="2. 准备二进制程序"></a>2. 准备二进制程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 app]# tar xf mariadb-10.2.8-linux-x86_64.tar.gz -C /usr/local/         &lt;==解压mariadb到/usr/local目录下</span><br><span class="line">[root@centos7 app]# cd /usr/local/      &lt;==切换到/usr/local目录</span><br><span class="line">[root@centos7 local]# ls</span><br><span class="line">bin  games    lib    libexec                      sbin   src</span><br><span class="line">etc  include  lib64  mariadb-10.2.8-linux-x86_64  share</span><br><span class="line">[root@centos7 local]# ln -sv mariadb-10.2.8-linux-x86_64/ mysql     &lt;==创建软链接，名字必须叫mysql</span><br><span class="line">‘mysql’ -&gt; ‘mariadb-10.2.8-linux-x86_64/’</span><br><span class="line">[root@centos7 local]# ls        &lt;==确认软链接已经别创建</span><br><span class="line">bin  games    lib    libexec                      mysql  share</span><br><span class="line">etc  include  lib64  mariadb-10.2.8-linux-x86_64  sbin   src</span><br></pre></td></tr></table></figure>
<h3 id="3-准备配置文件"><a href="#3-准备配置文件" class="headerlink" title="3. 准备配置文件"></a>3. 准备配置文件</h3><ul>
<li>配置格式：类<code>ini</code>格式，各程序由单个配置文件提供配<code>[prog_name]</code></li>
<li>配置文件查找次序：后面覆盖前面的配置文件</li>
<li><code>/etc/my.cnf</code> –&gt; <code>/etc/mysql/my.cnf</code> –&gt; <code>--default-extrafile=/PATH/TO/CONF_FILE</code> –&gt; <code>~/.my.cnf</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 local]# mkdir /etc/mysql      &lt;==创建mysql目录</span><br><span class="line">[root@centos7 mysql]# cp /usr/local/mariadb-10.2.8-linux-x86_64/support-files/my-huge.cnf /etc/mysql/my.cnf           &lt;==cpmysql配置文件</span><br><span class="line">[root@centos7 mysql]# vim /etc/mysql/my.cnf     &lt;==编辑配置文件，添加一下三行，在[mysqld]后面</span><br><span class="line">[mysqld]            </span><br><span class="line">datadir = /app/dbdata       &lt;==指定数据库文件路径，必须指定为/app/dbdata</span><br><span class="line">innodb_file_per_table = on  &lt;==使用innodb引擎，每个表都是一个独立的文件</span><br><span class="line">skip_name_resolve = on      &lt;==禁止主机名解析</span><br></pre></td></tr></table></figure>
<h3 id="4-创建数据库文件"><a href="#4-创建数据库文件" class="headerlink" title="4. 创建数据库文件"></a>4. 创建数据库文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# ls /app/dbdata/           &lt;==没有文件</span><br><span class="line">[root@centos7 mysql]# ./scripts/mysql_install_db --help     &lt;==查看此脚本的帮助信息，此脚本是用于创建数据库文件的脚本，创建数据库文件相当于初始化</span><br><span class="line">Usage: ./scripts/mysql_install_db [OPTIONS]</span><br><span class="line">  --auth-root-authentication-method=normal|socket</span><br><span class="line">                       Chooses the authentication method for the created initial</span><br><span class="line">                       root user. The default is &apos;normal&apos; to creates a root user</span><br><span class="line">                       that can login without password, which can be insecure.</span><br><span class="line">                       The alternative &apos;socket&apos; allows only the system root user</span><br><span class="line">                       to login as MariaDB root; this requires the unix socket</span><br><span class="line">                       authentication plugin.</span><br><span class="line">  --auth-root-socket-user=user</span><br><span class="line">                       Used with --auth-root-authentication-method=socket. It</span><br><span class="line">                       specifies the name of the MariaDB root account, as well</span><br><span class="line">                       as of the system account allowed to access it. Defaults</span><br><span class="line">                       to &apos;root&apos;.</span><br><span class="line">  --basedir=path       The path to the MariaDB installation directory.</span><br><span class="line">  --builddir=path      If using --srcdir with out-of-directory builds, you</span><br><span class="line">                       will need to set this to the location of the build</span><br><span class="line">                       directory where built files reside.</span><br><span class="line">  --cross-bootstrap    For internal use.  Used when building the MariaDB system</span><br><span class="line">                       tables on a different host than the target.</span><br><span class="line">  --datadir=path       The path to the MariaDB data directory.</span><br><span class="line">  --defaults-extra-file=name</span><br><span class="line">                       Read this file after the global files are read.</span><br><span class="line">  --defaults-file=name Only read default options from the given file name.</span><br><span class="line">  --force              Causes mysql_install_db to run even if DNS does not</span><br><span class="line">                       work.  In that case, grant table entries that</span><br><span class="line">                       normally use hostnames will use IP addresses.</span><br><span class="line">  --help               Display this help and exit.                     </span><br><span class="line">  --ldata=path         The path to the MariaDB data directory. Same as</span><br><span class="line">                       --datadir.</span><br><span class="line">  --no-defaults        Don&apos;t read default options from any option file.</span><br><span class="line">  --defaults-file=path Read only this configuration file.</span><br><span class="line">  --rpm                For internal use.  This option is used by RPM files</span><br><span class="line">                       during the MariaDB installation process.</span><br><span class="line">  --skip-auth-anonymous-user</span><br><span class="line">                       Do not install an unprivileged anonymous user.</span><br><span class="line">  --skip-name-resolve  Use IP addresses rather than hostnames when creating</span><br><span class="line">                       grant table entries.  This option can be useful if</span><br><span class="line">                       your DNS does not work.</span><br><span class="line">  --srcdir=path        The path to the MariaDB source directory.  This option</span><br><span class="line">                       uses the compiled binaries and support files within the</span><br><span class="line">                       source tree, useful for if you don&apos;t want to install</span><br><span class="line">                       MariaDB yet and just want to create the system tables.</span><br><span class="line">  --user=user_name     The login username to use for running mysqld.  Files</span><br><span class="line">                       and directories created by mysqld will be owned by this</span><br><span class="line">                       user.  You must be root to use this option.  By default</span><br><span class="line">                       mysqld runs using your current login name and files and</span><br><span class="line">                       directories that it creates will be owned by you.</span><br><span class="line"></span><br><span class="line">All other options are passed to the mysqld program</span><br><span class="line"></span><br><span class="line">[root@centos7 mysql]# ./scripts/mysql_install_db --datadir=/app/dbdata --user=mysql        &lt;==指定mysql数据存储目录为/app/dbdata，用户为mysql</span><br><span class="line">Installing MariaDB/MySQL system tables in &apos;/app/dbdata&apos; ...</span><br><span class="line">2017-09-25 11:02:27 140386981918528 [Warning] &apos;THREAD_CONCURRENCY&apos; is deprecated and will be removed in a future release.</span><br><span class="line">2017-09-25 11:02:30 140386857879296 [Warning] Failed to load slave replication state from table mysql.gtid_slave_pos: 1146: Table &apos;mysql.gtid_slave_pos&apos; doesn&apos;t exist</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">To start mysqld at boot time you have to copy</span><br><span class="line">support-files/mysql.server to the right place for your system</span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER TO SET A PASSWORD FOR THE MariaDB root USER !</span><br><span class="line">To do so, start the server, then issue the following commands:</span><br><span class="line"></span><br><span class="line">&apos;./bin/mysqladmin&apos; -u root password &apos;new-password&apos;</span><br><span class="line">&apos;./bin/mysqladmin&apos; -u root -h centos7.haiyun.com password &apos;new-password&apos;</span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line">&apos;./bin/mysql_secure_installation&apos;</span><br><span class="line"></span><br><span class="line">which will also give you the option of removing the test</span><br><span class="line">databases and anonymous user created by default.  This is</span><br><span class="line">strongly recommended for production servers.</span><br><span class="line"></span><br><span class="line">See the MariaDB Knowledgebase at http://mariadb.com/kb or the</span><br><span class="line">MySQL manual for more instructions.</span><br><span class="line"></span><br><span class="line">You can start the MariaDB daemon with:</span><br><span class="line">cd &apos;.&apos; ; ./bin/mysqld_safe --datadir=&apos;/app/dbdata&apos;</span><br><span class="line"></span><br><span class="line">You can test the MariaDB daemon with mysql-test-run.pl</span><br><span class="line">cd &apos;./mysql-test&apos; ; perl mysql-test-run.pl</span><br><span class="line"></span><br><span class="line">Please report any problems at http://mariadb.org/jira</span><br><span class="line"></span><br><span class="line">The latest information about MariaDB is available at http://mariadb.org/.</span><br><span class="line">You can find additional information about the MySQL part at:</span><br><span class="line">http://dev.mysql.com</span><br><span class="line">Consider joining MariaDB&apos;s strong and vibrant community:</span><br><span class="line">https://mariadb.org/get-involved/</span><br><span class="line"></span><br><span class="line">at http://mariadb.org/jira</span><br><span class="line">[root@centos7 mysql]# ls /app/dbdata/       &lt;==可以看到文件已经生成</span><br><span class="line">aria_log.00000001  ibdata1      mysql             mysql-bin.state</span><br><span class="line">aria_log_control   ib_logfile0  mysql-bin.000001  performance_schema</span><br><span class="line">ib_buffer_pool     ib_logfile1  mysql-bin.index   test</span><br></pre></td></tr></table></figure>
<h3 id="5-准备服务脚本"><a href="#5-准备服务脚本" class="headerlink" title="5. 准备服务脚本"></a>5. 准备服务脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# pwd</span><br><span class="line">/usr/local/mysql</span><br><span class="line">[root@centos7 mysql]# cp support-files/mysql.server /etc/init.d/mysqld </span><br><span class="line">[root@centos7 mysql]# chkconfig --list</span><br><span class="line"></span><br><span class="line">Note: This output shows SysV services only and does not include native</span><br><span class="line">      systemd services. SysV configuration data might be overridden by native</span><br><span class="line">      systemd configuration.</span><br><span class="line"></span><br><span class="line">      If you want to list systemd services use &apos;systemctl list-unit-files&apos;.</span><br><span class="line">      To see services enabled on particular target use</span><br><span class="line">      &apos;systemctl list-dependencies [target]&apos;.</span><br><span class="line"></span><br><span class="line">netconsole     	0:off	1:off	2:off	3:off	4:off	5:off	6:off</span><br><span class="line">network        	0:off	1:off	2:on	3:on	4:on	5:on	6:off</span><br><span class="line">[root@centos7 mysql]# chkconfig --add mysqld</span><br><span class="line">[root@centos7 mysql]# chkconfig --list</span><br><span class="line"></span><br><span class="line">Note: This output shows SysV services only and does not include native</span><br><span class="line">      systemd services. SysV configuration data might be overridden by native</span><br><span class="line">      systemd configuration.</span><br><span class="line"></span><br><span class="line">      If you want to list systemd services use &apos;systemctl list-unit-files&apos;.</span><br><span class="line">      To see services enabled on particular target use</span><br><span class="line">      &apos;systemctl list-dependencies [target]&apos;.</span><br><span class="line"></span><br><span class="line">mysqld         	0:off	1:off	2:on	3:on	4:on	5:on	6:off</span><br><span class="line">netconsole     	0:off	1:off	2:off	3:off	4:off	5:off	6:off</span><br><span class="line">network        	0:off	1:off	2:on	3:on	4:on	5:on	6:off</span><br><span class="line">[root@centos7 mysql]# chkconfig mysqld on</span><br></pre></td></tr></table></figure>
<h3 id="6-准备日志文件"><a href="#6-准备日志文件" class="headerlink" title="6. 准备日志文件"></a>6. 准备日志文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# service mysqld start</span><br><span class="line">Starting mysqld (via systemctl):                           [  OK  ]</span><br><span class="line">[root@centos7 mysql]# setfacl -m u:mysql:rwx /var/log/</span><br><span class="line">[root@centos7 mysql]# service mysqld start</span><br><span class="line">Starting mysqld (via systemctl):  Job for mysqld.service failed because the control process exited with error code. See &quot;systemctl status mysqld.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">                                                           [FAILED]</span><br><span class="line">[root@centos7 mysql]# mkdir /var/log/mariadb        &lt;==创建日志目录</span><br><span class="line">[root@centos7 mysql]# touch /var/log/mariadb/mariadb.log    &lt;==穿件日志文件</span><br><span class="line">[root@centos7 mysql]# setfacl -R -m u:mysql:rwx /var/log/mariadb        &lt;==设置acl使mysql用户对/var/log/mariadb目录有权限</span><br></pre></td></tr></table></figure>
<h3 id="7-设置环境变量"><a href="#7-设置环境变量" class="headerlink" title="7. 设置环境变量"></a>7. 设置环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# vim /etc/profile.d/mysql.sh</span><br><span class="line">export PATH=/usr/local/mysql/bin/:$PATH</span><br><span class="line">[root@centos7 mysql]# source /etc/profile.d/mysql.sh    &lt;==同步环境变量到本地</span><br><span class="line">[root@centos7 mysql]# echo $PATH</span><br><span class="line">/usr/local/mysql/bin/:/usr/local/mysql/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure>
<h3 id="8-连接数据库测试"><a href="#8-连接数据库测试" class="headerlink" title="8. 连接数据库测试"></a>8. 连接数据库测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 12</span><br><span class="line">Server version: 10.2.8-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW DATABASES;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SELECT USER();</span><br><span class="line">+----------------+</span><br><span class="line">| USER()         |</span><br><span class="line">+----------------+</span><br><span class="line">| root@localhost |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="9-安全初始化"><a href="#9-安全初始化" class="headerlink" title="9. 安全初始化"></a>9. 安全初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# mysql_secure_installation         &lt;==如果没有此安全初始化脚本，可能是环境变量的问题</span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to log into MariaDB to secure it, we&apos;ll need the current</span><br><span class="line">password for the root user.  If you&apos;ve just installed MariaDB, and</span><br><span class="line">you haven&apos;t set the root password yet, the password will be blank,</span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line">Enter current password for root (enter for none): </span><br><span class="line">OK, successfully used password, moving on...</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log into the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line">Set root password? [Y/n] y</span><br><span class="line">New password: </span><br><span class="line">Re-enter new password: </span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">By default, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line">to log into MariaDB without having to have a user account created for</span><br><span class="line">them.  This is intended only for testing, and to make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving into a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from &apos;localhost&apos;.  This</span><br><span class="line">ensures that someone cannot guess at the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] n</span><br><span class="line"> ... skipping.</span><br><span class="line"></span><br><span class="line">By default, MariaDB comes with a database named &apos;test&apos; that anyone can</span><br><span class="line">access.  This is also intended only for testing, and should be removed</span><br><span class="line">before moving into a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database and access to it? [Y/n] n</span><br><span class="line"> ... skipping.</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">All done!  If you&apos;ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks for using MariaDB!</span><br></pre></td></tr></table></figure>
<h3 id="10-优化后连接"><a href="#10-优化后连接" class="headerlink" title="10. 优化后连接"></a>10. 优化后连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mysql]# mysql         &lt;==优化后就无法连接了</span><br><span class="line">ERROR 1045 (28000): Access denied for user &apos;root&apos;@&apos;localhost&apos; (using password: NO)</span><br><span class="line">[root@centos7 mysql]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 19</span><br><span class="line">Server version: 10.2.8-MariaDB-log MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>