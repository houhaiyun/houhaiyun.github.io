<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>HAProxy log日志设置 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Haproxy/">Haproxy</a></div><div class="post-time">2017-11-05</div></div></div><div class="container post-header"><h1>HAProxy log日志设置</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#日志记录在本机"><span class="toc-number">1.</span> <span class="toc-text">日志记录在本机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日志记录在远程主机"><span class="toc-number">2.</span> <span class="toc-text">日志记录在远程主机</span></a></li></ol></details></div><div class="container post-content"><h3 id="日志记录在本机"><a href="#日志记录在本机" class="headerlink" title="日志记录在本机"></a>日志记录在本机</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@HAProxy ~]# vim /etc/haproxy/haproxy.cfg          # haproxy服务默认已经定义日志；</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line">[root@HAProxy ~]# vim /etc/rsyslog.conf             # 只需要修改日志服务配置文件，添加local2.*，并开启可以网络传输日志开关，就可以将日志记录到本机了；</span><br><span class="line">$ModLoad imudp</span><br><span class="line">$UDPServerRun 514</span><br><span class="line"># Save HAProxy log</span><br><span class="line">local2.*                                                /var/log/haproxy.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@HAProxy ~]# service haproxy restart       </span><br><span class="line">Stopping haproxy:                                          [  OK  ]</span><br><span class="line">Starting haproxy:                                          [  OK  ]</span><br><span class="line">[root@HAProxy ~]# service rsy</span><br><span class="line">rsync    rsyslog  </span><br><span class="line">[root@HAProxy ~]# service rsyslog restart           # 重启日志服务；</span><br><span class="line">Shutting down system logger:                               [  OK  ]</span><br><span class="line">Starting system logger:                                    [  OK  ]</span><br><span class="line">[root@HAProxy ~]# ls -l /var/log/haproxy.log        # 日志文件已经创建；</span><br><span class="line">-rw-------. 1 root root 0 Oct 31 20:22 /var/log/haproxy.log</span><br><span class="line">[root@HAProxy ~]# curl 192.168.8.11         # 访问测试；</span><br><span class="line">web1</span><br><span class="line">[root@HAProxy ~]# curl 192.168.8.11</span><br><span class="line">web2</span><br><span class="line">[root@HAProxy ~]# tail /var/log/haproxy.log         # 查看日志，已经记录；</span><br><span class="line">Oct 31 20:23:33 localhost haproxy[13640]: 192.168.8.11:44506 [31/Oct/2017:20:23:33.508] webser webser/ser1 0/0/0/1/1 200 263 - - ---- 1/1/0/0/0 0/0 &quot;GET / HTTP/1.1&quot;</span><br><span class="line">Oct 31 20:23:34 localhost haproxy[13640]: 192.168.8.11:44510 [31/Oct/2017:20:23:34.163] webser webser/ser2 0/0/0/1/1 200 271 - - ---- 1/1/0/0/0 0/0 &quot;GET / HTTP/1.1&quot;</span><br></pre></td></tr></table></figure>
<h3 id="日志记录在远程主机"><a href="#日志记录在远程主机" class="headerlink" title="日志记录在远程主机"></a>日志记录在远程主机</h3><p>例如，我们将日志记录在<code>192.168.8.12</code>这台主机上面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@HAProxy ~]# vim /etc/haproxy/haproxy.cfg          # 修改haproxy配置文件，将本地的IP改为远程日志服务器的iP;</span><br><span class="line">    log         192.168.8.12 local2</span><br><span class="line"></span><br><span class="line">[root@HAProxy ~]# service haproxy restart</span><br><span class="line">Stopping haproxy:                                          [  OK  ]</span><br><span class="line">Starting haproxy:                                          [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@Log ~]# vim /etc/rsyslog.conf</span><br><span class="line">$ModLoad imudp</span><br><span class="line">$UDPServerRun 514</span><br><span class="line">local2.*                                                /var/log/haproxy.log</span><br><span class="line">[root@Log ~]# systemctl restart rsyslog.service</span><br><span class="line">[root@Log ~]# ll /var/log/haproxy.log </span><br><span class="line">-rw------- 1 root root 67 Oct 31 20:32 /var/log/haproxy.log</span><br><span class="line">[root@HAProxy ~]# curl 192.168.8.11         # 访问测试；</span><br><span class="line">web1</span><br><span class="line">[root@HAProxy ~]# curl 192.168.8.11</span><br><span class="line">web2</span><br><span class="line"></span><br><span class="line">[root@Log ~]# tail /var/log/haproxy.log         # 查看日志，已经发送过来；</span><br><span class="line">Oct 31 20:33:06 192.168.8.11 haproxy[13827]: Proxy webser started.</span><br><span class="line">Oct 31 20:33:38 192.168.8.11 haproxy[13828]: 192.168.8.11:44514 [31/Oct/2017:20:33:38.978] webser webser/ser1 0/0/0/1/1 200 263 - - ---- 1/1/0/1/0 0/0 &quot;GET / HTTP/1.1&quot;</span><br><span class="line">Oct 31 20:33:39 192.168.8.11 haproxy[13828]: 192.168.8.11:44518 [31/Oct/2017:20:33:39.644] webser webser/ser2 0/0/0/1/1 200 271 - - ---- 1/1/0/1/0 0/0 &quot;GET / HTTP/1.1&quot;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2017/11/05/Haproxy-Log/';
var disqus_title = 'HAProxy log日志设置';
var disqus_url = 'https://keeplearn.vip/2017/11/05/Haproxy-Log/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>