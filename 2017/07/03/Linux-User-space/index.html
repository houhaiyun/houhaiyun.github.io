<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>用户空间和内核空间 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/用户空间和内核空间/">用户空间和内核空间</a></div><div class="post-time">2017-07-03</div></div></div><div class="container post-header"><h1>用户空间和内核空间</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户空间：-User-space"><span class="toc-number">1.</span> <span class="toc-text">用户空间： User space</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内核空间：-Kernel-space"><span class="toc-number">2.</span> <span class="toc-text">内核空间： Kernel space</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区别"><span class="toc-number">3.</span> <span class="toc-text">区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单处程序时间统计使用time"><span class="toc-number">4.</span> <span class="toc-text">单处程序时间统计使用time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#致谢"><span class="toc-number">5.</span> <span class="toc-text">致谢</span></a></li></ol></details></div><div class="container post-content"><h3 id="用户空间：-User-space"><a href="#用户空间：-User-space" class="headerlink" title="用户空间： User space"></a>用户空间： User space</h3><ul>
<li>用户程序的运行空间。为了安全，它们是隔离的，即使用户的程序崩溃了，内核也不受影响</li>
<li>只能执行简单的运算，不能直接调用系统资源，必须通过系统接口（<code>system call</code>），才能向内核发出指令 </li>
</ul>
<a id="more"></a>
<h3 id="内核空间：-Kernel-space"><a href="#内核空间：-Kernel-space" class="headerlink" title="内核空间： Kernel space"></a>内核空间： Kernel space</h3><ul>
<li>是 <code>Linux</code> 内核的运行空间</li>
</ul>
<ul>
<li>可以执行任意命令，调用系统的一切资源 </li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str = "www.ihaiyun.cc" # 用户空间</span><br><span class="line">x = x + 2</span><br><span class="line">file.write(str) # 切换到内核空间</span><br><span class="line">y = x + 4 # 切换回用户空间</span><br></pre></td></tr></table></figure>
<p>上面代码中，第一行和第二行都是简单的赋值运算，在 <code>User space</code> 执行。第三行需要写入文件，就要切换到 <code>Kernel space</code>，因为用户不能直接写文件，必须通过内核安排。第四行又是赋值运算，就切换回 <code>User space</code>。</p>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><ul>
<li>内核空间可以访问所有的<code>CPU</code>指令和所有的内存空间、<code>I/O</code>空间。</li>
<li>用户空间只能访问有限的资源，若需要特殊权限，可以通过系统调用获取相应的资源。</li>
<li>用户空间允许页面中断，而内核空间则不允许。</li>
<li><code>x86 CPU</code>中用户空间是<code>0-3G</code>的地址范围，内核空间是<code>3G-4G</code>的地址范围。<code>x86_64 CPU</code>用户空间地址范围为<code>0x0000000000000000</code> – <code>0x00007fffffffffff</code>，内核地址空间为<code>0xffff880000000000</code>~最大地址。</li>
<li>内核空间和用户空间是针对线性地址空间的。</li>
<li>所有内核进（线）程共用一个地址空间，而用户进程都有各自的地址空间。</li>
</ul>
<center><img src="https://houhaiyun.github.io/img/images/Linux-User-space-1.png" title="用户空间和内核空间"></center>


<h3 id="单处程序时间统计使用time"><a href="#单处程序时间统计使用time" class="headerlink" title="单处程序时间统计使用time"></a>单处程序时间统计使用time</h3><p>如果想查看单个程序的耗时，一般使用<code>time</code>命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]# time ifconfig </span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.252.210  netmask 255.255.0.0  broadcast 172.18.255.255</span><br><span class="line">        inet6 fe80::20c:29ff:fef8:15f5  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:f8:15:f5  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 16981  bytes 1356968 (1.2 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 93  bytes 23042 (22.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens34: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.8.135  netmask 255.255.255.0  broadcast 192.168.8.255</span><br><span class="line">        inet6 fe80::20c:29ff:fef8:15ff  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:f8:15:ff  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 11279  bytes 1036041 (1011.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 59808  bytes 130371849 (124.3 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255</span><br><span class="line">        ether 52:54:00:d7:0c:d1  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">real	0m0.003s</span><br><span class="line">user	0m0.001s</span><br><span class="line">sys	0m0.002s</span><br></pre></td></tr></table></figure>
<p>程序名之前加上<code>time</code>命令，会在程序执行完毕以后，默认显示三行统计。</p>
<ul>
<li><code>real</code>：程序从开始运行到结束的全部时间，这是用户能感知到的时间，包括 CPU 切换去执行其他任务的时间。</li>
<li><code>user</code>：程序在 User space 执行的时间</li>
<li><code>sys</code>：程序在 Kernel space 执行的时间</li>
</ul>
<p><code>user</code>和<code>sys</code>之和，一般情况下，应该小于<code>real</code>。</p>
<h3 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h3><p><a href="https://www.ait24.com/1256.html" target="_blank" rel="noopener">爱T网：linux中的内核空间Kernel space用户空间User space</a></p>
<p><a href="http://ilinuxkernel.com/?p=528" target="_blank" rel="noopener">Linux内核空间与用户空间</a></p>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2017/07/03/Linux-User-space/';
var disqus_title = '用户空间和内核空间';
var disqus_url = 'https://keeplearn.vip/2017/07/03/Linux-User-space/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>