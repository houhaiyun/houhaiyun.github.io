<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>模块 ngx_http_headers_module | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/">Nginx</a></div><div class="post-time">2017-10-27</div></div></div><div class="container post-header"><h1>模块 ngx_http_headers_module</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add-header-name-value-always"><span class="toc-number">2.</span> <span class="toc-text">add_header name value [always];</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add-trailer-name-value-always"><span class="toc-number">3.</span> <span class="toc-text">add_trailer name value [always];</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现add-header-name"><span class="toc-number">4.</span> <span class="toc-text">实现add_header name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现add-trailer-name"><span class="toc-number">5.</span> <span class="toc-text">实现add_trailer name</span></a></li></ol></details></div><div class="container post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>该<code>ngx_http_headers_module</code>模块允许将<code>“Expires”和“Cache-Control”</code>头字段以及任意字段添加到响应头。</p>
<p>向由代理服务器响应给客户端的响应报文添加自定义首部，或修改指定首部的值</p>
<h3 id="add-header-name-value-always"><a href="#add-header-name-value-always" class="headerlink" title="add_header name value [always];"></a>add_header name value [always];</h3><p><strong>官网帮助</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	add_header name value [always];</span><br><span class="line">Default:	—</span><br><span class="line">Context:	http, server, location, if in location</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>如果响应代码等于200,201（1.3.10），204,206,301,302,303,304,307（1.1.16,1.0.13）或308（1.13），则将指定的字段添加到响应头部.0）。该值可以包含变量。</p>
<p>可能有几个add_header指令。当且仅当add_header 在当前级别上没有定义指令时，这些指令将从上一级继承 。</p>
<p>如果always指定了参数（1.7.5），则将添加头字段，而不管响应代码如何。</p>
<p>添加自定义首部</p>
<h3 id="add-trailer-name-value-always"><a href="#add-trailer-name-value-always" class="headerlink" title="add_trailer name value [always];"></a>add_trailer name value [always];</h3><p><strong>官网帮助</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	add_trailer name value [always];</span><br><span class="line">Default:	—</span><br><span class="line">Context:	http, server, location, if in location</span><br><span class="line">This directive appeared in version 1.13.2.</span><br></pre></td></tr></table></figure></p>
<p>将响应代码等于200，201，206，301，302，303，307或308的指定字段添加到响应的结尾。该值可以包含变量。</p>
<p>可能有几个add_trailer指令。当且仅当add_trailer 在当前级别上没有定义指令时，这些指令将从上一级继承 。</p>
<p>如果always指定了参数，则无论响应代码如何，都将添加指定的字段。</p>
<p>添加自定义响应信息的尾部</p>
<h3 id="实现add-header-name"><a href="#实现add-header-name" class="headerlink" title="实现add_header name"></a>实现add_header name</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/nginx/conf.d/vhost.conf </span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen   default_server ;</span><br><span class="line">    listen 80  ;</span><br><span class="line">    server_name www.a.com ;</span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    error_log /var/log/nginx/a.com.error.log ;</span><br><span class="line">    access_log /var/log/nginx/a.com.access.log main ;</span><br><span class="line">    location /html &#123;</span><br><span class="line">        proxy_set_header Real-server $remote_addr ;</span><br><span class="line">        proxy_pass http://192.168.8.136;</span><br><span class="line">        add_header X-via $server_addr ;</span><br><span class="line">        add_header X-cache $upstream_cache_status;</span><br><span class="line">        add_header X-Accel $server_name ;</span><br><span class="line">    &#125;</span><br><span class="line">    proxy_cache proxycache ; </span><br><span class="line">    proxy_cache_key $request_uri ;</span><br><span class="line">    proxy_cache_valid 200 302 301 1h ;</span><br><span class="line">    proxy_cache_valid any 1m ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx</span><br><span class="line"></span><br><span class="line">[root@CLIENT ~]# curl -I  http://192.168.8.140/html/        # 查看访问包头，添加成功</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.10.2</span><br><span class="line">Date: Fri, 27 Oct 2017 09:22:21 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Length: 503737</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Last-Modified: Fri, 27 Oct 2017 08:52:43 GMT</span><br><span class="line">ETag: &quot;2205a0-7afb9-55c836975649a&quot;</span><br><span class="line">X-via: 192.168.8.140</span><br><span class="line">X-cache: HIT</span><br><span class="line">X-Accel: www.a.com</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>
<h3 id="实现add-trailer-name"><a href="#实现add-trailer-name" class="headerlink" title="实现add_trailer name"></a>实现add_trailer name</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/nginx/conf.d/vhost.conf </span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen   default_server ;</span><br><span class="line">    listen 80  ;</span><br><span class="line">    server_name www.a.com ;</span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    error_log /var/log/nginx/a.com.error.log ;</span><br><span class="line">    access_log /var/log/nginx/a.com.access.log main ;</span><br><span class="line">    location /html &#123;</span><br><span class="line">        proxy_set_header Real-server $remote_addr ;</span><br><span class="line">        proxy_pass http://192.168.8.136;</span><br><span class="line">        add_header X-via $server_addr ;</span><br><span class="line">        add_header X-cache $upstream_cache_status;</span><br><span class="line">        add_header X-Accel $server_name ;</span><br><span class="line">        add_header Via $server_addr ;</span><br><span class="line">        add_header Cache $upstream_cache_status;  </span><br><span class="line">        add_header Accel $server_name ;</span><br><span class="line">    &#125;</span><br><span class="line">    proxy_cache proxycache ; </span><br><span class="line">    proxy_cache_key $request_uri ;</span><br><span class="line">    proxy_cache_valid 200 302 301 1h ;</span><br><span class="line">    proxy_cache_valid any 1m ;</span><br><span class="line">&#125;</span><br><span class="line">[root@Nginx-Server ~]# nginx -t </span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@CLIENT ~]# curl -I  http://192.168.8.140/html/        # 查看头部，已经添加</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.10.2</span><br><span class="line">Date: Fri, 27 Oct 2017 09:25:00 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Length: 503737</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Last-Modified: Fri, 27 Oct 2017 08:52:43 GMT</span><br><span class="line">ETag: &quot;2205a0-7afb9-55c836975649a&quot;</span><br><span class="line">X-via: 192.168.8.140</span><br><span class="line">X-cache: MISS</span><br><span class="line">X-Accel: www.a.com</span><br><span class="line">Via: 192.168.8.140</span><br><span class="line">Cache: MISS</span><br><span class="line">Accel: www.a.com</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>