<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>LNAMP搭建WordPress | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/">Nginx</a></div><div class="post-time">2017-10-27</div></div></div><div class="container post-header"><h1>LNAMP搭建WordPress</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用nginx-php-fpm-mariadb-apache-搭建wordpress"><span class="toc-number">1.</span> <span class="toc-text">使用nginx+ php-fpm + mariadb + apache 搭建wordpress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环境"><span class="toc-number">2.</span> <span class="toc-text">环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装配置数据库服务器"><span class="toc-number">2.1.</span> <span class="toc-text">安装配置数据库服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置php服务器"><span class="toc-number">3.</span> <span class="toc-text">配置php服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装配置Apache服务器"><span class="toc-number">4.</span> <span class="toc-text">安装配置Apache服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试链接数据库"><span class="toc-number">5.</span> <span class="toc-text">测试链接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载并配置wordpress"><span class="toc-number">6.</span> <span class="toc-text">下载并配置wordpress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx代理服务器配置"><span class="toc-number">7.</span> <span class="toc-text">Nginx代理服务器配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试访问"><span class="toc-number">8.</span> <span class="toc-text">测试访问</span></a></li></ol></details></div><div class="container post-content"><h3 id="使用nginx-php-fpm-mariadb-apache-搭建wordpress"><a href="#使用nginx-php-fpm-mariadb-apache-搭建wordpress" class="headerlink" title="使用nginx+ php-fpm + mariadb + apache 搭建wordpress"></a>使用nginx+ php-fpm + mariadb + apache 搭建wordpress</h3><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><center><img src="https://houhaiyun.github.io/img/images/Nginx-LNAMP-1.jpg" title="拓扑图"></center>

<a id="more"></a>
<table>
<thead>
<tr>
<th>服务</th>
<th>IP</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nginx</td>
<td>192.168.8.140</td>
<td>反向代理</td>
</tr>
<tr>
<td>Apache</td>
<td>192.168.8.138</td>
<td>web服务</td>
</tr>
<tr>
<td>Mysql</td>
<td>192.168.8.128</td>
<td>存储数据</td>
</tr>
<tr>
<td>Php-fpm</td>
<td>192.168.8.138</td>
<td>解析php文件</td>
</tr>
</tbody>
</table>
<h4 id="安装配置数据库服务器"><a href="#安装配置数据库服务器" class="headerlink" title="安装配置数据库服务器"></a>安装配置数据库服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@Mysql ~]# yum -y  install mysql-server        # 安装mysql数据库</span><br><span class="line">[root@Mysql ~]# service mysqld start        # 启动mysql数据库</span><br><span class="line">Initializing MySQL database:  Installing MySQL system tables...</span><br><span class="line">OK</span><br><span class="line">Filling help tables...</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">To start mysqld at boot time you have to copy</span><br><span class="line">support-files/mysql.server to the right place for your system</span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !</span><br><span class="line">To do so, start the server, then issue the following commands:</span><br><span class="line"></span><br><span class="line">/usr/bin/mysqladmin -u root password &apos;new-password&apos;</span><br><span class="line">/usr/bin/mysqladmin -u root -h Mysql password &apos;new-password&apos;</span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line">/usr/bin/mysql_secure_installation</span><br><span class="line"></span><br><span class="line">which will also give you the option of removing the test</span><br><span class="line">databases and anonymous user created by default.  This is</span><br><span class="line">strongly recommended for production servers.</span><br><span class="line"></span><br><span class="line">See the manual for more instructions.</span><br><span class="line"></span><br><span class="line">You can start the MySQL daemon with:</span><br><span class="line">cd /usr ; /usr/bin/mysqld_safe &amp;</span><br><span class="line"></span><br><span class="line">You can test the MySQL daemon with mysql-test-run.pl</span><br><span class="line">cd /usr/mysql-test ; perl mysql-test-run.pl</span><br><span class="line"></span><br><span class="line">Please report any problems with the /usr/bin/mysqlbug script!</span><br><span class="line"></span><br><span class="line">                                                           [  OK  ]</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@Mysql ~]# mysql</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.1.73 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE DATABASE wpdb;        # 为wordpress创建数据库</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; GRANT ALL ON  wpdb.* TO wpuser@&apos;192.168.8.%&apos; IDENTIFIED BY &apos;centos&apos;;     # 为wordpress创建用户并授权</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; SHOW DATABASES;      # 查看数据库</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| test               |</span><br><span class="line">| wpdb               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="配置php服务器"><a href="#配置php服务器" class="headerlink" title="配置php服务器"></a>配置php服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@fast-cgi ~]# vim /etc/php-fpm.d/www.conf      # 修改php配置文件</span><br><span class="line">listen = 9000       # 指定监听所有IP的9000端口</span><br><span class="line">listen.allowed_clients = 127.0.0.1,192.168.8.140    # 允许192.168.8.140使用php</span><br><span class="line"># 注意：上面两项在本实验中并不是必须的。如果apache和php-fpm不再同一台服务器上面就需要配置了。</span><br></pre></td></tr></table></figure>
<h3 id="安装配置Apache服务器"><a href="#安装配置Apache服务器" class="headerlink" title="安装配置Apache服务器"></a>安装配置Apache服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@fast-cgi ~]# yum install -y httpd</span><br><span class="line">[root@fast-cgi ~]# systemctl start httpd</span><br><span class="line">[root@fast-cgi ~]# vim /etc/httpd/conf/httpd.conf       # 修改主配置文件添加以下行</span><br><span class="line">DirectoryIndex index.php</span><br><span class="line">ProxyRequests Off </span><br><span class="line">ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/var/www/html/$1</span><br></pre></td></tr></table></figure>
<h3 id="测试链接数据库"><a href="#测试链接数据库" class="headerlink" title="测试链接数据库"></a>测试链接数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@fast-cgi php]# yum install -y php-mysql</span><br><span class="line">[root@fast-cgi php]# systemctl restart php-fpm</span><br><span class="line">[root@fast-cgi php]# cat mysql.php </span><br><span class="line">&lt;?php</span><br><span class="line">$mysqli=new mysqli(&quot;192.168.8.128&quot;,&quot;wpuser&quot;,&quot;centos&quot;);</span><br><span class="line">if(mysqli_connect_errno())&#123;</span><br><span class="line">echo &quot;no&quot;;</span><br><span class="line">$mysqli=null;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;OK! &quot;;</span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line">?&gt;</span><br><span class="line">[root@fast-cgi ~]# curl 192.168.8.140/mysql.php         # 测试连接，ok</span><br><span class="line">OK!</span><br></pre></td></tr></table></figure>
<h3 id="下载并配置wordpress"><a href="#下载并配置wordpress" class="headerlink" title="下载并配置wordpress"></a>下载并配置wordpress</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@fast-cgi ~]# wget https://cn.wordpress.org/wordpress-4.8.1-zh_CN.tar.gz</span><br><span class="line">--2017-10-27 20:04:06--  https://cn.wordpress.org/wordpress-4.8.1-zh_CN.tar.gz</span><br><span class="line">Resolving cn.wordpress.org (cn.wordpress.org)... 66.155.40.250, 66.155.40.249</span><br><span class="line">Connecting to cn.wordpress.org (cn.wordpress.org)|66.155.40.250|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 8641990 (8.2M) [application/octet-stream]</span><br><span class="line">Saving to: ‘wordpress-4.8.1-zh_CN.tar.gz’</span><br><span class="line"></span><br><span class="line">100%[===================================================&gt;] 8,641,990   3.09MB/s   in 2.7s   </span><br><span class="line"></span><br><span class="line">2017-10-27 20:04:10 (3.09 MB/s) - ‘wordpress-4.8.1-zh_CN.tar.gz’ saved [8641990/8641990]</span><br><span class="line"></span><br><span class="line">[root@fast-cgi ~]# tar -xf wordpress-4.8.1-zh_CN.tar.gz -C /var/www/html/</span><br><span class="line">[root@fast-cgi ~]# cd /var/www/html/</span><br><span class="line">[root@fast-cgi html]# ls</span><br><span class="line">wordpress</span><br><span class="line">[root@fast-cgi html]# mv wordpress/ blog</span><br><span class="line">[root@fast-cgi html]# ls</span><br><span class="line">blog</span><br><span class="line">[root@fast-cgi blog]# mv wp-config-sample.php wp-config.php</span><br><span class="line">[root@fast-cgi blog]# vim  wp-config.php      # 修改wordpress配置文件</span><br><span class="line">define(&apos;DB_NAME&apos;, &apos;wpdb&apos;);</span><br><span class="line"></span><br><span class="line">/** MySQL数据库用户名 */</span><br><span class="line">define(&apos;DB_USER&apos;, &apos;wpuser&apos;);</span><br><span class="line"></span><br><span class="line">/** MySQL数据库密码 */</span><br><span class="line">define(&apos;DB_PASSWORD&apos;, &apos;centos&apos;);</span><br><span class="line"></span><br><span class="line">/** MySQL主机 */</span><br><span class="line">define(&apos;DB_HOST&apos;, &apos;192.168.8.128&apos;);</span><br><span class="line"></span><br><span class="line">/** 创建数据表时默认的文字编码 */</span><br><span class="line">define(&apos;DB_CHARSET&apos;, &apos;utf8&apos;);</span><br><span class="line"></span><br><span class="line">/** 数据库整理类型。如不确定请勿更改 */</span><br><span class="line">define(&apos;DB_COLLATE&apos;, &apos;&apos;);</span><br></pre></td></tr></table></figure>
<h3 id="Nginx代理服务器配置"><a href="#Nginx代理服务器配置" class="headerlink" title="Nginx代理服务器配置"></a>Nginx代理服务器配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# yum install -y nginx      # 安装nginx服务</span><br><span class="line">[root@centos7 ~]# vim /etc/nginx/conf.d/vhost.conf          # 修改代理服务器的配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen   default_server ; </span><br><span class="line">    listen 80  ;</span><br><span class="line">    server_name www.a.com ; </span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    error_log /var/log/nginx/a.com.error.log ; </span><br><span class="line">    access_log /var/log/nginx/a.com.access.log main ;</span><br><span class="line">    location /blog  &#123;       # 定义只要访问/blog目录就跳转到http://192.168.8.138/blog目录</span><br><span class="line">        proxy_pass http://192.168.8.138 ;       </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx</span><br></pre></td></tr></table></figure>
<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><p>搞定！</p>
<center><img src="https://houhaiyun.github.io/img/images/Nginx-LNAMP-2.gif" title="测试访问"></center>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2017/10/27/Nginx-LNAMP/';
var disqus_title = 'LNAMP搭建WordPress';
var disqus_url = 'https://keeplearn.vip/2017/10/27/Nginx-LNAMP/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>