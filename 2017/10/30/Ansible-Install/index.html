<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>Ansible安装与使用 | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Ansible/">Ansible</a></div><div class="post-time">2017-10-30</div></div></div><div class="container post-header"><h1>Ansible安装与使用</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#密钥管理"><span class="toc-number">1.</span> <span class="toc-text">密钥管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装ansible"><span class="toc-number">2.</span> <span class="toc-text">安装ansible</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置aliyun-epel-yum源"><span class="toc-number">2.1.</span> <span class="toc-text">配置aliyun epel yum源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装Ansible"><span class="toc-number">2.2.</span> <span class="toc-text">安装Ansible</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用ansible"><span class="toc-number">3.</span> <span class="toc-text">使用ansible</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#导入公钥"><span class="toc-number">3.1.</span> <span class="toc-text">导入公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义Host-Inventory"><span class="toc-number">3.2.</span> <span class="toc-text">定义Host Inventory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第一条命令"><span class="toc-number">3.3.</span> <span class="toc-text">第一条命令</span></a></li></ol></li></ol></details></div><div class="container post-content"><h3 id="密钥管理"><a href="#密钥管理" class="headerlink" title="密钥管理"></a>密钥管理</h3><p>编辑(或创建)<code>/etc/ansible/hosts</code> 并在其中加入一个或多个远程系统.你的<code>public SSH key</code>必须在这些系统的<code>authorized_keys</code>中:</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# ssh-keygen -t rsa             # 创建密钥</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">9e:f9:9b:5b:48:51:d8:2b:c3:81:df:f6:b8:2c:3e:b9 root@centos7.haiyun.com</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|         . o.    |</span><br><span class="line">|        . o..    |</span><br><span class="line">|         o.o .   |</span><br><span class="line">|          =.+    |</span><br><span class="line">|        S .+ o   |</span><br><span class="line">|       . + .. .  |</span><br><span class="line">|        + .o..   |</span><br><span class="line">|         .+oo    |</span><br><span class="line">|         .E*     |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# ssh-copy-id 192.168.8.14          # 将公钥拷贝到要管理的主机</span><br><span class="line">The authenticity of host &apos;192.168.8.14 (192.168.8.14)&apos; can&apos;t be established.</span><br><span class="line">RSA key fingerprint is 64:c7:ef:02:89:b1:33:af:14:0f:83:5b:83:f1:01:c4.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.8.14&apos; (RSA) to the list of known hosts.</span><br><span class="line">root@192.168.8.14&apos;s password: </span><br><span class="line">Now try logging into the machine, with &quot;ssh &apos;192.168.8.14&apos;&quot;, and check in:</span><br><span class="line"></span><br><span class="line">  .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">to make sure we haven&apos;t added extra keys that you weren&apos;t expecting.</span><br></pre></td></tr></table></figure>
<h3 id="安装ansible"><a href="#安装ansible" class="headerlink" title="安装ansible"></a>安装ansible</h3><h4 id="配置aliyun-epel-yum源"><a href="#配置aliyun-epel-yum源" class="headerlink" title="配置aliyun epel yum源"></a>配置aliyun epel yum源</h4><p><strong>注意：</strong> 安装<code>Ansible</code>可以通过<code>yum</code>的方式或源码编译安装。<code>yum</code>安装是使用<code>epel</code>源的。下面是关于<code>aliyun</code> <code>epel</code> 的<code>yum</code>配置。大家根据自己的服务器版本自行选择。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 yum.repos.d]# wget -O /etc/yum.repos.d/epel-6.repo http://mirrors.aliyun.com/repo/epel-6.repo          # 下载centos6的epel yum源</span><br><span class="line">--2017-10-30 17:26:45--  http://mirrors.aliyun.com/repo/epel-6.repo</span><br><span class="line">Resolving mirrors.aliyun.com... 111.7.187.235, 111.7.187.217, 111.7.187.219, ...</span><br><span class="line">Connecting to mirrors.aliyun.com|111.7.187.235|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1083 (1.1K) [application/octet-stream]</span><br><span class="line">Saving to: “/etc/yum.repos.d/epel-6.repo”</span><br><span class="line"></span><br><span class="line">100%[===================================================&gt;] 1,083       --.-K/s   in 0s      </span><br><span class="line"></span><br><span class="line">2017-10-30 17:26:47 (91.2 MB/s) - “/etc/yum.repos.d/epel-6.repo” saved [1083/1083]</span><br><span class="line"></span><br><span class="line">[root@centos6 yum.repos.d]# wget -O /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo          # 下载centos7的epel yum源</span><br><span class="line">--2017-10-30 17:27:04--  http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">Resolving mirrors.aliyun.com... 111.7.187.217, 111.7.187.219, 111.7.187.234, ...</span><br><span class="line">Connecting to mirrors.aliyun.com|111.7.187.217|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1084 (1.1K) [application/octet-stream]</span><br><span class="line">Saving to: “/etc/yum.repos.d/epel-7.repo”</span><br><span class="line"></span><br><span class="line">100%[===================================================&gt;] 1,084       --.-K/s   in 0s      </span><br><span class="line"></span><br><span class="line">2017-10-30 17:27:04 (176 MB/s) - “/etc/yum.repos.d/epel-7.repo” saved [1084/1084]</span><br><span class="line"></span><br><span class="line">[root@centos6 yum.repos.d]# cat epel-6.repo             # 查看6的epel源</span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages for Enterprise Linux 6 - $basearch</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/6/$basearch</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/6/$basearch</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line"> </span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages for Enterprise Linux 6 - $basearch - Debug</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/6/$basearch/debug</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/6/$basearch/debug</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-6&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line">gpgcheck=0</span><br><span class="line"> </span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages for Enterprise Linux 6 - $basearch - Source</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/6/SRPMS</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/6/SRPMS</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-6&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[root@centos6 yum.repos.d]# cat epel-7.repo         # 查看7的epel源</span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages for Enterprise Linux 7 - $basearch</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/7/$basearch</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/7/$basearch</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line"> </span><br><span class="line">[epel-debuginfo]</span><br><span class="line">name=Extra Packages for Enterprise Linux 7 - $basearch - Debug</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/7/$basearch/debug</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/7/$basearch/debug</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=0</span><br><span class="line"> </span><br><span class="line">[epel-source]</span><br><span class="line">name=Extra Packages for Enterprise Linux 7 - $basearch - Source</span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/7/SRPMS</span><br><span class="line">        http://mirrors.aliyuncs.com/epel/7/SRPMS</span><br><span class="line">#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;arch=$basearch</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@centos6 yum.repos.d]#</span><br></pre></td></tr></table></figure>
<h4 id="安装Ansible"><a href="#安装Ansible" class="headerlink" title="安装Ansible"></a>安装Ansible</h4><p>此处，采用<code>yum</code>方式来安装<code>ansible</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]# yum install -y ansible     </span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# yum info ansible      # 查看ansible相关信息</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">file://misc/cd/repodata/repomd.xml: [Errno 14] Could not open/read file://misc/cd/repodata/repomd.xml</span><br><span class="line">Trying other mirror.</span><br><span class="line">Installed Packages</span><br><span class="line">Name        : ansible</span><br><span class="line">Arch        : noarch</span><br><span class="line">Version     : 2.2.1.0</span><br><span class="line">Release     : 1.el6</span><br><span class="line">Size        : 22 M</span><br><span class="line">Repo        : installed</span><br><span class="line">From repo   : epel</span><br><span class="line">Summary     : SSH-based configuration management, deployment, and task execution system</span><br><span class="line">URL         : http://ansible.com</span><br><span class="line">License     : GPLv3+</span><br><span class="line">Description : </span><br><span class="line">            : Ansible is a radically simple model-driven configuration management,</span><br><span class="line">            : multi-node deployment, and remote task execution system. Ansible works</span><br><span class="line">            : over SSH and does not require any software or daemons to be installed</span><br><span class="line">            : on remote nodes. Extension modules can be written in any language and</span><br><span class="line">            : are transferred to managed machines automatically.</span><br></pre></td></tr></table></figure>
<h3 id="使用ansible"><a href="#使用ansible" class="headerlink" title="使用ansible"></a>使用ansible</h3><h4 id="导入公钥"><a href="#导入公钥" class="headerlink" title="导入公钥"></a>导入公钥</h4><p><a href="http://www.ihaiyun.cc/2017/10/30/Expect-Copy-Ssh-Key-2017-10-30/" target="_blank" rel="noopener">关于导入公钥大家可以参考我的另外一篇博客：批量拷贝SSH密钥</a></p>
<h4 id="定义Host-Inventory"><a href="#定义Host-Inventory" class="headerlink" title="定义Host Inventory"></a>定义Host Inventory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]# vim /etc/ansible/hosts </span><br><span class="line"></span><br><span class="line"># This is the default ansible &apos;hosts&apos; file.</span><br><span class="line">#</span><br><span class="line"># It should live in /etc/ansible/hosts</span><br><span class="line">#</span><br><span class="line">#   - Comments begin with the &apos;#&apos; character</span><br><span class="line">#   - Blank lines are ignored</span><br><span class="line">#   - Groups of hosts are delimited by [header] elements</span><br><span class="line">#   - You can enter hostnames or ip addresses</span><br><span class="line">#   - A hostname/ip can be a member of multiple groups</span><br><span class="line"></span><br><span class="line"># Ex 1: Ungrouped hosts, specify before any group headers.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[web1]</span><br><span class="line">192.168.8.12 </span><br><span class="line">192.168.8.13</span><br></pre></td></tr></table></figure>
<h4 id="第一条命令"><a href="#第一条命令" class="headerlink" title="第一条命令"></a>第一条命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]# ansible web1 -m ping      # 对web1定义的主机ping一下，如果成功了就返回pong</span><br><span class="line">192.168.8.12 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.8.13 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'keeplearn';
var disqus_identifier = '2017/10/30/Ansible-Install/';
var disqus_title = 'Ansible安装与使用';
var disqus_url = 'https://keeplearn.vip/2017/10/30/Ansible-Install/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>