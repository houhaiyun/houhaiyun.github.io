<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>实现基于SSL的FTPS | Keep learn!</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Vsftp/">Vsftp</a></div><div class="post-time">2017-10-16</div></div></div><div class="container post-header"><h1>实现基于SSL的FTPS</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#查看是否支持SSL"><span class="toc-number">1.</span> <span class="toc-text">查看是否支持SSL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建自签名证书"><span class="toc-number">2.</span> <span class="toc-text">创建自签名证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置vsftpd服务支持SSL"><span class="toc-number">3.</span> <span class="toc-text">配置vsftpd服务支持SSL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试"><span class="toc-number">4.</span> <span class="toc-text">测试</span></a></li></ol></details></div><div class="container post-content"><center><img src="https://houhaiyun.github.io/img/images/FTP-SSL-1.jpg" title="ftps"></center>

<h3 id="查看是否支持SSL"><a href="#查看是否支持SSL" class="headerlink" title="查看是否支持SSL"></a>查看是否支持SSL</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# ldd `which vsftpd`</span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007fff729c8000)</span><br><span class="line">	libssl.so.10 =&gt; /lib64/libssl.so.10 (0x00007f6358444000)</span><br><span class="line">	libwrap.so.0 =&gt; /lib64/libwrap.so.0 (0x00007f6358239000)</span><br><span class="line">	libnsl.so.1 =&gt; /lib64/libnsl.so.1 (0x00007f635801f000)</span><br><span class="line">	libpam.so.0 =&gt; /lib64/libpam.so.0 (0x00007f6357e10000)</span><br><span class="line">	libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007f6357c0b000)</span><br><span class="line">	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f6357a06000)</span><br><span class="line">	libcrypto.so.10 =&gt; /lib64/libcrypto.so.10 (0x00007f635761c000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f635725b000)</span><br><span class="line">	libgssapi_krb5.so.2 =&gt; /lib64/libgssapi_krb5.so.2 (0x00007f635700c000)</span><br><span class="line">	libkrb5.so.3 =&gt; /lib64/libkrb5.so.3 (0x00007f6356d25000)</span><br><span class="line">	libcom_err.so.2 =&gt; /lib64/libcom_err.so.2 (0x00007f6356b21000)</span><br><span class="line">	libk5crypto.so.3 =&gt; /lib64/libk5crypto.so.3 (0x00007f63568ee000)</span><br><span class="line">	libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f63566d8000)</span><br><span class="line">	libaudit.so.1 =&gt; /lib64/libaudit.so.1 (0x00007f63564b0000)</span><br><span class="line">	libattr.so.1 =&gt; /lib64/libattr.so.1 (0x00007f63562aa000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f63588e4000)</span><br><span class="line">	libkrb5support.so.0 =&gt; /lib64/libkrb5support.so.0 (0x00007f635609b000)</span><br><span class="line">	libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x00007f6355e97000)</span><br><span class="line">	libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x00007f6355c7c000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f6355a60000)</span><br><span class="line">	libcap-ng.so.0 =&gt; /lib64/libcap-ng.so.0 (0x00007f6355859000)</span><br><span class="line">	libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007f6355632000)</span><br><span class="line">	libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007f63553d1000)</span><br><span class="line">[root@centos7 ~]# ldd `which vsftpd` | grep libssl          # 支持的</span><br><span class="line">	libssl.so.10 =&gt; /lib64/libssl.so.10 (0x00007f69c6fe5000)</span><br></pre></td></tr></table></figure>
<h3 id="创建自签名证书"><a href="#创建自签名证书" class="headerlink" title="创建自签名证书"></a>创建自签名证书</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# cd /etc/pki/tls/certs</span><br><span class="line">[root@centos7 certs]# make vsftpd.pem</span><br><span class="line">umask 77 ; \</span><br><span class="line">PEM1=`/bin/mktemp /tmp/openssl.XXXXXX` ; \</span><br><span class="line">PEM2=`/bin/mktemp /tmp/openssl.XXXXXX` ; \</span><br><span class="line">/usr/bin/openssl req -utf8 -newkey rsa:2048 -keyout $PEM1 -nodes -x509 -days 365 -out $PEM2 -set_serial 0 ; \</span><br><span class="line">cat $PEM1 &gt;  vsftpd.pem ; \</span><br><span class="line">echo &quot;&quot;    &gt;&gt; vsftpd.pem ; \</span><br><span class="line">cat $PEM2 &gt;&gt; vsftpd.pem ; \</span><br><span class="line">rm -f $PEM1 $PEM2</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">.........................................+++</span><br><span class="line">.......................................................+++</span><br><span class="line">writing new private key to &apos;/tmp/openssl.7gPwj6&apos;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:beijing</span><br><span class="line">Locality Name (eg, city) [Default City]:haidian</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:haiyun.com</span><br><span class="line">Organizational Unit Name (eg, section) []:opt</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:www.ihaiyun.cc</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 certs]# openssl x509 -in vsftpd.pem -noout -text          # 查看证书</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 0 (0x0)</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=CN, ST=beijing, L=haidian, O=haiyun.com, OU=opt, CN=www.ihaiyun.cc</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Oct 13 07:10:13 2017 GMT</span><br><span class="line">            Not After : Oct 13 07:10:13 2018 GMT</span><br><span class="line">        Subject: C=CN, ST=beijing, L=haidian, O=haiyun.com, OU=opt, CN=www.ihaiyun.cc</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:d3:7d:40:95:ed:7b:c1:a2:ed:88:6e:bd:0c:c6:</span><br><span class="line">                    7d:24:d1:5e:b3:f1:d5:9a:ef:6b:83:95:89:13:64:</span><br><span class="line">                    7b:91:12:60:c9<img class="github-emoji" title="cd" alt="cd" src="https://github.githubassets.com/images/icons/emoji/unicode/1f4bf.png?v8" height="20" width="20">32:ed:2c:fe:48:48:9f:bb:d7:</span><br><span class="line">                    b3:48:5f:b4:5a:1e:74:d1:d1:71:37:e6:7b:9c:bc:</span><br><span class="line">                    df:ce:a4:64:f4:8e:bd:23:0e:13:5d:54:a3:94:90:</span><br><span class="line">                    6c:6f:34:bb:b3:8a:ab:57:f0:95:d0:95:18:1d:24:</span><br><span class="line">                    20:cb:fd:4f:57:9a:62:c6:7c:0e:78:10:3a:9c:56:</span><br><span class="line">                    46:3a:3f:b8:6a:88:d5:c6:43:88:a2:8b:5d:96:d6:</span><br><span class="line">                    a3:7e:8f:47:bb:d5:95:3d:6a:4f:1c:f7:a6:a4:2d:</span><br><span class="line">                    65:7e:c6:23:fd:b4:e5:a8:a5:1a:e4:0f:2c:27:d5:</span><br><span class="line">                    bc:b0:2e:51:50:8e:8f:cf:b9:ea:e6:4c:5c:24:05:</span><br><span class="line">                    d1:76:68:32:3e:23:38:02:81:9d:a2:40:c8:ca:91:</span><br><span class="line">                    b9:ee:4b:e5:bb:75:06:09:7f:9b:47:6e:c3:3f:e1:</span><br><span class="line">                    b4:48:ad:39:c8:7d:ab:a0:61:1c:bb:c5:ba:f5:e2:</span><br><span class="line">                    9c:3e:e4:34:d0:7e:f8:8c:51:0d:e8:0c:c4:66:6f:</span><br><span class="line">                    3a:44:a9:e2:56:be:1e:26:f3:d5:18:0a:86:4e:22:</span><br><span class="line">                    bd:ac:a6:12:25:b6:56:7c:fb:9b:25:02:01:17:e4:</span><br><span class="line">                    a7:7d</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                48:F2:61:FD:CD:29:64:49:18:14:7B:E5:DF:A5:DC:CC:69:1C:44:C4</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:48:F2:61:FD:CD:29:64:49:18:14:7B:E5:DF:A5:DC:CC:69:1C:44:C4</span><br><span class="line"></span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:TRUE</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         08:a0:5d:34:eb:05:f8:75:f2:15:5e:38:0b:cf:1d:86:7d:8e:</span><br><span class="line">         cb:f9:b5:7e:b3:15:1b:b5:b2:4b:e4:d8:64:09:c4:71:9b:17:</span><br><span class="line">         67:12:7d:24:6b:af:cb:22:6b:08:6f:e9:af:35:5e:54:5f:43:</span><br><span class="line">         38:57:3c:8c:c5:ac:28:43:cf:6c:9b:1e:46:28:e3:6a:05:f3:</span><br><span class="line">         70:0e:d1:26:2e:44:2c:4b:c6:26:70:82:a3:97:f6:fc:ea:1d:</span><br><span class="line">         76:19:f7:96:3d:76:9a:95:19:5b:14:7f:4f:e0:87:18:df:cb:</span><br><span class="line">         79:20:b4:f2:f7:e1:b9:aa:ae:3b:0d:b2:98:e4:76:ee:35:77:</span><br><span class="line">         f3:e4:03:7c:77:47:47:e4:78:6b:1a:45:04:1a:37:ca:f5:58:</span><br><span class="line">         e3:a5:8e:07:31:0d:2c:cc:79:d5:00:1c:85:a5:00:8f:f1:fa:</span><br><span class="line">         20:bb:4e:1e:a0:3a:64:55:d4:76:04:75:85:6d:de:24:bb:54:</span><br><span class="line">         56:bb:62:3d:1b:49:90:36:af:09:3d:df:56:28:e7:c8:f5:e6:</span><br><span class="line">         ee:ca:0f:43:00:c7:1a:f3:d4:56:24:5e:da:73:73:0c:ed:6b:</span><br><span class="line">         d8:82:47:3e:6c:5d:3c:23:03:e4:8d:43:31:e9:c4:c5:df:90:</span><br><span class="line">         79:c3:c9:fb:cd:44:45:8d:27:a7:e6:30:a8:a8:3f:bb:f1:a2:</span><br><span class="line">         ae:c1:f5:a4</span><br></pre></td></tr></table></figure>
<h3 id="配置vsftpd服务支持SSL"><a href="#配置vsftpd服务支持SSL" class="headerlink" title="配置vsftpd服务支持SSL"></a>配置vsftpd服务支持SSL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">ssl_enable=YES      # 启用SSL</span><br><span class="line">allow_anon_ssl=YES      # 匿名不支持SSL</span><br><span class="line">force_local_logins_ssl=YES      # 本地用户登录加密</span><br><span class="line">force_local_data_ssl=YES        # 本地用户数据传输加密</span><br><span class="line">rsa_cert_file=/etc/pki/tls/certs/vsftpd.pem</span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><center><img src="https://houhaiyun.github.io/img/images/FTP-SSL-2.gif" title="测试"></center>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>