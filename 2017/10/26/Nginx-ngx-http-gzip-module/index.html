<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>模块 ngx_http_gzip_module | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/">Nginx</a></div><div class="post-time">2017-10-26</div></div></div><div class="container post-header"><h1>模块 ngx_http_gzip_module</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-on-off"><span class="toc-number">1.</span> <span class="toc-text">gzip on | off;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-comp-level-level"><span class="toc-number">2.</span> <span class="toc-text">gzip_comp_level level;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-min-length-length"><span class="toc-number">3.</span> <span class="toc-text">gzip_min_length length;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-proxied-off-expired-…"><span class="toc-number">4.</span> <span class="toc-text">gzip_proxied off | expired …;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#参数："><span class="toc-number">4.1.</span> <span class="toc-text">参数：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gzip-types-mime-type-…"><span class="toc-number">5.</span> <span class="toc-text">gzip_types mime-type …;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看Nginx的MIME类型"><span class="toc-number">5.1.</span> <span class="toc-text">查看Nginx的MIME类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Nginx压缩功能"><span class="toc-number">6.</span> <span class="toc-text">实现Nginx压缩功能</span></a></li></ol></details></div><div class="container post-content"><h3 id="gzip-on-off"><a href="#gzip-on-off" class="headerlink" title="gzip on | off;"></a>gzip on | off;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	gzip on | off;</span><br><span class="line">Default:	</span><br><span class="line">gzip off;</span><br><span class="line">Context:	http, server, location, if in location</span><br></pre></td></tr></table></figure></p>
<p><a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip" target="_blank" rel="noopener">帮助文档：http://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip</a></p>
<a id="more"></a>
<ul>
<li><code>nginx</code>对于代理服务器请求的响应报文，在何种条件下启用压缩功能</li>
</ul>
<ul>
<li><code>off</code>：对被代理的请求不启用压缩</li>
</ul>
<ul>
<li><code>expired,no-cache</code>, <code>no-store</code>， <code>private</code>：对代理服务器请求的响应报文首部<code>Cache-Control</code>值任何一个，启用压缩功能</li>
</ul>
<h3 id="gzip-comp-level-level"><a href="#gzip-comp-level-level" class="headerlink" title="gzip_comp_level level;"></a>gzip_comp_level level;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	gzip_comp_level level;</span><br><span class="line">Default:	</span><br><span class="line">gzip_comp_level 1;</span><br><span class="line">Context:	http, server, location</span><br></pre></td></tr></table></figure></p>
<p>指定压缩比，范围是1-9</p>
<h3 id="gzip-min-length-length"><a href="#gzip-min-length-length" class="headerlink" title="gzip_min_length length;"></a>gzip_min_length length;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	gzip_min_length length;</span><br><span class="line">Default:	</span><br><span class="line">gzip_min_length 20;</span><br><span class="line">Context:	http, server, location</span><br></pre></td></tr></table></figure></p>
<p>指定小于多少字节就取消压缩，因为文件特别小的话，压缩完成后，也许比原文件大，呵呵。</p>
<h3 id="gzip-proxied-off-expired-…"><a href="#gzip-proxied-off-expired-…" class="headerlink" title="gzip_proxied off | expired …;"></a>gzip_proxied off | expired …;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">句法：	gzip_proxied off | expired | no-cache | no-store | private | no_last_modified | no_etag | auth | any ...;</span><br><span class="line">默认：	</span><br><span class="line">gzip_proxied关闭</span><br><span class="line">语境：	http，server，location</span><br></pre></td></tr></table></figure></p>
<p>根据请求和响应，启用或禁用代理请求的响应。请求被代理的事实由“Via”请求头字段的存在确定。该指令接受多个参数：</p>
<h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><ul>
<li><code>off</code><ul>
<li>禁用所有代理请求的压缩，忽略其他参数;</li>
</ul>
</li>
<li><code>expired</code><ul>
<li>如果响应头包含具有禁用缓存的值的<code>“Expires”</code>字段，则启用压缩;</li>
</ul>
</li>
<li><code>no-cache</code> <ul>
<li>如果响应头包含<code>“Cache-Control”</code>字段和<code>“ no-cache”</code>参数，则启用压缩。</li>
</ul>
</li>
<li><code>no-store</code><ul>
<li>如果响应头包含<code>“Cache-Control”</code>字段和<code>“ no-store”</code>参数，则启用压缩。</li>
</ul>
</li>
<li><code>private</code><ul>
<li>如果响应头包含<code>“Cache-Control”</code>字段和<code>“ private”</code>参数，则启用压缩。</li>
</ul>
</li>
<li><code>no_last_modified</code><ul>
<li>如果响应头不包含<code>“Last-Modified”</code>字段，则启用压缩;</li>
</ul>
</li>
<li><code>no_etag</code><ul>
<li>如果响应头不包含<code>“ETag”</code>字段，则启用压缩;</li>
</ul>
</li>
<li><code>auth</code><ul>
<li>如果请求头包含<code>“auth”</code>字段，则启用压缩;</li>
</ul>
</li>
<li><code>any</code><ul>
<li>为所有代理的请求启用压缩。</li>
</ul>
</li>
</ul>
<h3 id="gzip-types-mime-type-…"><a href="#gzip-types-mime-type-…" class="headerlink" title="gzip_types mime-type …;"></a>gzip_types mime-type …;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	gzip_types mime-type ...;</span><br><span class="line">Default:	</span><br><span class="line">gzip_types text/html;</span><br><span class="line">Context:	http, server, location</span><br></pre></td></tr></table></figure></p>
<p>Enables gzipping of responses for the specified MIME types in addition to “text/html”. The special value “*” matches any MIME type (0.8.29). Responses with the “text/html” type are always compressed.</p>
<h4 id="查看Nginx的MIME类型"><a href="#查看Nginx的MIME类型" class="headerlink" title="查看Nginx的MIME类型"></a>查看Nginx的MIME类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# cat /etc/nginx/mime.types</span><br><span class="line"></span><br><span class="line">types &#123;</span><br><span class="line">    text/html                             html htm shtml;</span><br><span class="line">    text/css                              css;</span><br><span class="line">    text/xml                              xml;</span><br><span class="line">    image/gif                             gif;</span><br><span class="line">    image/jpeg                            jpeg jpg;</span><br><span class="line">    application/javascript                js;</span><br><span class="line">    application/atom+xml                  atom;</span><br><span class="line">    application/rss+xml                   rss;</span><br><span class="line"></span><br><span class="line">    text/mathml                           mml;</span><br><span class="line">    text/plain                            txt;</span><br><span class="line">    text/vnd.sun.j2me.app-descriptor      jad;</span><br><span class="line">    text/vnd.wap.wml                      wml;</span><br><span class="line">    text/x-component                      htc;</span><br><span class="line"></span><br><span class="line">    image/png                             png;</span><br><span class="line">    image/tiff                            tif tiff;</span><br><span class="line">    image/vnd.wap.wbmp                    wbmp;</span><br><span class="line">    image/x-icon                          ico;</span><br><span class="line">    image/x-jng                           jng;</span><br><span class="line">    image/x-ms-bmp                        bmp;</span><br><span class="line">    image/svg+xml                         svg svgz;</span><br><span class="line">    image/webp                            webp;</span><br><span class="line"></span><br><span class="line">    application/font-woff                 woff;</span><br><span class="line">    application/java-archive              jar war ear;</span><br><span class="line">    application/json                      json;</span><br><span class="line">    application/mac-binhex40              hqx;</span><br><span class="line">    application/msword                    doc;</span><br><span class="line">    application/pdf                       pdf;</span><br><span class="line">    application/postscript                ps eps ai;</span><br><span class="line">    application/rtf                       rtf;</span><br><span class="line">    application/vnd.apple.mpegurl         m3u8;</span><br><span class="line">    application/vnd.ms-excel              xls;</span><br><span class="line">    application/vnd.ms-fontobject         eot;</span><br><span class="line">    application/vnd.ms-powerpoint         ppt;</span><br><span class="line">    application/vnd.wap.wmlc              wmlc;</span><br><span class="line">    application/vnd.google-earth.kml+xml  kml;</span><br><span class="line">    application/vnd.google-earth.kmz      kmz;</span><br><span class="line">    application/x-7z-compressed           7z;</span><br><span class="line">    application/x-cocoa                   cco;</span><br><span class="line">    application/x-java-archive-diff       jardiff;</span><br><span class="line">    application/x-java-jnlp-file          jnlp;</span><br><span class="line">    application/x-makeself                run;</span><br><span class="line">    application/x-perl                    pl pm;</span><br><span class="line">    application/x-pilot                   prc pdb;</span><br><span class="line">    application/x-rar-compressed          rar;</span><br><span class="line">    application/x-redhat-package-manager  rpm;</span><br><span class="line">    application/x-sea                     sea;</span><br><span class="line">    application/x-shockwave-flash         swf;</span><br><span class="line">    application/x-stuffit                 sit;</span><br><span class="line">    application/x-tcl                     tcl tk;</span><br><span class="line">    application/x-x509-ca-cert            der pem crt;</span><br><span class="line">    application/x-xpinstall               xpi;</span><br><span class="line">    application/xhtml+xml                 xhtml;</span><br><span class="line">    application/xspf+xml                  xspf;</span><br><span class="line">    application/zip                       zip;</span><br><span class="line"></span><br><span class="line">    application/octet-stream              bin exe dll;</span><br><span class="line">    application/octet-stream              deb;</span><br><span class="line">    application/octet-stream              dmg;</span><br><span class="line">    application/octet-stream              iso img;</span><br><span class="line">    application/octet-stream              msi msp msm;</span><br><span class="line"></span><br><span class="line">    application/vnd.openxmlformats-officedocument.wordprocessingml.document    docx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet          xlsx;</span><br><span class="line">    application/vnd.openxmlformats-officedocument.presentationml.presentation  pptx;</span><br><span class="line"></span><br><span class="line">    audio/midi                            mid midi kar;</span><br><span class="line">    audio/mpeg                            mp3;</span><br><span class="line">    audio/ogg                             ogg;</span><br><span class="line">    audio/x-m4a                           m4a;</span><br><span class="line">    audio/x-realaudio                     ra;</span><br><span class="line"></span><br><span class="line">    video/3gpp                            3gpp 3gp;</span><br><span class="line">    video/mp2t                            ts;</span><br><span class="line">    video/mp4                             mp4;</span><br><span class="line">    video/mpeg                            mpeg mpg;</span><br><span class="line">    video/quicktime                       mov;</span><br><span class="line">    video/webm                            webm;</span><br><span class="line">    video/x-flv                           flv;</span><br><span class="line">    video/x-m4v                           m4v;</span><br><span class="line">    video/x-mng                           mng;</span><br><span class="line">    video/x-ms-asf                        asx asf;</span><br><span class="line">    video/x-ms-wmv                        wmv;</span><br><span class="line">    video/x-msvideo                       avi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现Nginx压缩功能"><a href="#实现Nginx压缩功能" class="headerlink" title="实现Nginx压缩功能"></a>实现Nginx压缩功能</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# mkdir /app/website1</span><br><span class="line">[root@Nginx-Server ~]# ll -h /var/log/messages </span><br><span class="line">-rw-------. 1 root root 568K Oct 26 19:11 /var/log/messages</span><br><span class="line">[root@Nginx-Server ~]# cp /var/log/messages /app/website1/gzip.html &amp;&amp; chmod a+r /app/website1/gzip.html</span><br><span class="line">[root@Nginx-Server ~]# ll -h /app/website1/gzip.html</span><br><span class="line">-rw-r--r-- 1 root root 568K Oct 26 19:16 /app/website1/gzip.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# curl -I 192.168.8.140/gzip.html      # 直接测试</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.10.2</span><br><span class="line">Date: Thu, 26 Oct 2017 11:19:24 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 580711  </span><br><span class="line">Last-Modified: Thu, 26 Oct 2017 11:16:58 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;59f1c42a-8dc67&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# ll  /app/website1/gzip.html          # 可以看到，并没有压缩</span><br><span class="line">-rw-r--r-- 1 root root 580711 Oct 26 19:16 /app/website1/gzip.html</span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# vim /etc/nginx/conf.d/vhost.conf         # 修改配置文件，启用压缩功能</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server ; </span><br><span class="line">    server_name www.a.com ; </span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    gzip on; </span><br><span class="line">    gzip_comp_level 6;</span><br><span class="line">    gzip_min_length 64; </span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    gzip_types text/xml text/css application/javascript;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx </span><br><span class="line">[root@Nginx-Server ~]# curl -I --compressed 192.168.8.140/gzip.html         # 再次测试</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.10.2</span><br><span class="line">Date: Thu, 26 Oct 2017 11:27:35 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Last-Modified: Thu, 26 Oct 2017 11:16:58 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: W/&quot;59f1c42a-8dc67&quot;</span><br><span class="line">Content-Encoding: gzip          # 已经压缩</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>