<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Peter's technology stack."><title>模块 ngx_http_ssl_module | Peter's technology stack.</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/">Nginx</a></div><div class="post-time">2017-10-26</div></div></div><div class="container post-header"><h1>模块 ngx_http_ssl_module</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Syntax-ssl-on-off"><span class="toc-number">1.</span> <span class="toc-text">Syntax:    ssl on | off;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssl-certificate-file"><span class="toc-number">2.</span> <span class="toc-text">ssl_certificate file;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssl-certificate-key-file"><span class="toc-number">3.</span> <span class="toc-text">ssl_certificate_key file;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssl-protocols-SSLv2-…"><span class="toc-number">4.</span> <span class="toc-text">ssl_protocols [SSLv2] …;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssl-session-cache-off-none-…"><span class="toc-number">5.</span> <span class="toc-text">ssl_session_cache off | none …;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#参数"><span class="toc-number">5.1.</span> <span class="toc-text">参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssl-session-timeout-time"><span class="toc-number">6.</span> <span class="toc-text">ssl_session_timeout time;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现SSL"><span class="toc-number">7.</span> <span class="toc-text">实现SSL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建证书"><span class="toc-number">7.1.</span> <span class="toc-text">1. 创建证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-解密私钥"><span class="toc-number">7.2.</span> <span class="toc-text">2. 解密私钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-创建证书目录和拷贝证书"><span class="toc-number">7.3.</span> <span class="toc-text">3. 创建证书目录和拷贝证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-修改配置文件"><span class="toc-number">7.4.</span> <span class="toc-text">4. 修改配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动服务，测试"><span class="toc-number">7.5.</span> <span class="toc-text">启动服务，测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现多虚拟主机支持https"><span class="toc-number">8.</span> <span class="toc-text">实现多虚拟主机支持https</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建证书-1"><span class="toc-number">8.1.</span> <span class="toc-text">1. 创建证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-解密私钥-1"><span class="toc-number">8.2.</span> <span class="toc-text">2. 解密私钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-拷贝证书"><span class="toc-number">8.3.</span> <span class="toc-text">3. 拷贝证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-创建访问目录"><span class="toc-number">8.4.</span> <span class="toc-text">4. 创建访问目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-修改配置文件"><span class="toc-number">8.5.</span> <span class="toc-text">5. 修改配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-配置hosts文件"><span class="toc-number">8.6.</span> <span class="toc-text">6. 配置hosts文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-启动服务，测试"><span class="toc-number">8.7.</span> <span class="toc-text">7. 启动服务，测试</span></a></li></ol></li></ol></details></div><div class="container post-content"><h3 id="Syntax-ssl-on-off"><a href="#Syntax-ssl-on-off" class="headerlink" title="Syntax:    ssl on | off;"></a>Syntax:    ssl on | off;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl on | off;</span><br><span class="line">Default:	</span><br><span class="line">ssl off;</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<p>为指定虚拟机启用HTTPS protocol， 建议用listen指令代替</p>
<a id="more"></a>
<h3 id="ssl-certificate-file"><a href="#ssl-certificate-file" class="headerlink" title="ssl_certificate file;"></a>ssl_certificate file;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl_certificate file;</span><br><span class="line">Default:	—</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<p>当前虚拟主机使用PEM格式的证书文件</p>
<h3 id="ssl-certificate-key-file"><a href="#ssl-certificate-key-file" class="headerlink" title="ssl_certificate_key file;"></a>ssl_certificate_key file;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl_certificate_key file;</span><br><span class="line">Default:	—</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<p>当前虚拟主机上与其证书匹配的私钥文件</p>
<h3 id="ssl-protocols-SSLv2-…"><a href="#ssl-protocols-SSLv2-…" class="headerlink" title="ssl_protocols [SSLv2] …;"></a>ssl_protocols [SSLv2] …;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl_protocols [SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3];</span><br><span class="line">Default:	</span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<p>支持<code>ssl</code>协议版本，默认为后三个</p>
<h3 id="ssl-session-cache-off-none-…"><a href="#ssl-session-cache-off-none-…" class="headerlink" title="ssl_session_cache off | none …;"></a>ssl_session_cache off | none …;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl_session_cache off | none | [builtin[:size]] [shared:name:size];</span><br><span class="line">Default:	</span><br><span class="line">ssl_session_cache none;</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>设置存储会话参数的高速缓存的类型和大小。缓存可以是以下类型之一：</p>
<ul>
<li><code>off</code><ul>
<li>严格禁止使用会话缓存：<code>nginx</code>明确告诉客户端会话可能不被重用。</li>
</ul>
</li>
<li><code>none</code><ul>
<li>会话缓存的使用被轻轻地禁止：<code>nginx</code>告诉客户端会话可能被重用，但实际上并没有将会话参数存储在缓存中。</li>
</ul>
</li>
<li><code>builtin</code><ul>
<li>一个内置<code>OpenSSL</code>的缓存; 仅由一个工作进程使用。缓存大小在会话中指定。如果没有给出大小，则等于<code>20480</code>次会话。使用内置缓存可能会导致内存碎片。</li>
</ul>
</li>
<li><code>shared</code><ul>
<li>在所有工作进程之间共享缓存。缓存大小以字节为单位指定; 一兆字节可以存储约4000个会话。每个共享缓存应具有任意名称。具有相同名称的缓存可用于多个虚拟服务器。</li>
</ul>
</li>
<li>两种缓存类型可以同时使用，例如：<ul>
<li><code>ssl_session_cache builtin:1000 shared:SSL:10m;</code></li>
</ul>
</li>
<li>但只使用共享缓存而不使用内置缓存应该更有效率。<ul>
<li><code>builtin[:size]</code>：使用<code>OpenSSL</code>内建缓存，为每worker进程私有</li>
<li><code>[shared:name:size]</code>：在各<code>worker</code>之间使用一个共享的缓存73</li>
</ul>
</li>
</ul>
<h3 id="ssl-session-timeout-time"><a href="#ssl-session-timeout-time" class="headerlink" title="ssl_session_timeout time;"></a>ssl_session_timeout time;</h3><p><strong>官网帮助：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax:	ssl_session_timeout time;</span><br><span class="line">Default:	</span><br><span class="line">ssl_session_timeout 5m;</span><br><span class="line">Context:	http, server</span><br></pre></td></tr></table></figure></p>
<p>客户端连接可以复用<code>ssl session cache</code>中缓存的<code>ssl</code>参数的有效时长，默认<code>5m</code></p>
<h3 id="实现SSL"><a href="#实现SSL" class="headerlink" title="实现SSL"></a>实现SSL</h3><h4 id="1-创建证书"><a href="#1-创建证书" class="headerlink" title="1. 创建证书"></a>1. 创建证书</h4><p><a href="http://blog.csdn.net/hai__yun/article/details/77921134" target="_blank" rel="noopener">关于创建证书可以查看我的另外一篇博客：http://blog.csdn.net/hai__yun/article/details/77921134</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# cd /etc/pki/tls/certs/</span><br><span class="line">[root@Nginx-Server certs]# make nginx.crt</span><br><span class="line">umask 77 ; \</span><br><span class="line">/usr/bin/openssl genrsa -aes128 2048 &gt; nginx.key</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">...........................+++</span><br><span class="line">....+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase:</span><br><span class="line">Verifying - Enter pass phrase:</span><br><span class="line">umask 77 ; \</span><br><span class="line">/usr/bin/openssl req -utf8 -new -key nginx.key -x509 -days 365 -out nginx.crt -set_serial 0</span><br><span class="line">Enter pass phrase for nginx.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN  </span><br><span class="line">State or Province Name (full name) []:BJ</span><br><span class="line">Locality Name (eg, city) [Default City]:haidian</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:haiyun</span><br><span class="line">Organizational Unit Name (eg, section) []:opt</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:www.a.com</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure>
<h4 id="2-解密私钥"><a href="#2-解密私钥" class="headerlink" title="2. 解密私钥"></a>2. 解密私钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server certs]# ls</span><br><span class="line">ca-bundle.crt        make-dummy-cert  nginx.crt  renew-dummy-cert</span><br><span class="line">ca-bundle.trust.crt  Makefile         nginx.key</span><br><span class="line">[root@Nginx-Server certs]# openssl rsa -in nginx.key -out nginx.key </span><br><span class="line">Enter pass phrase for nginx.key:</span><br><span class="line">writing RSA key</span><br><span class="line">[root@Nginx-Server certs]# ls</span><br><span class="line">ca-bundle.crt        make-dummy-cert  nginx.crt  renew-dummy-cert</span><br><span class="line">ca-bundle.trust.crt  Makefile         nginx.key</span><br></pre></td></tr></table></figure>
<h4 id="3-创建证书目录和拷贝证书"><a href="#3-创建证书目录和拷贝证书" class="headerlink" title="3. 创建证书目录和拷贝证书"></a>3. 创建证书目录和拷贝证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server certs]# mkdir /etc/nginx/ssl         # 创建存放证书目录</span><br><span class="line">[root@Nginx-Server certs]# cp nginx.* /etc/nginx/ssl/       </span><br><span class="line">[root@Nginx-Server certs]# ls /etc/nginx/ssl/</span><br><span class="line">nginx.crt  nginx.key</span><br></pre></td></tr></table></figure>
<h4 id="4-修改配置文件"><a href="#4-修改配置文件" class="headerlink" title="4. 修改配置文件"></a>4. 修改配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# vim /etc/nginx/conf.d/vhost.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl  default_server ; </span><br><span class="line">    server_name www.a.com ; </span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    gzip on; </span><br><span class="line">    gzip_comp_level 9;</span><br><span class="line">    gzip_min_length 64; </span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    gzip_types text/xml text/css application/javascript ;</span><br><span class="line">        </span><br><span class="line">    ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line">    ssl_session_cache shared:sslcache:20m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="启动服务，测试"><a href="#启动服务，测试" class="headerlink" title="启动服务，测试"></a>启动服务，测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nginx: configuration file /etc/nginx/nginx.conf test failed</span><br><span class="line">[root@Nginx-Server ~]# nginx -t </span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx </span><br><span class="line">[root@Nginx-Server ~]# ss -tnul             # 查看端口是否打开</span><br><span class="line">Netid State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">udp   UNCONN     0      0        127.0.0.1:323                          *:*                  </span><br><span class="line">udp   UNCONN     0      0                *:50190                        *:*                  </span><br><span class="line">udp   UNCONN     0      0                *:68                           *:*                  </span><br><span class="line">udp   UNCONN     0      0              ::1:323                         :::*                  </span><br><span class="line">udp   UNCONN     0      0               :::31402                       :::*                  </span><br><span class="line">tcp   LISTEN     0      128              *:80                           *:*                  </span><br><span class="line">tcp   LISTEN     0      128              *:22                           *:*                  </span><br><span class="line">tcp   LISTEN     0      100      127.0.0.1:25                           *:*                  </span><br><span class="line">tcp   LISTEN     0      128              *:443                          *:*                  </span><br><span class="line">tcp   LISTEN     0      128             :::80                          :::*                  </span><br><span class="line">tcp   LISTEN     0      128             :::22                          :::*                  </span><br><span class="line">tcp   LISTEN     0      100            ::1:25                          :::*</span><br></pre></td></tr></table></figure>
<center><img src="https://houhaiyun.github.io/img/images/Nginx-ngx-http-ssl-module-1.gif" title="测试访问"></center>


<h3 id="实现多虚拟主机支持https"><a href="#实现多虚拟主机支持https" class="headerlink" title="实现多虚拟主机支持https"></a>实现多虚拟主机支持https</h3><h4 id="1-创建证书-1"><a href="#1-创建证书-1" class="headerlink" title="1. 创建证书"></a>1. 创建证书</h4><p>上面实验已经创建一个虚拟主机了，所以我们就直接用了。这次再创建一个就OK了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# cd /etc/pki/tls/certs/</span><br><span class="line">[root@Nginx-Server certs]# make nginx2.crt</span><br><span class="line">umask 77 ; \</span><br><span class="line">/usr/bin/openssl genrsa -aes128 2048 &gt; nginx2.key</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.....................+++</span><br><span class="line">........+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Enter pass phrase:</span><br><span class="line">Verifying - Enter pass phrase:</span><br><span class="line">umask 77 ; \</span><br><span class="line">/usr/bin/openssl req -utf8 -new -key nginx2.key -x509 -days 365 -out nginx2.crt -set_serial 0</span><br><span class="line">Enter pass phrase for nginx2.key:</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:BJ</span><br><span class="line">Locality Name (eg, city) [Default City]:haidian</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:haiyun</span><br><span class="line">Organizational Unit Name (eg, section) []:cto</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:www.b.com</span><br><span class="line">Email Address []:</span><br></pre></td></tr></table></figure></p>
<h4 id="2-解密私钥-1"><a href="#2-解密私钥-1" class="headerlink" title="2. 解密私钥"></a>2. 解密私钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server certs]# openssl rsa -in nginx2.key -out nginx2.key </span><br><span class="line">Enter pass phrase for nginx2.key:</span><br><span class="line">writing RSA key</span><br><span class="line">[root@Nginx-Server certs]# ls</span><br><span class="line">ca-bundle.crt        make-dummy-cert  nginx2.crt  nginx.crt  renew-dummy-cert</span><br><span class="line">ca-bundle.trust.crt  Makefile         nginx2.key  nginx.key</span><br></pre></td></tr></table></figure>
<h4 id="3-拷贝证书"><a href="#3-拷贝证书" class="headerlink" title="3. 拷贝证书"></a>3. 拷贝证书</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server certs]# cp nginx2.* /etc/nginx/ssl/</span><br><span class="line">[root@Nginx-Server certs]# ls /etc/nginx/ssl/</span><br><span class="line">nginx2.crt  nginx2.key  nginx.crt  nginx.key</span><br></pre></td></tr></table></figure>
<h4 id="4-创建访问目录"><a href="#4-创建访问目录" class="headerlink" title="4. 创建访问目录"></a>4. 创建访问目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# cat /app/website2/index.html         # 注意此文件是需要创建</span><br><span class="line">Nginx-Server --&gt; website2</span><br></pre></td></tr></table></figure>
<h4 id="5-修改配置文件"><a href="#5-修改配置文件" class="headerlink" title="5. 修改配置文件"></a>5. 修改配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# vim /etc/nginx/conf.d/vhost.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl  default_server ; </span><br><span class="line">    server_name www.a.com ; </span><br><span class="line">    root /app/website1 ;</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/nginx.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/nginx.key;</span><br><span class="line">    ssl_session_cache shared:sslcache:20m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl  ;</span><br><span class="line">    server_name www.b.com ;</span><br><span class="line">    root /app/website2 ;</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/nginx2.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/nginx2.key;</span><br><span class="line">    ssl_session_cache shared:sslcache:20m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-配置hosts文件"><a href="#6-配置hosts文件" class="headerlink" title="6. 配置hosts文件"></a>6. 配置hosts文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.8.140 www.a.com www.b.com</span><br></pre></td></tr></table></figure>
<h4 id="7-启动服务，测试"><a href="#7-启动服务，测试" class="headerlink" title="7. 启动服务，测试"></a>7. 启动服务，测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@Nginx-Server ~]# nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line">[root@Nginx-Server ~]# nginx -s stop</span><br><span class="line">[root@Nginx-Server ~]# nginx </span><br><span class="line">[root@Nginx-Server ~]# ss -tnul             # 端口已监听</span><br><span class="line">Netid State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">udp   UNCONN     0      0        127.0.0.1:323                          *:*                  </span><br><span class="line">udp   UNCONN     0      0                *:50190                        *:*                  </span><br><span class="line">udp   UNCONN     0      0                *:68                           *:*                  </span><br><span class="line">udp   UNCONN     0      0              ::1:323                         :::*                  </span><br><span class="line">udp   UNCONN     0      0               :::31402                       :::*                  </span><br><span class="line">tcp   LISTEN     0      128              *:80                           *:*                  </span><br><span class="line">tcp   LISTEN     0      128              *:22                           *:*                  </span><br><span class="line">tcp   LISTEN     0      100      127.0.0.1:25                           *:*                  </span><br><span class="line">tcp   LISTEN     0      128              *:443                          *:*                  </span><br><span class="line">tcp   LISTEN     0      128             :::80                          :::*                  </span><br><span class="line">tcp   LISTEN     0      128             :::22                          :::*                  </span><br><span class="line">tcp   LISTEN     0      100            ::1:25                          :::*      </span><br><span class="line">[root@Nginx-Server ~]# curl -k https://www.a.com/       # 可以访问，ok</span><br><span class="line">Nginx-Server --&gt; website1   </span><br><span class="line">[root@Nginx-Server ~]# curl -k https://www.b.com/       # 可以访问，ok</span><br><span class="line">Nginx-Server --&gt; website2</span><br></pre></td></tr></table></figure>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>